"use strict";function DefaultSettings(){var t={refresh:[]};let a=function(){for(let e=0;e<t.refresh.length;e++)t.refresh[e]()};return t.max_targets=5,t.anim_cancel=.05,t.power_level=785,t.set_power_level=function(n){let e=n.target,o=e.valueAsNumber;if(isNaN(o))throw"power_level is NaN!";600<o?(o=600,e.value=600):15>o&&(o=15,e.value=15),t.power_level=o+185,a()},t.difficulty="legend",t.set_difficulty=function(n){let e=n.target,o=e.value;if(!constants.difficulties[o])throw"difficulty is not registered!";else t.difficulty=o,a()},t.harder_better=!1,t.set_harder_better=function(n){let e=!t.harder_better;n.target.value=e,t.harder_better=e,a()},t.platform=!1,t.set_platform=function(n){let e=n.target,o=e.value;t.platform="console"==o,t.difficulty="legend",a()},t.profiles={},t.language="eng",t.link="manshanko.github.io",t}var verminted=DefaultSettings();function InitConstants(){return{armor_types:["infantry","armored","monster","friendly_fire","berserker","superarmored"],hit_types:["neither","headshot","critical","both"],attack_types:["light","push","heavy","dot"],dual_profile:["damage_profile_right","damage_profile_left"],characters:{bw_scholar:"sienna",bw_adept:"sienna",bw_unchained:"sienna",es_mercenary:"kruber",es_huntsman:"kruber",es_knight:"kruber",dr_ranger:"bardin",dr_ironbreaker:"bardin",dr_slayer:"bardin",we_waywatcher:"kerillian",we_maidenguard:"kerillian",we_shade:"kerillian",wh_captain:"saltzpyre",wh_bountyhunter:"saltzpyre",wh_zealot:"saltzpyre"},mob_lookup:{skaven_slave:"infantry",skaven_clan_rat:"infantry",chaos_fanatic:"infantry",chaos_marauder:"infantry",skaven_plague_monk:"berserker",chaos_berzerker:"berserker",skaven_storm_vermin:"armored",chaos_raider:"infantry",chaos_warrior:"superarmored",chaos_vortex_sorcerer:"infantry",chaos_corruptor_sorcerer:"infantry",skaven_poison_wind_globadier:"infantry",skaven_gutter_runner:"infantry",skaven_warpfire_thrower:"armored",skaven_ratling_gunner:"armored",skaven_pack_master:"monster"},elites:{skaven_plague_monk:!0,chaos_berzerker:!0,skaven_storm_vermin:!0,chaos_raider:!0,chaos_warrior:!0},difficulties:{deathwish:!0,legend:!0,champion:!0,veteran:!0,recruit:!0}}}var constants=InitConstants(),UID=0;function uniqueID(e){if(e.getAttribute("data-id"))return e.getAttribute("data-id");else{UID++;let t=UID;return e.setAttribute("data-id",t),t}}window.mobilecheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},String.prototype.hashCode=function(){var e,t,a=0;if(0===this.length)return a;for(e=0;e<this.length;e++)t=this.charCodeAt(e),a=(a<<5)-a+t,a|=0;return a};let concateObject=function(e){let t="";if("object"==typeof e){let a,n=0;if(e.isArray){n=e.length;for(let e=0;e<n;e++)a[e]=e}else a=Object.keys(e),n=a.length;for(let o=0;o<n;o++)t+=concateObject(e[a[o]])}else t+=e;return t};function pageSelection(e){let t=document.getElementsByClassName(e.getAttribute("data-slot"))[0],a=document.getElementsByClassName("main-page");for(let n=0;n<a.length;n++)a[n]==t?a[n].classList.remove("hide"):a[n].classList.add("hide")}let GenericMath=function(){let e={};return e.clamp=function(e,t,a){let n=0;return n=e>=a?a:e<=t?t:e,n},e.getPowerPercentage=function(e){let t=constants.min_power_level,a=constants.max_power_level;return(e-t)/(a-t)},e.scalePower=function(e){var t=Math.min;let a=verminted.power_level,n=verminted.difficulty;"deathwish"===n&&(n="legend");let o=constants.difficulty_settings[n],i=o.power_level_cap,r=o.power_level_max_target,s=0;if(i<a&&r){let e=a-i;a=i+r*e/(800-i)}else a=t(a,i);if(a>=constants.min_power_level_cap){let t,n=100,o=5;if(a>=constants.min_power_level_cap+n)t=(a-constants.min_power_level_cap)*(constants.power_level_diff_ratio[e]-1)/(o-1),verminted.platform&&"attack"===e&&(t*=1.4);else{let i=50*(1-(a-200)/n);t=(a+i-constants.min_power_level_cap)*(constants.power_level_diff_ratio[e]-1)/(o-1),verminted.platform&&"attack"===e&&(t=1.4*(t-200)+200)}s=constants.min_power_level_cap+t}else s=a;return s},e.getPower=function(t,a,n,o,i){let r,s=n.power_multiplier||a.power_multiplier||constants.default_power_multiplier,p=n.power_multiplier_near||a.power_multiplier_near,l=n.power_multiplier_far||a.power_multiplier_far;r=p&&l&&0<=i?0===i?p[t]:l[t]:s[t];let c=e.scalePower(t);return c*r},e.getCleave=function(t,a){let n=e.scalePower("cleave"),o=t.cleave_coefficient||constants.default_cleave_coefficient,i=constants.cleave.max-constants.cleave.min,r=n*o.attack,s=e.getPowerPercentage(r),p=i*s;return verminted.build.weapon[a].multipliers&&(p*=verminted.build.weapon[a].multipliers.power),p},e.getArmorMultiplier=function(e,t,a,n,o,i,r){let s,p,l=a.armor_multiplier||t.armor_multiplier||constants.default_power_multiplier,c=a.armor_multiplier_near||t.armor_multiplier_near,d=a.armor_multiplier_far||t.armor_multiplier_far;return i&&(p=i[e]),s=p&&p[n]?o&&p[o]||p[n]:c&&d&&0<=r?0===r?o&&0<=c[e][o]?c[e][o]:0<=c[e][n]?c[e][n]:1:o&&0<=d[e][o]?d[e][o]:0<=d[e][n]?d[e][n]:1:o&&0<=l[e][o]?l[e][o]:0<=l[e][n]?l[e][n]:1,s},e.getPowerForUnit=function(t,a,n,o,i,r,s,p){let l=t.targets&&t.targets[a]||t.default_target,c=n&&t.critical_multiplier;p&&(r=0,s=0);let d=e.getArmorMultiplier("attack",t,l,r,s,c,i),m=e.getPower("attack",t,l,c,i);m*=d;return m},e},WeaponDamage=function(){var e=Math.floor;let t={},a=GenericMath(),n={},o={};t.getCleave=a.getCleave,a.modifyBoostCurve=function(e,t){let a={};for(let n=0,o=e.length;n<o;n++)a[n]=e[n]*t;return a},a.clampCurveValue=function(e,t){let a=Object.keys(e).length-1;return 0>t?e[0]:t>a?e[a]:e[t]},a.getBoostCurveMultiplier=function(n,o){let i=Object.keys(n).length-1,r=i*o,s=e(r),p=r-e(r),t=a.clampCurveValue(n,s-1),l=a.clampCurveValue(n,s+0),c=a.clampCurveValue(n,s+1),d=a.clampCurveValue(n,s+2);return(-t/2+3*l/2-3*c/2+d/2)*p*p*p+(t-5*l/2+2*c-d/2)*p*p+(-t/2+c/2)*p+l};t.calculateDamage=function(e,t,n,r,s,p,l,c,d,m,_,h,u){let g=data.profiles[e];if(g.no_damage)return 0;let f={headshot:!0,weakspot:!0,protected_weakspot:!0},w=g.targets&&g.targets[_]||g.default_target,b=constants.boost_curves[w.boost_curve_type]||constants.boost_curves["default"],k={max:100,min:0},y=verminted.difficulty,x=0,v=0,C=1,E=1+h;if(f[t]||n||p||l&&1<l){let e=1==d||4==d||5==d?1:d;let o=k.max,i=a.getPowerForUnit(g,_,n,t,s,d,m,e),r=a.getPowerPercentage(i),c=o*r;(f[t]||n)&&(C=.5*c),(p||l&&0<l)&&(x=c)}let L=0,N=""+verminted.difficulty+verminted.power_level+e+_+m+(0+n);o[N]?L=o[N]:(L=i.raw(g,_,n,t,s,d,m,k),o[N]=L);let B;r&&(B=x&&L<x&&x*(r-1)||L*(r-1));let A=0,z=0;if(p){A+=[.75,.6,.5,.5,.5,.3][d]}if(l&&0<l){A+=[.75,.3,.75,.5,.5,.2][d]}f[t]&&(0<L?2==d?z+=w&&(w.headshot_boost_boss||w.headshot_boot)||.25:z+=w&&(w.headshot_boost_armor||w.headshot_boost)||.5:5==m&&0==L?z+=w&&(w.headshot_boost_heavy_armor||.25):1==d&&0==L&&(z+=w&&(w.headshot_boost_armor||w.headshot_boost)||.5),"protected_weakspot"==t&&(z*=.25)),"protected_spot"==t&&(A-=.5,z-=.5),g&&g.no_headshot_boost&&(z=0);let P=0;if(n&&(P=g.crit_boost||.5,g.no_crit_boost&&(P=0)),b&&(0<A||0<z||0<P)){let e=w&&w.power_boost_curve_coefficient||1,t=w&&w.boost_curve_coefficient||1;if(l&&0<l&&(e*=l,t*=l),0<A){let t=N+A;o[t]?x=o[t]:(x=i.power_boost(L,x,1,A,b,e),o[t]=x)}if(0<z||0<P){z*=1+u,z=a.clamp(z+P,0,1);let e=N+z+E+x;o[e]?v=o[e]:(v=i.headshot(L,x,C,b,t,z,P,E),o[e]=v)}}return verminted.temp_shade_ult&&2===d&&(L*=.45,x*=.5,v*=.5),L=L+x+v,B&&(L+=B),L},t.compileProfile=function(e,a,o,i){if("raw"===o)var r=0,s=0,p=0,l=0;else if(!i){var r=verminted.build.weapon[o].crit_boost,s=verminted.build.weapon[o].power_boost,p=verminted.build.weapon[o].has_power_boost,l=verminted.build.weapon[o].headshot_multiplier;let e=""+r+s+p+l+verminted.platform+verminted.difficulty.charAt(4)+verminted.power_level,t=(a+e).hashCode();if(n[a]===t)return;n[a]=t}let c={},d=constants.armor_types,m=constants.hit_types,_=verminted.max_targets;for(let n=0,s=d.length;n<s;n++){3==n&&(n=4);let e=n,o=n;5==n&&(e=1);let i=d[n];c[i]={};for(let s=0;s<m.length;s++){let d,h,u,g=m[s];verminted.temp_shade_ult&&(h=4,2==n&&(h=3));let f,w;1==s?(f="headshot",w=!1):2==s?(f=null,w=!0):3==s?(f="headshot",w=!0):(f=null,w=!1);data.profiles[a].duration&&(f=null),c[i][g]={};for(let n,s=0;s<_&&(n=t.calculateDamage(a,f,w,d,0,p,h,u,e,o,s,r,l),!(0<s&&n>c[i][g][s-1]));s++)c[i][g][s]=n}}return"raw"===o?c:void(verminted.profiles[a]=verminted.profiles[a]||{},verminted.profiles[a].crit_boost=r,verminted.profiles[a].power_boost=s,verminted.profiles[a].damage=c)},t.getDamage=function(e,a,n,o,i,r){let s,p;"object"==typeof o?(s=o.primary_armor||o.armor,p=o.race):(s=o,p=void 0),t.compileProfile(e,a,n,0);let l=verminted.build.weapon[n].multipliers,c=s;"superarmored"===s&&(c="armored");let d=1;if(l){let t=data.weapons[e].type;d*=l.power,d*=l["power_"+t],d*=l.damage_taken,d*=l[p]||1,d*=l[c]}let m=verminted.profiles[a].damage,_=m[s][i][r]||0;return _*=d,_};let i=function(){var e=Math.max;return{raw:function(e,t,n,o,i,r,s,p){let l=0,c=p,d=c.max-c.min,m=a.getPowerForUnit(e,t,n,o,i,r,s),_=a.getPowerPercentage(m);return l=c.min+d*_,l},power_boost:function(t,n,o,i,r,s){let p=a.modifyBoostCurve(r,s),l=a.clamp(i,0,1),c=a.getBoostCurveMultiplier(p||r,l);return n=e(e(n,t),o)*c,n},headshot:function(t,n,o,i,r,s,p,l){let c=0,d=a.modifyBoostCurve(i,r),m=a.getBoostCurveMultiplier(d||i,s);return c=e(e(n,t),o)*m,0<p&&(c*=l),c}}}();return t},WeaponBreakpoints=function(e){var t=Math.round,a=Math.ceil,n=Math.floor;let o={};return o.chain=[],o.mob_lookup=constants.mob_lookup,o.hit_types=constants.hit_types,o.damage_profiles=[],o.pullDamage=function(e,t,n){let i,r=o.chain,s=o.hit_types,p=o.damage_profiles;if(!o.mob_lookup[e]){throw`${e} does not have assigned armor type`}i=data.breeds[e];let l=data.breeds[e],c=l.race,d=verminted.difficulty,m=l.primary_armor||l.armor,_=m;l.hitzone_primary_armor?_=l.hitzone_primary_armor.head.attack||l.hitzone_primary_armor.head:l.hitzone_armor&&(_=l.hitzone_armor.head.attack||l.hitzone_armor.head);let h={};for(let o=t;o<t+(n||1);o++){let t=p[o],n=t.weapon,r=t.action,l=t.weapon_index,c=data.weapons[n].actions[r],d=0;if(t.aoe_profile)d=2;else{let n,o=verminted.damage.getCleave(data.profiles[t.profile],l);n=c.hit_mass&&constants.hit_mass[c.hit_mass][e]?data.breeds[e].hit_mass_counts&&data.breeds[e].hit_mass_counts[verminted.difficulty]?constants.hit_mass[c.hit_mass][e]*data.breeds[e].hit_mass_counts[verminted.difficulty]:data.breeds[e].hit_mass_count||20:data.breeds[e].hit_mass_counts&&data.breeds[e].hit_mass_counts[verminted.difficulty]?data.breeds[e].hit_mass_counts[verminted.difficulty]:data.breeds[e].hit_mass_count||20,t.dot?t.max_targets=p[t.parent_index].max_targets:("es_mercenary"===verminted.build.career.name&&(n*=.75),t.max_targets=a(o/n)),d=t.max_targets}for(let e=0,a=s.length;e<a;e++){h[s[e]]=[];let a=s[e];for(let n=0;n<d;n++){let o=m,r=0;t.aoe_profile&&0<n?r=verminted.damage.getDamage(t.weapon,t.aoe_profile,l,i,a,n):(("headshot"===s[e]||"both"===s[e])&&(o=_),r=verminted.damage.getDamage(t.weapon,t.profile,l,i,a,n)),h[s[e]][n]=r}}}return h},o.pullProfiles=function(e,t,a){let n=o.chain,r=o.damage_profiles,s=data.weapons[e].actions[t];if(s){let o=data.weapons[e].actions[t].damage_window;for(let e=0;e<n.length;e++)o+=n[e].speed;n[a].tth=o;let l=n[a].weapon_index,c=r.length;if(s.damage_profile_target){let n=s.damage_profile_target;r[c]={},r[c].weapon=e,r[c].weapon_index=l,r[c].chain_index=a,r[c].profile=n,r[c].action=t,r[c].shot_count=s.shot_count,r[c].tth=o,r[c].damage={},r[c].aoe_profile=s.damage_profile,c++}else if(s.damage_profile){let n=s.damage_profile;if(r[c]={},r[c].weapon=e,r[c].weapon_index=l,r[c].chain_index=a,r[c].profile=n,r[c].action=t,r[c].shot_count=s.shot_count,r[c].tth=o,r[c].damage={},c++,s.aoe&&s.aoe.damage_profile){let n=s.aoe.damage_profile;r[c]={},r[c].weapon=e,r[c].weapon_index=l,r[c].chain_index=a,r[c].profile=n,r[c].action=t,r[c].shot_count=s.shot_count,r[c].tth=o,r[c].damage={},c++}}else if(s.damage_profile_left){let n=s.damage_profile_left;r[c]={},r[c].weapon=e,r[c].weapon_index=l,r[c].chain_index=a,r[c].profile=n,r[c].action=t,r[c].shot_count=s.shot_count,r[c].tth=o,r[c].damage={},c++,n=s.damage_profile_right,r[c]={},r[c].weapon=e,r[c].weapon_index=l,r[c].chain_index=a,r[c].profile=n,r[c].action=t,r[c].shot_count=s.shot_count,r[c].tth=o,r[c].damage={},c++}let d=r.length;for(let m=n[a].profile_length;m<d;m++){let n=data.profiles[r[m].profile],i=n.dot||n.default_target.dot;if(n.targets[0]&&n.targets[0].dot)if(i&&i!==n.targets[0].dot)throw"two dot profiles were found and not properly handled!";else{i=n.targets[0].dot;var p=0}if(i){let n=data.profiles[i];c=r.length,r[c]={},r[c].weapon=e,r[c].weapon_index=l,r[c].chain_index=a,r[c].profile=i,r[c].action=t,r[c].shot_count=s.shot_count,r[c].tth=o,r[c].damage={},r[c].dot=!0,r[c].parent_index=m,r[c].tick_rate=n.tick_rate,r[c].duration=n.duration,r[c].max_stacks=n.max_stacks,r[c].target=p}}}},o.buildBreakpoints=function(i,r){if(0>i)return;let s=o.chain,p=o.damage_profiles,l=verminted.difficulty,c=o.hit_types,d=e.container,m=Object.keys(o.mob_lookup),_={},h=verminted.max_targets;for(let d,u=0,g=m.length;u<g;u++){d=m[u];for(let e,t=0;t<p.length;t++)e=o.pullDamage(m[u],t),p[t].damage[m[u]]=e;let g=data.breeds[d].max_health[l];verminted.platform&&data.breeds[d].console_max_health&&data.breeds[d].console_max_health[l]&&(g=data.breeds[d].console_max_health[l]),verminted.harder_better&&constants.elites[d]&&(g*=2),_[d]=0;for(let e=0,t=p.length;e<t;e++)if(p[e].dot)continue;else if(p[e].damage[m[u]]&&p[e].damage[m[u]].neither){let t=p[e].damage[m[u]].neither.length;t>_[m[u]]&&(_[d]=t)}for(let o=0;o<c.length;o++)for(let l=0;l<h;l++){if(l>=_[m[u]]){for(let t=l;t<h;t++)e.breeds[d].targets[t].row.classList.add("hide");break}let i=e.breeds[d].targets[l][c[o]],f=TooltipControl(i),w=`${m[u]}\r\n${c[o]}`,b=e.breeds[d].mob_name,k=d.replace(/_/g," "),y=k.replace(/\w+/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)});b.textContent=y+" ("+g+")";let x={},v=[],C=0,E=[],L=0;for(let e=0,t=p.length;e<t;e++){let t=p[e],a=v.length;if(!(p[e].damage[m[u]]&&p[e].damage[m[u]][c[o]]))v[a]=0;else if(t.dot){if("number"==typeof t.target&&l!==t.target)continue;else if(t.max_stacks){if(x[t.profile]=x[t.profile]||0,x[t.profile]>=t.max_stacks)continue;x[t.profile]++}let i=n(p[e].duration/p[e].tick_rate);for(let n=0;n<i;n++)v[a]=p[e].damage[m[u]][c[o]][0]||0,a++,w+=`\r\n${t.action} = ${v[a]&&v[a].toFixed(3)||0}`}else{let n=c[o];"raw"!==r&&!isNaN(s[p[e].chain_index].hit_type)&&4>s[p[e].chain_index].hit_type&&(n=c[s[p[e].weapon_index].hit_type]);let i=t.shot_count||1;for(let o=0;o<i;o++)v[a]=p[e].damage[m[u]][n][l]||0,w+=`\r\n${t.action} = ${v[a].toFixed(3)}`,a++}}for(let e,a=0;a<v.length;a++)e=t(4*v[a])/4,C+=e,E[a]=v[a]/g,L+=E[a];let N=i.textContent,B=[];if(0==C/g)i.textContent=0;else if(1<=C/g)i.textContent=1;else if(1>C/g){let e,o,r;0==g%C?(r=g/C,e=g/C-1,o=g/C/e):(r=a(g/C),e=n(g/C),o=g/C/e);let s=a(4*(g/e))/4;for(let e=0;e<v.length;e++){B[e]=B[e]||{};E[e]*(1/L);B[e].next_bp=v[e]?t(4*(v[e]*o))/4:0}let p=o;for(;;){let e=0,t=[],a=[];for(let n=0;n<B.length;n++)if(0<B[n].next_bp){if(e+=B[n].next_bp,B[n].percent=(B[n].next_bp-1/8)/v[n],!t[0]||B[n].percent>t[0].percent){for(let e=0;e<t.length;e++)t.pop();t[0]={},t[0].percent=B[n].percent,t[0].index=n}else if(B[n].percent===t[0].percent){let e=t.length;t[e]={},t[e].percent=B[n].percent,t[e].index=n}if(!a[0]||B[n].percent<a[0].percent){let e=a.length;for(let t=0;t<e;t++)a.pop();a[0]={},a[0].percent=B[n].percent,a[0].index=n}else if(B[n].percent===a[0].percent){let e=a.length;a[e]={},a[e].percent=B[n].percent,a[e].index=n}}if(e>s){let a=4*e-4*s;if(t.length<a)for(let e,a=0;a<t.length;a++)e=t[a].index,B[e].next_bp-=.25;else{p=t[0].percent;break}}else if(e===s){p=t[0].percent;break}else if(e<s)if(a.length)for(let e,t=0;t<a.length;t++)e=a[t].index,B[e].next_bp+=.25;else{break}let n=a.length;for(let e=0;e<n;e++)a.pop()}w+=`\r\n\r\npower needed for next bp: ${a(1e5*(p-1))/1e3}%`,p=a(100*p),100<p&&(p-=100),i.textContent=r+" ("+p+"%)"}let A=e.breeds[m[u]].targets[l].row;if(i.textContent!==N)i.classList.remove("damage-change"),window.setTimeout(function(){i.classList.add("damage-change")},0);else if(A.classList.contains("hide"))for(let e,t=0;t<A.children.length;t++)e=A.children[t],e.classList.remove("damage-change"),window.setTimeout(function(){e.classList.add("damage-change")},0);f.text(w),A.classList.remove("hide")}let i=e.breeds[d].extra_targets;_[d]>h?(i.textContent="+"+(_[d]-h),i.classList.remove("hide")):i.classList.add("hide")}d.classList.remove("hide")},o.clearAttacks=function(){for(let e=0,t=chain.length;e<t;e++)chain.pop()},o.generateCombo=function(){for(let e=0,t=chain.length;e<t;e++);},o},AttackBreakpoints=function(e,t){let a=e.container,n=WeaponBreakpoints(e),o=a.parentNode,r=o.getElementsByClassName("weapon-breakpoints-attacks")[0],s={};s.attacks=[],s.name_div=e.name_div,n.chain[0]={},n.chain[0].weapon_index=t;let p=function(){let e=data.weapons[s.name].actions,t=Object.keys(e).sort(),a=[],n=0;for(let o,r=0;r<t.length;r++)o=e[t[r]],(o.damage_profile||o.damage_profile_left)&&(a[n]=t[r],n++);for(let e,t=0;t<s.attacks.length;t++)e=s.attacks[t],a[t]?(e.textContent=a[t],e.setAttribute("data-action",a[t]),e.classList.remove("hide"),e.classList.remove("not-active-talent")):e.classList.add("hide")},l=function(){},c=function(t){n.damage_profiles=[];let e=n.damage_profiles,o=t.target.getAttribute("data-action");n.pullProfiles(s.name,o,0),n.buildBreakpoints(0,"raw");for(let e,a=0;a<s.attacks.length;a++)e=s.attacks[a],e===t.target?e.classList.remove("not-active-talent"):e.classList.add("not-active-talent");a.classList.remove("hide")};return n.set=function(e){s.name=e,s.name_div.textContent=e,o.classList.remove("hide"),l(),p()},n.refresh=function(){s.name&&0<n.damage_profiles.length&&n.buildBreakpoints(0)},verminted.update_on_build[verminted.update_on_build.length]=n.refresh,function(){for(let e,t=0;10>t;t++)e=document.createElement("div"),e.classList="weapon-attack js-button hide",e.addEventListener("click",c),s.attacks[t]=e,r.appendChild(e)}(),n},ComboBreakpoints=function(e){var t=Math.ceil,a=Math.floor;let n=WeaponBreakpoints(e);n.headshot_chance=0,n.armor_types=constants.armor_types;let o={},i=n.buildBreakpoints,r=document.getElementsByClassName("chain-options-modal")[0],s=r.getElementsByClassName("chain-attack-options")[0],p=r.parentNode.parentNode,l=ModalControl(p,r);l.close=function(){verminted.build.refresh(),p.classList.add("hide"),document.body.removeEventListener("click",l.onClick),document.body.classList.remove("no-scroll")};let c=document.getElementsByClassName("chain-attack-header");for(let t=0,a=c.length;t<a;t++)c[t].addEventListener("click",function(t){l.open(),t.stopPropagation()});document.getElementsByClassName("chain-options-modal-close")[0].addEventListener("click",l.close);let d=r.getElementsByClassName("chain-attack-options")[0],m={},_=function(t){let o=n.chain,r=n.damage_profiles,s=n.armor_types,p=e.info.damage_box,l=e.info.damage_box.dps;for(let e=0,i=s.length;e<i;e++){3==e&&(e=4);let l=s[e];if(p.dps[l])var c=p.dps[l];else{var c=document.createElement("div");c.classList.add(n.armor_types[e]),p.dps[n.armor_types[e]]=c,p.container.appendChild(p.dps[n.armor_types[e]])}let d=TooltipControl(c),_=0;if(0<t){for(let e,s=0,i=r.length;s<i;s++){if(e=r[s],!e.profile)continue;let i=o[e.weapon_index].weapon_index;if(e.dot){let n=a(e.duration/e.tick_rate),o=verminted.damage.getDamage(e.weapon,e.profile,i,l,"neither",0);if(!e.max_stacks)_+=o*n;else if(m[e.name])continue;else _+=o*n*t,m[e.name]=!0}else{let t=n.headshot_chance,a=verminted.build.getWeaponIndex(r[s].weapon),o=verminted.build.weapon[a].crit_chance||.05;data.weapons[r[s].weapon].actions[e.action]&&data.weapons[e.weapon].actions[r[s].action].extra_crit_chance&&(o+=data.weapons[e.weapon].actions[e.action].extra_crit_chance);let i=t*o;t-=i,o-=i;let p=1-(t+o+i),c=0,d=0,m=0,h=0;c+=verminted.damage.getDamage(e.weapon,e.profile,a,l,"neither",0),d+=verminted.damage.getDamage(e.weapon,e.profile,a,l,"headshot",0),m+=verminted.damage.getDamage(e.weapon,e.profile,a,l,"critical",0),h+=verminted.damage.getDamage(e.weapon,e.profile,a,l,"both",0),c*=p,d*=t,m*=o,h*=i;let u=c+d+m+h;_+=u}}_/=t;let e=`DPS against ${l}\r\n${_.toFixed(2)}`;d.text(e),c.textContent=a(10*_)/10}else c.textContent=0}},h=function(){let a=n.chain,o=e.info.attack_speed,r=0,s=!1;if(1<a.length){let e=a.length-1,t=data.weapons[a[e].weapon],n=a[e].weapon_index,o=verminted.build.weapon[n].attack_speed||1;if(a[e].weapon!==a[0].weapon)r+=t.actions[a[e].action].attack_speed.anim_cancel/o,r+=verminted.anim_cancel,s=!0;else if(t.actions[a[e].action]&&t.actions[a[e].action].attack_speed[a[0].action]){let n=t.actions[a[e].action].timeout,i=t.actions[a[e].action].attack_speed[a[0].action]-t.actions.neutral.attack_speed[a[0].action];r+=n&&n<i?n:i/o,s=!0}else if(n!==a[0].weapon_index){let n=t.actions[a[e].action].timeout,i=t.actions[a[e].action].attack_speed.anim_cancel-t.actions.neutral.attack_speed[a[0].action];r+=n&&n<i?n:i/o,s=!0}else if(t.actions.push&&a[0].action===t.actions.push.push_attack){switch(a[e].action){case"anim_cancel":r+=0;break;case"block":r+=0;break;default:let n=t.actions[a[e].action].attack_speed.block,i=t.actions[a[e].action].damage_window;r+=n<i?i/o:n/o;}s=!0}else"anim_cancel"===a[e].action?(r+=verminted.anim_cancel,s=!0):"block"===a[e].action&&(s=!0)}for(let e=0,t=a.length;e<t;e++){let t=a[e].weapon_index,n=verminted.build.weapon[t].attack_speed||1;r+=data.weapons[a[e].weapon].actions[a[e].action]&&data.weapons[a[e].weapon].actions[a[e].action].timeout&&data.weapons[a[e].weapon].actions[a[e].action].timeout<a[e].speed*n?data.weapons[a[e].weapon].actions[a[e].action].timeout:a[e].speed/n}r=t(100*r)/100,o.textContent=r+"s",s?(o.style.color="black",_(r)):(o.style.color="red",_(0))};n.addAttack=function(e,t,a,r){let s=n.chain,p=n.damage_profiles;if(0===r&&(o={},g(!0)),r<s.length){let e=s[r].profile_length-1;for(let t=p.length;t>e;t--)p[t]=null,p.pop();for(let e=s.length-1;e>r-1;e--)d.removeChild(s[e].options.div),s[e]=null,s.pop()}s[r]={},s[r].weapon=e,s[r].weapon_index=a,s[r].action=t,s[r].speed=0,s[r].hit_type=4,s[r].profile_length=p.length,s[r].options={};let l=document.createElement("div");l.classList="attack-options";let c=document.createElement("div");c.classList="attack-count",c.textContent=r+1;let m=document.createElement("div");m.classList="attack-name-options";let _=document.createElement("p");_.textContent=e;let u=document.createElement("span");u.textContent=t,m.appendChild(_),m.appendChild(u);let f=document.createElement("select");f.classList="attack-option-select js-input",f.addEventListener("change",function(){s[r].hit_type=parseInt(f.value)});let w=document.createElement("option");w.value=4,w.textContent="default",w.setAttribute("selected",!0),f.appendChild(w);for(let n,o=0;o<constants.hit_types.length;o++)n=document.createElement("option"),n.value=o,n.textContent=constants.hit_types[o],f.appendChild(n);l.appendChild(c),l.appendChild(m),l.appendChild(f),d.appendChild(l),s[r].options.div=l;let b=r;if(n.pullProfiles(e,t,r),!data.weapons[e].actions[t]){let e=r-1,a=data.weapons[s[e].weapon],n=a.actions[s[e].action];if("block"===t){let e=data.weapons[s[r-1].weapon].actions[s[r-1].action].attack_speed.block,t=data.weapons[s[r-1].weapon].actions[s[r-1].action].damage_window;s[r].speed+=e<t?t:e,s[r].speed+=a.block.min_hold}else{let e=data.weapons[s[r-1].weapon].actions[s[r-1].action].attack_speed.anim_cancel,t=data.weapons[s[r-1].weapon].actions[s[r-1].action].damage_window;s[r].speed+=e<t?t:e}--b}else{let a=data.weapons[e];if("melee"!==a.type||t!==a.actions.push.push_attack)0===r?s[r].speed=a.actions.neutral.attack_speed[t]:data.weapons[s[r-1].weapon].actions[s[r-1].action]?s[r].weapon_index===s[r-1].weapon_index?s[r].speed=a.actions[s[r-1].action].attack_speed[t]:(s[r].speed=a.actions.neutral.attack_speed[t],s[r].speed+=data.weapons[s[r-1].weapon].actions[s[r-1].action].attack_speed.anim_cancel):s[r].speed=a.actions.neutral.attack_speed[t];else if(s[r].speed=a.actions.push.attack_speed[t],s[r].speed+=a.block.min_hold,0<r)if(e===s[r-1].weapon){let e=0,t=0;data.weapons[s[r-1].weapon].actions[s[r-1].action]&&(e=data.weapons[s[r-1].weapon].actions[s[r-1].action].attack_speed.block,t=data.weapons[s[r-1].weapon].actions[s[r-1].action].damage_window),s[r].speed+=e<t?t:e}else{let e=data.weapons[s[r-1].weapon].actions[s[r-1].action].attack_speed.anim_cancel,t=data.weapons[s[r-1].weapon].actions[s[r-1].action].damage_window;s[r].speed+=e<t?t:e}}i(b),h()};let u=!1,g=function(t){u=t||!u,u?(e.container.getElementsByClassName("breakpoint-plate")[0].classList.remove("hide"),e.info.container.classList.remove("hide")):(e.container.getElementsByClassName("breakpoint-plate")[0].classList.add("hide"),e.info.container.classList.add("hide"))};return n.refresh=function(){let e=n.chain;e[0]&&null!==verminted.build.getWeaponIndex(e[0].weapon)&&h(),i(e.length-1)},function(){e.container.getElementsByClassName("attack-combo-title")[0].addEventListener("click",function(){g()})}(),verminted.update_on_build[verminted.update_on_build.length]=n.refresh,n},AttackChain=function(e){let t={anim_cancel:.05,weapon:[]},a={};t.chain=[];let n=document.getElementById("TEMPLATE-CHAIN").content.firstElementChild,o=verminted.combo_breakpoints,i=function(e,o){let i=t.chain,r=[],s=0;for(let p=0,n=t.weapon.length;p<n;p++){let e=t.weapon[p],n=data.weapons[e];if(e&&"melee"===data.weapons[e].type){if(o&&o.weapon===t.weapon[p]&&data.weapons[o.weapon].actions[o.attack]&&o.weapon_index===p){let t=data.weapons[o.weapon].actions,a=t[o.attack].attack_speed,n=Object.keys(a).sort(),i=[],l={};for(let e,a=0;a<n.length;a++)if(e=n[a],t[e]&&(t[e].damage_profile||t[e].damage_profile_left)){let t=i.length;i[t]=e,l[e]=!0}for(let e,t=0;t<n.length;t++)if(e=n[t],!l[e]){let t=i.length;i[t]=e}n=i;for(let t=0,a=n.length;t<a;t++)"block_cancel_end"!==n[t]&&(r[s]={},r[s].name=p+1+" "+n[t],r[s].attack=n[t],r[s].weapon=e,r[s].weapon_index=p,s++)}else{let t=data.weapons[e].actions.neutral.attack_speed,a=Object.keys(t);for(let t=0,n=a.length;t<n;t++)r[s]={},r[s].name=p+1+" "+a[t],r[s].attack=a[t],r[s].weapon=e,r[s].weapon_index=p,s++}let i=Object.keys(a[e].push),l=a[e].block.push;l+=a[e].push[i[0]],r[s]={},r[s].name=p+1+" push_attack",r[s].attack=n.actions.push.push_attack,r[s].weapon=e,r[s].weapon_index=p,s++}else if(e&&"ranged"===data.weapons[e].type)if(o&&o.weapon===t.weapon[p]&&"neutral"!==o.attack){let a,i=0;n.actions[o.attack]?a=n.actions[o.attack].attack_speed:(a=n.actions.neutral.attack_speed,"block"===o.attack?i=n.block.min_hold:"anim_cancel"===o.attack&&(i=t.anim_cancel));let l=Object.keys(a);for(let t=0,a=l.length;t<a;t++)"block_cancel_end"!==l[t]&&(r[s]={},r[s].name=p+1+" "+l[t],r[s].attack=l[t],r[s].weapon=e,r[s].weapon_index=p,s++)}else{let t=data.weapons[e].actions.neutral.attack_speed,a=Object.keys(t);for(let t=0,n=a.length;t<n;t++)r[s]={},r[s].name=p+1+" "+a[t],r[s].attack=a[t],r[s].weapon=e,r[s].weapon_index=p,s++}}for(let t=0,a=r.length;t<a;t++)r[t].node=document.createElement("option"),r[t].node.value=r[t].weapon+","+r[t].attack+","+r[t].weapon_index,r[t].node.textContent=r[t].name,e.appendChild(r[t].node);return r},r=function(a){let s,p=t.chain;if(a.target)s=a.target;else if(a.value)s=a;else throw`next chain had a problem`;let l=s.value.split(/,/),c={};c.weapon=l[0],c.attack=l[1],c.weapon_index=parseInt(l[2],10);let d=parseInt(s.getAttribute("data-count"),10)||0,m=d+1;if(p[m])for(let t=p.length-1;t>=m;t--)e.removeChild(p[t].node),p.pop();p[m-1].weapon=l[0],p[m-1].action=l[1],p[m]={},p[m].node=e.appendChild(n.cloneNode(!0)),p[m].select=p[m].node.getElementsByClassName("chain-attack-dropdown")[0],p[m].select.setAttribute("data-count",m),i(p[m].select,c),p[m].select.addEventListener("change",r),o.addAttack(c.weapon,c.attack,c.weapon_index,d)};return t.refresh=function(){let a=t.chain,o=!1,s=null;for(let n=0,i=a.length;n<i;n++){let i=a[n].select.value.split(/,/),r=i[0];r!==t.weapon[0]&&r!==t.weapon[1]&&(o=!0),o&&(null===s&&(s=n-1),e.removeChild(a[n].node))}for(let t=a.length-1;t>=0;t--)a[t].node.parentNode&&e.removeChild(a[t].node),a.pop();a[0]&&e.removeChild(a[0].node),a[0]=a[0]||{},a[0].node=e.appendChild(n.cloneNode(!0)),a[0].select=a[0].node.getElementsByClassName("chain-attack-dropdown")[0],a[0].select.setAttribute("data-count",0),i(a[0].select),a[0].select.addEventListener("change",r)},t.setWeapon=function(e,n){t.weapon[n]=e,reverseLookup(e),a[e]=data.weapons[e].lookup,t.refresh()},t},WeaponSelection=function(e){let t={},a=verminted.weapon_list,n=verminted.attack_chain;t.update=[];let o=function(t){let a=e.getAttribute("data-weapon-select"),o=verminted.weapon_slot[a];e.textContent=t,e.setAttribute("data-input",t);let r=verminted.update_weapon;for(let e=0,n=r.length;e<n;e++)r[e](t,a,o);n.setWeapon(t,parseInt(e.getAttribute("data-weapon-select"),10))};return e.addEventListener("click",function(t){a.setClickCallback(o);let e=verminted.update_weapon_list;for(let a=0,n=e.length;a<n;a++)e[a](t);a.open()}),t},ModalControl=function(t,a){let n={clickCallback:null,closeCallback:null,modal:t},o=!0;return n.open=function(){t.classList.remove("hide"),n.bind();let e=t.children[0];o?o=!1:e.scrollTo(0,0),document.body.classList.add("no-scroll")},n.setClickCallback=function(e){n.clickCallback=e},n.setCloseCallback=function(e){n.closeCallback=e},n.close=function(){null!==n.closeCallback&&n.closeCallback(),t.classList.add("hide"),document.body.removeEventListener("click",n.onClick),document.body.classList.remove("no-scroll")},n.onClick=function(o){o.stopPropagation();let e=o.target,i=!1;if(a)var r=a;else var r=t;for(;e&&e.classList;){if(e===r||e.classList.contains("weapon-list-holder")){i=!1;break}else if(e===document.body){i=!0;break}e=e.parentNode}i&&n.close()},n.bind=function(){document.body.addEventListener("click",n.onClick)},n},BuildBuild=function(){let e=document.getElementsByClassName("build-modal")[0].parentNode.parentNode,t={};t.career={},t.career.name,t.career.multipliers={},t.items=[],t.weapon=[],t.weapon_lookup={},t.update_on_close=verminted.update_on_build;let a,n={container:document.getElementsByClassName("weapon-list")[0],modal:verminted.weapon_list,lookup:{},weapon:{},property_combos:{}},o=document.getElementsByClassName("buff-container")[0],i=document.getElementsByClassName("weapon-breakpoints-container"),r={},s=[],p=[];for(let e=0;e<data.careers.bw_scholar.talent_tree.length;e++)p[e]={};let l={power_vs_unarmoured:"infantry",power_vs_armoured:"armored",power_vs_large:"monster",power_vs_frenzy:"berserker",power_vs_skaven:"skaven",power_vs_chaos:"chaos",power_level:"power"},c=verminted.compression;t.modal=ModalControl(e,document.getElementsByClassName("build-modal")[0]),document.getElementsByClassName("build-modal-close")[0].addEventListener("click",t.modal.close);let d=function(e){let a=t.items,o=[];o[0]=a[e].property[0].select.value,o[1]=a[e].property[1].select.value;let i=a[e].type,r=n.property_combos[i];for(let t=0,n=a[e].property.length;t<n;t++)for(let n,i=0,s=a[e].property[t].options.length;i<s;i++)n=a[e].property[t].options[i].value,r&&r[o[(t+1)%2]]?r[o[(t+1)%2]][n]?a[e].property[t].options[i].removeAttribute("disabled"):a[e].property[t].options[i].setAttribute("disabled",!0):a[e].property[t].options[i].removeAttribute("disabled")},m=function(e){let a,o,s=t.items;t.career.name?(a=data.careers[t.career.name],o=a.equipment):o=data.careers.dr_ranger.equipment;for(let t=0,i=s.length;t<i;t++){let i,p=o[t];if(i=data.weapons[s[t].name]?data.weapons[s[t].name].traits:1==t?"ranged_ammo":o[t],r[a]);else if(s[t].type===p&&s[t].trait_type===i&&!e)continue;else{s[t].type=p,s[t].trait_type=i;for(let e=0,a=s[t].property.length;e<a;e++){for(let a,n=0,o=s[t].property[e].options.length;n<o;n++)a=s[t].property[e].options.length-1,s[t].property[e].select.removeChild(s[t].property[e].options[a]),s[t].property[e].options.pop();let a=p;("ranged_ammo"===a||"ranged_heat"===a)&&(a="ranged");let o=document.createDocumentFragment(),i=Object.keys(n.property_combos[a]).sort();for(let a=0,n=i.length;a<n;a++){let n=i[a],r=document.createElement("option");r.value=n,r.textContent=data.localize[verminted.language][data.item.properties[n].name],s[t].property[e].name&&n===s[t].property[e].name&&r.setAttribute("selected",!0),s[t].property[e].options[a]=r,o.appendChild(r)}s[t].property[e].select.appendChild(o)}if(-1<t){let e=s[t].trait.options.length;if(0<e)for(let a,n=0;n<e;n++)a=e-1-n,s[t].trait.select.removeChild(s[t].trait.options[a]),s[t].trait.options.pop();let a=document.createDocumentFragment(),n=data.item.trait_combos[i].sort();for(let e=0,o=data.item.trait_combos[i].length;e<o;e++){let o=n[e],i=document.createElement("option");i.value=o,i.textContent=data.localize[verminted.language][data.item.traits[o].name],s[t].trait.name&&o===s[t].trait.name&&i.setAttribute("selected",!0),s[t].trait.options[e]=i,a.appendChild(i)}s[t].trait.select.appendChild(a)}}}},_=function(e,a){if(t.career.name=e,t.career.crit_chance=data.careers[e].base_crit_chance,t.career.attack_speed=data.careers[e].base_attack_speed||0,t.career.reload_speed=data.careers[e].base_reload_speed||0,t.career.headshot_multiplier=data.careers[e].base_headshot_multiplier||0,t.career.backstab_multiplier=data.careers[e].base_backstab_multiplier||0,r[e]&&!a);else{m();let t=data.careers[e].talent_tree;for(let e=0;e<t.length;e++){p[e]={};for(let a=0;a<t[e].length;a++){let n=t[e][a],o=data.localize[verminted.language][n.description],i=data.localize[verminted.language][n.name];s[e][a].div.classList.remove("not-active-talent"),s[e][a].div.textContent=i;let r=TooltipControl(s[e][a].div);r.text(o,"generated")}}}k.refresh()},h=function(e,a){let n=t.career.name;if(!n)return;let o={power_level:"power"},r={attack_speed:"attack_speed",reload_speed:"reload_speed",critical_strike_chance:"crit_chance",backstab_multiplier:"backstab_multiplier"},l=data.careers[n].talent_tree;p[e]=l[e][a],p[e].col=a;let c=p[e];if(c.stat_buff&&(c.max_stacks||c.chunk_size));else for(let e=0;5>e;e++){if(!p[e]||!p[e].stat_buff)continue;let a=p[e].stat_buff;o[a]?(0==e&&(t.career.multipliers[o[a]]=0),t.career.multipliers[o[a]]+=p[e].multiplier):r[a]&&(0==e&&(t.career[r[a]]=0),t.career[r[a]]+=p[e].multiplier)}for(let t=0;t<l[e].length;t++)t===a?s[e][t].div.classList.remove("not-active-talent"):s[e][t].div.classList.add("not-active-talent");k.refresh()},u=function(e,a){let n=t.items,o=n[a];o.name=e,verminted.weapon_attack_breakpoints[a].set(e),n[a].weapon.div.textContent=e,m(),verminted.attack_chain.setWeapon(e,a)},g=function(e,a,n){let o=t.items;o[a].property[n].name=e,o[a].property[n].value=data.item.properties[e].value[1],d(a,n)},f=function(e){let a=k.getModifier(e);if(!data.careers[t.career.name])"crit_chance"===e&&(a+=.05);else if(l[e]){for(let t=0;t<p.length;t++)if(p[t].buffs)for(let n,o=0;o<p[t].buffs.length;o++)n=p[t].buffs[o],e!==n.stat_buff||n.max_stacks||(a+=n.multiplier);}else{a+=t.career[e]||0;for(let t=0;t<p.length;t++)if(p[t].buffs)for(let n,o=0;o<p[t].buffs.length;o++)n=p[t].buffs[o],e!==n.stat_buff||n.max_stacks||("crit_chance"===n.stat_buff?a+=n.bonus:a+=n.multiplier)}return a};t.getMultipliers=function(){let e=t.items,a=t.weapon,n=t.weapon_lookup,o=[];for(let t=0,a=e.length;t<a;t++)if("charm"===e[t].type||"trinket"===e[t].type){let a=o.length;o[a]=e[t]}for(let e=0;e<n.length;e++)n.pop();for(let t,r=0,i=e.length;r<i;r++){if(t=e[r].name,a[r]={},!t&&!data.weapons[e[r].name])continue;n[t]=r,a[r].name=t,a[r].multipliers={},a[r].attack_speed=1+f("attack_speed"),a[r].reload_speed=1+f("reload_speed"),a[r].crit_boost=f("crit_boost"),a[r].power_boost=f("power_boost"),a[r].crit_chance=f("crit_chance"),a[r].headshot_multiplier=f("headshot_multiplier"),a[r].backstab_multiplier=f("backstab_multiplier"),a[r].has_power_boost=f("has_power_boost");let i=Object.keys(l);for(let e=0,t=i.length;e<t;e++)a[r].multipliers[l[i[e]]]=1+f(i[e]);let s=data.weapons[t].type;a[r].multipliers["power_"+s]=1+f("power_level_"+s),a[r].multipliers.damage_taken=1+f("damage_taken");for(let t=0,n=o.length+1;t<n;t++){let n=o[t]?o[t].property:e[r].property;for(let e,t=0,o=n.length;t<o;t++)e=n[t],l[e.name]?a[r].multipliers[l[e.name]]+=e.value:"attack_speed"===e.name?a[r].attack_speed+=e.value:"crit_boost"===e.name?a[r].crit_boost+=e.value:"crit_chance"===e.name&&(a[r].crit_chance+=e.value)}}return a},t.getWeaponIndex=function(e){let a=t.items,n=t.weapon,o=t.weapon_lookup;return 0<=o[e]?o[e]:(t.getMultipliers(),o[e])},t.refresh=function(){let e=t.weapon;t.getMultipliers();for(let e=0,t=verminted.update_on_build.length;e<t;e++)verminted.update_on_build[e]();for(let t=0;t<e.length;t++)e[t].name&&expandWeaponInfo(e[t].name,t,verminted.weapon_slot[t])};let w=function(){for(let e,n=0;n<a.length;n++)e=a[n],e.value===t.career.name?e.setAttribute("selected",!0):e.removeAttribute("selected",!1);m()};t.encode=function(e){let a={career:t.career,talents:p,items:t.items};if(!a.career||!a.career.name)e.classList.add("failed-copy");else{e.classList.remove("failed-copy");let n=c.encode(a),o="?"+n;e.textContent=o;let i=verminted.link+o,r=document.createElement("textarea");r.classList="hide",r.value=i,e.appendChild(r),r.focus(),r.select(),document.execCommand("copy"),e.removeChild(r);let s=document.createRange();s.selectNodeContents(e);let p=window.getSelection();p.removeAllRanges(),p.addRange(s),n!==t.build_code&&(history.pushState({build:{build_code:n}},"",o),t.build_code=n)}},t.decode=function(e){let a=verminted.compression.decode(e);b(a),t.build_code=e};let b=function(e){_(e.career,!0),u(e.items[0].weapon,0),u(e.items[1].weapon,1);for(let a=0;a<e.items.length;a++)g(e.items[a].properties[0],a,0),g(e.items[a].properties[1],a,1),t.items[a].trait.name=e.items[a].trait;for(let t=0;t<e.talents.length;t++){let a=t,n=e.talents[t];h(a,n)}w(),m(!0)},k=function(e,t){let a={},n={},o={},i=function(t){let a=n[t];if(!a.div){let o=document.createElement("div");o.classList="buff";let i=n[t],r=TooltipControl(o);r.text(t+"\r\n"+a.buff[0].stat_buff+"\r\n"+a.buff[0].value);let s=document.createElement("div");s.classList="buff-name";let p=n[t].sources,l=p.length,c="";for(let e,t=0;t<l;t++){e=p[t],c+=e.name,1<l&&t<l-1&&(c+=",");let a=document.createElement("p");a.textContent=c,s.appendChild(a)}let d=a.max_stacks,m=document.createElement("input");1===d?(m.type="checkbox",m.classList="buff-toggle",o.addEventListener("click",function(){let e=m.checked;e=!e,m.value=e,m.checked=e,a.stacks=e?1:0})):1<d&&(m.type="number",m.max=d,m.min=0,m.classList="buff-input",m.addEventListener("change",function(t){let e=t.target.valueAsNumber;a.stacks=0<e&&e<=d?e:0})),o.appendChild(s),o.appendChild(m),a.div=o,a.source_div=s,e.appendChild(o)}else{a.source_div.innerHTML="";let e=n[t].sources,o=e.length;for(let t=0;t<o;t++){let n="",i=e[t];n+=i.name,1<o&&t<o-1&&(n+=",");let r=document.createElement("p");r.textContent=n,a.source_div.appendChild(r)}}},r=function(t,a,r){if(a.max_stacks){let s=r||a.name,p=data.localize[verminted.language][s]||a.name.replace(/_/g," ");if(!n[t]){let i=a.stat_buff,r=a.bonus||a.multiplier,l=a.max_stacks;n[t]={},n[t].sources=[],n[t].sources[0]={},n[t].sources[0].name=p,n[t].sources[0].name_id=s,n[t].source_lookup={},n[t].source_lookup[p]=!0,n[t].buff=[],n[t].buff[0]={},n[t].buff[0].stat_buff=i,n[t].buff[0].value=r,n[t].max_stacks=l,n[t].stacks=0,n[t].remove=function(){n[t].div&&(e.removeChild(n[t].div),delete n[t])},o[i]=o[i]||[];let c=o[i].length;o[i][c]=t}else if(!n[t].source_lookup[p]){let e=n[t].sources.length;n[t].sources[e]={},n[t].sources[e].name=p,n[t].sources[e].name_id=s,n[t].source_lookup[p]=!0}a.stat_buff&&(a.bonus||a.multiplier)&&i(t)}},s=function(){let e=Object.keys(n);for(let t=0;t<e.length;t++)n[e[t]].sources=[],n[e[t]].source_lookup={}};return a.refresh=function(){s();let e=t.items,a=verminted.global_buffs,l=Object.keys(a);for(let e=0;e<l.length;e++)r(l[e],a[l[e]]);if(t.career.name){let e=data.careers[t.career.name].passives;for(let t=0;t<e.length;t++)r(e[t].name,e[t])}for(let e=0;e<p.length;e++)if(p[e]&&p[e].name)for(let t,a=0;a<p[e].buffs.length;a++)t=p[e].buffs[a],r(t.name,t,p[e].name);for(let t=0;t<e.length;t++)if(e[t].trait.name){let a=data.item.traits[e[t].trait.name];r(e[t].trait.name,a,a.name)}let c={},d=Object.keys(n);for(let e=0;e<d.length;e++){let t=d[e],a=n[t],o=a.sources;if(1>o.length)n[t].remove();else{let e=a.buff[0].stat_buff;c[e]=c[e]||[];let n=c[e].length;c[e][n]=t}}o=c},a.getModifier=function(e){let t=0;if(o[e])for(let a=0;a<o[e].length;a++){let i=o[e][a],r=n[i];0<r.stacks&&(t+=n[i].buff[0].value*r.stacks)}return t},a}(e.getElementsByClassName("buff-container")[0],t);return t.test=k,t.modal.setCloseCallback(t.refresh),function(){verminted.update_weapon[verminted.update_weapon.length]=u;let e=n.container,t=Object.keys(data.weapons).sort(),a=document.createDocumentFragment();for(let e=0,o=t.length;e<o;e++){let o=t[e],i=data.weapons[o].type,r=Object.keys(data.weapons[o].career);for(let e,t=0,a=r.length;t<a;t++){e=r[t],n.lookup[e]=n.lookup[e]||{},n.lookup[e][i]=n.lookup[e][i]||[];let a=n.lookup[e][i].length;n.lookup[e][i][a]=o}let s=document.createElement("div");s.classList="weapon-list-weapon-name js-button",s.setAttribute("data-weapon",o),s.textContent=o,n.weapon[o]={},n.weapon[o].div=s,a.appendChild(s)}e.appendChild(a)}(),function(){let t=e.getElementsByClassName("select-career")[0],n=document.createDocumentFragment(),o=Object.keys(data.careers).sort();for(let e,t=0,a=o.length;t<a;t++)e=document.createElement("option"),e.textContent=data.localize[verminted.language][data.careers[o[t]].name],e.value=o[t],n.appendChild(e);t.appendChild(n),t.addEventListener("change",function(t){_(t.target.value)}),a=t}(),function(){let a=e.getElementsByClassName("career-and-gear")[0],n=t.items;n[0]={},n[0].container=a.getElementsByClassName("item-container")[0];let o=n[0].container.cloneNode(!0),r=0;for(;5>n.length;){0!==r&&(n[r]={},n[r].container=n[r].container||o.cloneNode(!0),1<r&&(n[r].container.textContent=data.careers.dr_ranger.equipment[r]),4===r&&n[r].container.classList.add("item-container-last")),n[r].property=[];for(let e,t=0;2>t;t++)e=document.createElement("select"),e.classList="select-property js-input",e.setAttribute("data-item-slot",r),e.setAttribute("data-property-slot",t),e.innerHTML=`<option selected disabled hidden>Property</option>`,e.addEventListener("change",function(t){let e=t.target.getAttribute("data-item-slot"),a=t.target.getAttribute("data-property-slot"),n=t.target.value;g(n,e,a)}),n[r].property[t]={},n[r].property[t].select=e,n[r].property[t].options=[],n[r].container.appendChild(e);for(let e,t=0;1>t;t++){e=document.createElement("select"),e.classList="select-trait js-input",e.innerHTML=`<option selected disabled hidden>Trait</option>`,n[r].trait={},n[r].trait.select=e,n[r].trait.options=[],n[r].trait.name=null;let t=n[r].trait;e.addEventListener("change",function(a){let e=a.target.value;t.name=e;data.item.traits[e];k.refresh()}),n[r].container.appendChild(e)}a.appendChild(n[r].container),r++}for(let e,t=0;2>t;t++)e=document.createElement("div"),e.classList="select-weapon js-button",e.setAttribute("data-weapon-select",t),n[t].weapon={},n[t].weapon.div=e,n[t].weapon.div.textContent=`Weapon ${t+1}`,n[t].container.classList.add("item-weapon"),n[t].container.prepend(e)}(),function(){let t=e.getElementsByClassName("talent-tree")[0],a=document.createDocumentFragment(),n=data.careers.dr_ranger.talent_tree.length;for(let e=0;e<n;e++){s[e]=[];let t=document.createElement("div");t.classList="talent-row";for(let a,n=0;3>n;n++)a=document.createElement("div"),a.classList="talent js-button",s[e][n]={},s[e][n].div=a,t.appendChild(a),a.addEventListener("mousedown",function(){h(e,n)});a.appendChild(t)}t.appendChild(a)}(),function(){let e=document.getElementsByClassName("copy-build")[0];e.addEventListener("click",function(){t.encode(e)});let a=TooltipControl(e);a.text`Copies a url for this build containing\r\nselected career, items, and talents.\r\n\r\nOnly works with valid combinations.`}(),function(){let e={},t=Object.keys(data.item.property_combos);for(let a=0,n=t.length;a<n;a++){e[t[a]]={};let n=data.item.property_combos[t[a]];for(let o=0,i=n.length;o<i;o++)e[t[a]][n[o][0]]=e[t[a]][n[o][0]]||{},e[t[a]][n[o][0]][n[o][1]]=!0,e[t[a]][n[o][1]]=e[t[a]][n[o][1]]||{},e[t[a]][n[o][1]][n[o][0]]=!0}n.property_combos=e}(),k.refresh(),m(),t.getMultipliers(),verminted.refresh[verminted.refresh.length]=t.refresh,verminted.update_weapon_list[verminted.update_weapon_list.length]=function(a){let e=t.career.name,o=Object.keys(n.weapon),r={};if(e){let t=a.target.getAttribute("data-weapon-select"),o=e,i=data.careers[o].equipment[t],s=n.lookup[o][i];for(let e=0,t=s.length;e<t;e++)r[s[e]]=!0}else for(let e=0,t=o.length;e<t;e++)r[o[e]]=!0;for(let e=0,t=o.length;e<t;e++)r[o[e]]?n.weapon[o[e]].div.classList.remove("hide"):n.weapon[o[e]].div.classList.add("hide")},verminted.do_not_open_build?window.setTimeout(function(){t.refresh()},100):t.modal.open(),t},WeaponListModal=function(){let t=ModalControl(document.getElementsByClassName("weapon-list-holder")[0]);return t.onClick=function(a){a.stopPropagation();let e=a.target,n=!0;for(;e&&e.classList;){if(e.classList.contains("weapon-list-holder")){n=!1;break}else if(e.getAttribute("data-weapon")){let a=e.getAttribute("data-weapon");t.clickCallback(a),n=!0;break}else e.classList.contains("select-weapon")&&(n=!1);e=e.parentNode}n&&t.close()},t},TooltipControl=function(e){if(verminted.tooltips[uniqueID(e)])return verminted.tooltips[uniqueID(e)];let t={},a=null,n=verminted.tooltip,o=n.children[0],i="pre",r=null;return t.open=function(){let t=e.getBoundingClientRect();o.textContent=r,o.style=`white-space: ${i};`,n.style.display="inline-block",n.style.left=t.right+n.offsetWidth+2>window.innerWidth?window.innerWidth-(n.offsetWidth+2)+"px":t.right-0+"px",n.style.top=t.bottom+"px"},t.close=function(){n&&(n.style.display="none"),clearTimeout(a)},t.bind=function(){e.addEventListener("mouseover",t.startTimer),e.addEventListener("mouseout",t.close)},t.startTimer=function(){verminted.mobile=window.mobilecheck(),verminted.mobile||(a=setTimeout(function(){t.open()},400))},t.text=function(e,t){"generated"===t&&(i="normal"),r=e},t.bind(),verminted.tooltips[uniqueID(e)]=t},compareConsole=function(t){var r=Math.round;function e(e){for(let t,n=0;n<e.length;n++)if(t=e[n].split`,`,c[t[0]]){let o=t[0],i=c[o];p[i]={};for(let t,o="infantry";n<e.length;){if(t=e[n].split`,`,"infantry"===o&&""===t[2]){o="armored",n++;continue}else if("armored"===o&&""===t[2])break;let r=a(i,t[1]);"hevay attack 3"===t[1]&&(r="heavy_attack_right_up"),p[i][r]=p[i][r]||{},p[i][r][o]=p[i][r][o]||{},p[i][r][o].neither=p[i][r][o].neither||0,p[i][r][o].headshot=p[i][r][o].headshot||0,p[i][r][o].critical=p[i][r][o].critical||0,p[i][r][o].both=p[i][r][o].both||0,p[i][r][o].neither+=parseFloat(t[3]),p[i][r][o].headshot+=parseFloat(t[4]),p[i][r][o].critical+=parseFloat(t[5]),p[i][r][o].both+=parseFloat(t[6]),n++}}}function a(e,t){t=t.toLowerCase(0);let a,n=data.weapons[e].actions,o=function(e,t){let a="neutral",o=0;for(;o<t;){let t=n[a].attack_speed,r=Object.keys(t).sort();for(let t=0;t<r.length;t++)if(0<=r[t].search(e)){if("heavy"===e&&0<=r[t].search("heavy_attack_charged"))continue;a=r[t]}o++}return a};if(0<=t.search("push"))a=n.push.push_attack;else if(0<=t.search("light")){let e=parseInt(t.charAt(t.search(/[0-9]/)),10);a=o("light",e)}else if(0<=t.search("charged")){let e=parseInt(t.charAt(t.search(/[0-9]/)),10)||1;a=o("heavy_attack_charged",e)}else if(0<=t.search("heavy")){let e=parseInt(t.charAt(t.search(/[0-9]/)),10)||1;a=o("heavy",e)}return a}function n(){let e=Object.keys(p);for(let t,a=0;a<e.length;a++){t=e[a],l[t]={};let n=Object.keys(p[t]);for(let e=0;e<n.length;e++){let a=n[e],o=data.weapons[t].actions[a];if(!o)continue;let i={},s=[];o.damage_profile_left?(s[0]=o.damage_profile_left,s[1]=o.damage_profile_right):s[0]=o.damage_profile_target||o.damage_profile;for(let e=0;e<s.length;e++){let a=s[e],n=verminted.damage.compileProfile(t,a,"raw");for(let e,t=0;t<d.length;t++)e=d[t],i[e]=i[e]||{},i[e].neither=i[e].neither||0,i[e].headshot=i[e].headshot||0,i[e].critical=i[e].critical||0,i[e].both=i[e].both||0,i[e].neither+=r(4*n[e].neither[0])/4,i[e].headshot+=r(4*n[e].headshot[0])/4,i[e].critical+=r(4*n[e].critical[0])/4,i[e].both+=r(4*n[e].both[0])/4}l[t][a]=i}}i(o)}function o(e,t){let a=document.createElement("div");if(a.textContent=e,a.classList="js-button",0===t.length)a.classList.add("console-compare-weapon-passed");else{a.classList.add("console-compare-weapon-failed");let e=document.createElement("div");e.classList="console-compare-weapon-container hide";for(let a=0;a<t.length;a++){let n=t[a],o=document.createElement("div");o.textContent=n.action+" "+n.armor+" "+n.hit+" - estimate: "+n.estimate+" / actual: "+n.actual,e.appendChild(o)}a.appendChild(e),a.addEventListener("click",function(){e.classList.toggle("hide")})}return a}function i(e){let t=document.getElementById("SPA"),a=document.getElementsByClassName("console-compare");for(let n=0;n<a.length;n++)t.removeChild(a[n]);let n=document.createElement("div");n.classList="console-compare";let o=Object.keys(l);for(let t=0;t<o.length;t++){let a=o[t],i=[],r=Object.keys(l[a]);for(let e,t=0;t<r.length;t++){e=r[t];for(let t,n=0;n<d.length;n++){t=d[n];for(let n=0;n<constants.hit_types.length;n++){let o=constants.hit_types[n],r=l[a][e][t][o],s=p[a][e][t][o];if(s!==r){passed=!1;let a=i.length;i[a]={},i[a].estimate=r,i[a].actual=s,i[a].action=e,i[a].armor=t,i[a].hit=o}}}}n.appendChild(e(a,i))}let i=document.createElement("div");i.classList="console-compare-close-button js-button",i.textContent="Close",n.appendChild(i),t.appendChild(n),i.addEventListener("click",function(){document.getElementById("SPA").removeChild(n)})}verminted.platform=!0,verminted.difficulty="legend",verminted.power_level=785;let s=t.target.files[0],p={},l={},c={Axe:"1h_axe","Axe and Falchion":"axe_and_falchion",Falchion:"falchion",Flail:"flail",Rapier:"rapier","Two-handed Sword":"2h_sword",Crowbill:"crowbill",Dagger:"dagger","Fire Sword":"flame_sword",Mace:"mace",Sword:"1h_sword"},d=["infantry","armored"],m=new FileReader;m.onload=function(){e(m.result.split(/\r\n/g)),n()},m.readAsText(s)};function reverseLookup(e){if(data.weapons[e].lookup)return!1;let t={},a=data.weapons[e].actions,n=Object.keys(a),o={};o.lookup={},o.lookup["default"]=!0,o.current=0,o.buffer=[],o.buffer[0]="default",o.future=o.current+1;let i=function(r){t[r]={};for(let e,s=0,i=n.length;s<i;s++){if(e=a[n[s]],e.attack_speed&&e.attack_speed.parent){let a=Object.keys(e.attack_speed.parent);for(let i=0,p=a.length;i<p;i++)o.lookup[a[i]]||(o.lookup[a[i]]=!0,o.buffer[o.future]=a[i],o.future++),r===a[i]&&(t[r][n[s]]=e.attack_speed.parent[a[i]])}if(e.attack_speed.child){let t=Object.keys(e.attack_speed.child);for(let e=0,a=t.length;e<a;e++)o.lookup[t[e]]||(o.lookup[t[e]]=!0,o.buffer[o.future]=t[e],o.future++)}}o.current++,o.buffer[o.current]?(r=o.buffer[o.current],i(r)):data.weapons[e].block&&(t.block=t.block||{},t.block.push=data.weapons[e].block.min_hold,data.weapons[e].push&&(t.push=t.push||{}),t.block_cancel_end&&delete t.block_cancel_end,t.anim_cancel&&delete t.anim_cancel)};return i(o.buffer[0]),data.weapons[e].lookup=t,!0}function expandWeaponInfo(e,t,a){var n=Math.round;let o=constants.hit_types,i=constants.armor_types,r=(""+verminted.platform+t+concateObject(verminted.build.weapon[t])).hashCode(),s=a.getAttribute("data-hash");if(r===s)return;a.setAttribute("data-hash",r);let p={neither:"normal",headshot:"headshot",critical:"critical",both:"both"},l=a;l.getElementsByClassName("weapon-title")[0].textContent=e;let c=data.weapons[e],d=Object.keys(c.actions).sort(),m=l.getElementsByClassName("attack"),_=verminted.damage,h=-1;"ranged"===data.weapons[e].type&&(h=0);for(let r=0,s=m.length;r<s;r++)if(r<d.length){let a=c.actions[d[r]].attack_speed,s=m[r].getElementsByClassName("attack-modifiers")[0];if(m[r].getElementsByClassName("weapon-attack-name")[0].textContent=d[r],s.textContent="",a){let e=m[r].getElementsByClassName("svg-attack-speed")[0],t=e.getElementsByTagName("use")[0],o=TooltipControl(t),i="Chain to:",s=Object.keys(a).sort().reverse();for(let e,t=0,o=s.length;t<o;t++)e=a[s[t]],e=n(100*e)/100,i+="\r\n"+e+"\t"+s[t];o.text(i)}let l={},h=m[r].getElementsByClassName("damage-table")[0];c.actions[d[r]].damage_profile?l[0]=c.actions[d[r]].damage_profile:(l[0]=c.actions[d[r]].damage_profile_left,l[1]=c.actions[d[r]].damage_profile_right);for(let a=0;6>a;a++){3==a&&(a=4);let r=a,s=a;5==a&&(r=1,s=5);for(let r=0;4>r;r++){let s,c;s=1==r||3==r?"headshot":null,c=!!(1<r);let d=!1,m=[],u=null,g=h.getElementsByClassName(constants.armor_types[a]+" "+constants.hit_types[r])[0],f=TooltipControl(g);for(let s,c=0;5>c;c++){s=0;for(let p=0,d=Object.keys(l).length;p<d;p++){if(data.profiles[l[p]]){let d=_.getDamage(e,l[p],t,i[a],o[r],c);s+=n(4*d)/4}m[c]=s}let h;!0==d||0<c&&m[c]>m[c-1]?(h=0,d=!0):0<m[c]%1?h=m[c].toFixed(2):h=m[c],0==c&&(g.textContent=m[0],u=constants.armor_types[a]+" - "+p[constants.hit_types[r]],u+="\r\nTargets:"),0<h&&(u+="\r\n  "+(c+1)+": "+h)}f.text(u)}}m[r].classList.remove("hide")}else m[r].classList.add("hide")}function assembleDiv(e,t,a,n){let o=n?document.createElement(n):document.createElement("div");return o.classList=e,a&&(o.textContent=a),t.appendChild(o),o}function assembleWeaponSheet(){var e={};e.table=document.createElement("div"),e.table.id="weapon-data",e.table.classList="hide",e.attack={};for(var t=0;16>t;t++){let a=assembleDiv("attack-container",e.table);e.attack[t]=assembleDiv("attack-type",a).textContent;let n=assembleDiv("damage-table",a);e.damage={};for(let t=0;5>t;t++){e.damage[constants.armor_types[t]]={};for(let a,o=0;4>o;o++)a=assembleDiv(constants.armor_types[t]+" "+constants.hit_types[o],n).textContent,e.damage[constants.armor_types[t]][constants.hit_types[o]]=a}}return e}function assembleWeapon(e,t,a,n,o){var i=o.weapons[t[n]],r="weapon-name";"ranged"===i.type&&(r="weapon-name weapon-ranged");var s=assembleDiv(r+" weapon-holder",e,t[n]);if(s.setAttribute("data-weapon",t[n]),i.career){let e=Object.keys(i.career),t=constants.characters,a={},n=!1;for(let o,i=0,r=e.length;i<r;i++)o=t[e[i]],o&&!a[o]&&(n?n+=","+o:n=o,a[o]=!0);s.setAttribute("data-character",n)}return s}function populateElements(){var e=document.createDocumentFragment(),t=document.getElementsByClassName("weapon-list")[0],a=Object.keys(data.weapons).sort(),n=constants.characters;let o=document.getElementsByClassName("attack")[0];for(let e=0;2>e;e++){let t="[data-weapon-slot='"+e+"']",a=document.querySelector(t).getElementsByClassName("attacks-container")[0];for(let t,n=0;n<9+e;n++)t=o.cloneNode(!0),a.appendChild(t)}}function populateAttackCombo(){let e={},t=data.breeds,a=Object.keys(constants.mob_lookup),n=constants.hit_types,o=constants.armor_types,i=verminted.max_targets,r=function(e,t){let a,o=data.breeds[e],r={},s=document.createElement("div"),p=o.primary_armor||o.armor;a=o.hitzone_primary_armor?o.hitzone_primary_armor.head:o.hitzone_armor?o.hitzone_armor.head:p;let l=document.createElement("div");l.classList.add("mob-name"),l.textContent=e,r.mob_name=l,s.appendChild(l),r.targets=[];for(let o,l=0;l<i;l++){o=document.createElement("div"),o.classList.add("breakpoint-row"),r.targets[l]={},r.targets[l].row=o;for(let e=0;e<n.length;e++){let t,i=n[e];t="headshot"===i||"both"===i?a:p;let s=document.createElement("div");s.classList.add(t),s.classList.add(i),r.targets[l][i]=s,o.appendChild(s)}s.appendChild(o)}let c=document.createElement("div");return c.classList="extra-target-row hide",r.extra_targets=c,s.appendChild(c),r.container=s,t.appendChild(s),r};e.weapon=[];let s=document.getElementsByClassName("weapon-breakpoints-container");for(let t,n=0;n<s.length;n++){t=s[n].getElementsByClassName("weapon-breakpoints")[0],e.weapon[n]={},e.weapon[n].container=t,e.weapon[n].name_div=s[n].getElementsByClassName("weapon-name")[0];let o=document.createElement("div");o.classList.add("breakpoint-plate");let i={};for(let e,t=0,n=a.length;t<n;t++)e=r(a[t],o),i[a[t]]=e;e.weapon[n].breeds=i;let p=s[n].getElementsByClassName("weapon-breakpoints-attacks")[0],l=!0;e.weapon[n].name_div.addEventListener("click",function(){l=!l,l?(p.classList.remove("hide"),o.classList.remove("hide")):(p.classList.add("hide"),o.classList.add("hide"))}),t.appendChild(o)}e.combo={},e.combo.container=document.getElementsByClassName("attack-combo")[0],e.combo.info={},e.combo.info.container=document.createElement("div"),e.combo.info.container.classList="combo-info hide",e.combo.info.attack_speed=document.createElement("div"),e.combo.info.damage_box={},e.combo.info.damage_box.container=document.createElement("div"),e.combo.info.damage_box.dps={},e.combo.info.damage_box.container.classList.add("combo-damage-box"),e.combo.info.container.appendChild(e.combo.info.attack_speed),e.combo.info.container.appendChild(e.combo.info.damage_box.container),e.combo.breeds={};let p=document.createElement("div");p.classList="breakpoint-plate hide";let l={};for(let e,t=0,n=a.length;t<n;t++)e=r(a[t],p),l[a[t]]=e;return e.combo.breeds=l,e.combo.container.appendChild(e.combo.info.container),e.combo.container.appendChild(p),e}function VermintedCompress(){var e=Math.floor;let t={},a={career:15,talent1:3,talent2:3,talent3:3,talent4:3,talent5:3,wep1:10,wep2:8,wep1props:27,wep2props:27,neckprops:20,charmprops:25,trinketprops:21,wep1traits:7,wep2traits:7,necktraits:5,charmtraits:5,trinkettraits:3},n=["career","talent1","talent2","talent3","talent4","talent5","wep1","wep2","wep1props","wep2props","neckprops","charmprops","trinketprops","wep1traits","wep2traits","necktraits","charmtraits","trinkettraits"],o=vermintedLookup(),r=o.index;var s={_Rixits:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_",fromNumber:function(t){var a=Number.POSITIVE_INFINITY;if(isNaN(+t)||null===t||t===a)throw"The input is not valid";if(0>t)throw"Can't represent negative numbers now";for(var n,o=e(t),i="";n=o%64,i=this._Rixits.charAt(n)+i,o=e(o/64),0!=o;);return i},toNumber:function(t){var a=0;t=t.split("");for(var n=0;n<t.length;n++)a=64*a+this._Rixits.indexOf(t[n]);return a}};return t.encode=function(e){let t=1,r=0,p=e.career.name,l=[];l[0]=o.careers[p],l[1]=e.talents[0].col,l[2]=e.talents[1].col,l[3]=e.talents[2].col,l[4]=e.talents[3].col,l[5]=e.talents[4].col,l[6]=o.weapons[p][e.items[0].type][e.items[0].name],l[7]=o.weapons[p][e.items[1].type][e.items[1].name],l[8]=o.properties[e.items[0].type][e.items[0].property[0].name][e.items[0].property[1].name],l[9]=o.properties[e.items[1].type][e.items[1].property[0].name][e.items[1].property[1].name],l[10]=o.properties[e.items[2].type][e.items[2].property[0].name][e.items[2].property[1].name],l[11]=o.properties[e.items[3].type][e.items[3].property[0].name][e.items[3].property[1].name],l[12]=o.properties[e.items[4].type][e.items[4].property[0].name][e.items[4].property[1].name],l[13]=o.traits[e.items[0].trait_type][e.items[0].trait.name],l[14]=o.traits[e.items[1].trait_type][e.items[1].trait.name],l[15]=o.traits[e.items[2].trait_type][e.items[2].trait.name],l[16]=o.traits[e.items[3].trait_type][e.items[3].trait.name],l[17]=o.traits[e.items[4].trait_type][e.items[4].trait.name];for(let o=0;o<n.length;o++)r+=t*l[o],t*=a[n[o]];let c=s.fromNumber(r);for(let t=0;t<9-c.length;t++)c="0"+c;let d=0 .toString(36);return c=d+c,c},t.decode=function(t){let o=parseInt(t.charAt(0),36),p="";for(let e=0;e<t.length-1;e++)p+=t.charAt(e+1);let l=s.toNumber(p),c=Array(n.length),d={},m=1;for(let e=0;e<n.length;e++)m*=a[n[e]];for(let o,r=0;r<n.length;r++)o=n.length-1-r,m/=a[n[o]],c[o]=e(l/m),l%=m;d.talents=[],d.items=[];let _=r.careers[c[0]],h=[],u=[],g=data.careers[_].equipment;for(let e=0;e<g.length;e++)u[e]=g[e],d.items[e]={};let f=r.weapons[_][u[0]].length;h[0]=r.weapons[_][u[0]][c[6]%f],f=r.weapons[_][u[1]].length,h[1]=r.weapons[_][u[1]][c[7]%f];let w=[];for(let e=0;e<g.length;e++)w[e]=data.weapons[h[e]]?data.weapons[h[e]].traits:u[e];d.career=_,d.talents[0]=c[1],d.talents[1]=c[2],d.talents[2]=c[3],d.talents[3]=c[4],d.talents[4]=c[5],d.items[0].weapon=h[0],d.items[1].weapon=h[1];let b=8;for(let e=0;5>e;e++){let t=e+b,a=r.properties[u[e]].length;d.items[e].properties=r.properties[u[e]][c[t]%a]}b=13;for(let e=0;5>e;e++){let t=e+b,a=r.traits[w[e]].length;d.items[e].trait=r.traits[w[e]][c[t]%a]}return d},t}function vermintedLookup(){let e={},t={};e.careers={},t.careers=[];let a=Object.keys(data.careers);for(let n=0;n<a.length;n++)e.careers[a[n]]=n,t.careers[n]=a[n];e.weapons={},t.weapons={};let n=Object.keys(data.weapons);for(let a=0;a<n.length;a++){let o=data.weapons[n[a]].type,i=Object.keys(data.weapons[n[a]].career);for(let r,s=0;s<i.length;s++){r=i[s],e.weapons[r]=e.weapons[r]||{},t.weapons[r]=t.weapons[r]||{},e.weapons[r][o]=e.weapons[r][o]||{},t.weapons[r][o]=t.weapons[r][o]||[];let p=Object.keys(e.weapons[r][o]).length;e.weapons[r][o][n[a]]=p,t.weapons[r][o][p]=n[a]}}e.properties={},t.properties={};let o=Object.keys(data.item.property_combos);for(let a,n=0;n<o.length;n++){a=o[n],e.properties[a]={},t.properties[a]=[];let i=data.item.property_combos[o[n]];for(let n=0;n<i.length;n++)e.properties[a][i[n][0]]=e.properties[a][i[n][0]]||{},e.properties[a][i[n][0]][i[n][1]]=n,e.properties[a][i[n][1]]=e.properties[a][i[n][1]]||{},e.properties[a][i[n][1]][i[n][0]]=n,t.properties[a][n]=[i[n][0],i[n][1]]}e.traits={},t.traits={};let r=Object.keys(data.item.trait_combos);for(let a=0;a<r.length;a++){e.traits[r[a]]={},t.traits[r[a]]=[];let n=data.item.trait_combos[r[a]];for(let o=0;o<n.length;o++)e.traits[r[a]][n[o]]=o,t.traits[r[a]][o]=n[o]}return e.index=t,e}function VermintedStorage(){let e,t={};return t.init=function(){e=JSON.parse(localStorage.getItem("vermintools")),e||(e={},e.builds=[])},t.get=function(){return e},t}let canvasBox=function(){let e=.1,t=450,a=document.createElement("canvas");a.style.zIndex=10,a.style.position="absolute",a.style.top=0,a.style.background="white",a.width=117,a.height=500*e;let n=a.getContext("2d");n.moveTo(0,(t-30.9375)*e),n.lineTo(101*.2,(t-62.5)*e),n.lineTo(117,(t-365.625)*e),n.stroke(),document.body.appendChild(a)};function prepPage(){constants=InitConstants();let e=document.getElementsByClassName("select-difficulty")[0],t=document.createDocumentFragment(),a=Object.keys(constants.difficulties);for(let e=0;e<a.length;e++){let n=a[e],o=document.createElement("option");o.textContent=n,o.value=n,n===verminted.difficulty&&o.setAttribute("selected",!0),t.appendChild(o)}e.appendChild(t),e.addEventListener("change",verminted.set_difficulty),verminted.update_weapon_list=[],verminted.update_weapon=[],verminted.update_on_build=[],verminted.tooltip=document.getElementsByClassName("tooltip")[0],verminted.tooltips={},verminted.weapon_buttons={},verminted.weapon_slot={};let n=document.getElementsByClassName("select-page");for(let e=0,t=n.length;e<t;e++)n[e].addEventListener("click",function(t){pageSelection(t.target)});let o=document.getElementsByClassName("build-button");for(let e=0,t=o.length;e<t;e++)o[e].addEventListener("click",function(t){verminted.build.modal.open(),t.stopPropagation()});let r=document.getElementsByClassName("input-power-level");for(let e=0;e<r.length;e++)r[e].value=verminted.power_level-185,r[e].addEventListener("change",verminted.set_power_level);let s=document.getElementsByClassName("toggle-hbfs");for(let e=0;e<s.length;e++){s[e].addEventListener("change",verminted.set_harder_better);let t=TooltipControl(s[e]);t.text`Harder, Better, Faster, Stronger\r\ndoubles elites' hp`}let p=document.getElementsByClassName("select-platform")[0],l=TooltipControl(p);l.text`PC is accurate.\r\n\r\nConsole values are estimated by\r\ncommunity and will not be 100% accurate.\r\nThese mobs only support console Legend:\r\nskaven slave\r\nskaven clan rat\r\nchaos fanatic\r\nchaos marauder`,p.addEventListener("change",verminted.set_platform);let c=document.getElementsByClassName("select-headshot-percent")[0];c.addEventListener("change",function(t){let e=t.target.valueAsNumber;e=100<e?100:0<e?e:0,c.value=e,verminted.combo_breakpoints.headshot_chance=e/100,verminted.build.refresh()});let d=TooltipControl(c);d.text`Percentage of hits that\r\nare headshots for DPS`;let m=document.getElementsByClassName("resource-title");for(let e=0;e<m.length;e++){let t=m[e],a=function(){let e=t.parentNode,a=t.parentNode.parentNode.children;for(let t,n=0;n<a.length;n++)t=a[n],t!==e&&t.classList.toggle("hide")};a(),t.addEventListener("click",a)}waitForData()}function waitForData(){verminted.finished_loading?finishPage():setTimeout(waitForData,5)}function finishPage(){verminted.compression=VermintedCompress();let e=window.location.search;if(e){let a=e.split("?");for(let e,n=0;n<a.length;n++){e=a[n];var t;"shadeult"===e?(verminted.temp_shade_ult=!0,pageSelection(document.getElementsByClassName("select-page")[1])):"compareconsole"===e?(document.getElementsByClassName("select-file")[0].addEventListener("change",compareConsole),document.getElementsByClassName("select-file")[0].classList.remove("hide")):"dontopenbuild"===e?verminted.do_not_open_build=!0:"test"===e?canvasBox():10===e.length&&(t=a[n])}}verminted.global_buffs={witch_hunter_captain_ultimate:{name:"witch_hunter_captain_ultimate",stat_buff:"crit_chance",max_stacks:1,bonus:.25},markus_mercenary_passive:data.careers.es_mercenary.passives[0],markus_huntsman_passive_crit_aura:data.careers.es_huntsman.passives[3],trinket_grenade_damage_taken:data.item.traits.trinket_grenade_damage_taken,defence_debuff_enemies:data.careers.dr_slayer.talent_tree[1][2].buffs[0],strength_potion:{name:"strength_potion",stat_buff:"has_power_boost",max_stacks:1,multiplier:1},speed_potion:{name:"speed_potion",stat_buff:"attack_speed",max_stacks:1,multiplier:.5}};let a=Object.keys(data.globals);for(let e=0,t=a.length;e<t;e++)constants[a[e]]=data.globals[a[e]];let n=populateAttackCombo();verminted.combo_breakpoint_table=n.combo,verminted.weapon_breakpoint_table=[],verminted.weapon_breakpoint_table[0]=n.weapon[0],verminted.weapon_breakpoint_table[1]=n.weapon[1],verminted.weapon_attack_breakpoints=[];for(let e=0;e<verminted.weapon_breakpoint_table.length;e++)verminted.weapon_attack_breakpoints[e]=AttackBreakpoints(verminted.weapon_breakpoint_table[e],e);populateElements(),verminted.weapon_list=WeaponListModal(),verminted.damage=WeaponDamage(),verminted.combo_breakpoints=ComboBreakpoints(verminted.combo_breakpoint_table),verminted.attack_chain=AttackChain(document.getElementsByClassName("chain-attack-container")[0]),verminted.build=BuildBuild();let o=document.getElementsByClassName("select-weapon");for(let e=0,t=o.length;e<t;e++){let t=uniqueID(o[e]),a=verminted.tooltips[t];verminted.weapon_buttons[t]=WeaponSelection(o[e]),verminted.weapon_slot[e]=document.getElementsByClassName("weapon-attacks")[e],verminted.tooltips[t]=TooltipControl(o[e]),verminted.tooltips[t].text("Weapon "+(e+1))}verminted.update_weapon[verminted.update_weapon.length]=expandWeaponInfo,t&&verminted.build.decode(t)}window.onpopstate=function(e){let t=e.state,a=t.build.build_code;a&&verminted.build.decode(t.build.build_code)};