"use strict";function DefaultSettings(){function n(){var e={power_level:r.power_level,difficulty:r.difficulty,language:r.language},t=JSON.parse(localStorage.getItem("vermintools"))||{};t.settings=e,localStorage.setItem("vermintools",JSON.stringify(t))}var r={},e=(JSON.parse(localStorage.getItem("vermintools"))||{}).settings||{};r.refresh=[];function o(){for(var e=0;e<r.refresh.length;e++)r.refresh[e]()}return r.max_targets=5,r.anim_cancel=.05,r.power_level=e.power_level||835,r.set_power_level=function(e){var t=e.target,a=t.valueAsNumber;if(isNaN(a))throw"power_level is NaN!";600<a?(a=600,t.value=600):a<15&&(a=15,t.value=15),r.power_level=a+constants.starting_power_level,o(),n()},r.difficulty=e.difficulty||"cataclysm",r.set_difficulty=function(e){var t=e.target.value;if(!constants.difficulties[t])throw"difficulty is not registered!";r.difficulty=t,o(),n()},r.harder_better=!1,r.set_harder_better=function(e){var t=!r.harder_better;e.target.value=t,r.harder_better=t,o()},r.platform=!1,r.set_platform=function(e){var t=e.target.value;r.platform="console"==t,r.difficulty="legend",o()},r.profiles={},r.language=e.language||"en",r.set_language=function(e){var t=e.target.value;t!==r.language&&(r.language=t,n(),loadLocalization(t))},r.link="manshanko.github.io",r}var verminted=DefaultSettings();function InitConstants(){var e={armor_types:["infantry","armored","monster","friendly_fire","berserker","superarmored"],armor_lookup:{infantry:0,armored:1,monster:2,friendly_fire:3,berserker:4,superarmored:5},hit_types:["neither","headshot","critical","both"],attack_types:["light","push","heavy","dot"],dual_profile:["damage_profile_right","damage_profile_left"],characters:{bw_scholar:"sienna",bw_adept:"sienna",bw_unchained:"sienna",es_mercenary:"kruber",es_huntsman:"kruber",es_knight:"kruber",dr_ranger:"bardin",dr_ironbreaker:"bardin",dr_slayer:"bardin",we_waywatcher:"kerillian",we_maidenguard:"kerillian",we_shade:"kerillian",wh_captain:"saltzpyre",wh_bountyhunter:"saltzpyre",wh_zealot:"saltzpyre"},mob_lookup:{skaven_slave:"infantry",skaven_clan_rat:"infantry",chaos_fanatic:"infantry",chaos_marauder:"infantry",beastmen_gor:"infantry",beastmen_ungor_archer:"infantry",skaven_plague_monk:"berserker",chaos_berzerker:"berserker",skaven_storm_vermin:"armored",beastmen_bestigor:"armored",chaos_raider:"infantry",chaos_warrior:"superarmored",chaos_vortex_sorcerer:"infantry",chaos_corruptor_sorcerer:"infantry",skaven_poison_wind_globadier:"infantry",skaven_gutter_runner:"infantry",skaven_warpfire_thrower:"armored",skaven_ratling_gunner:"armored",skaven_pack_master:"monster",beastmen_standard_bearer:"superarmored"},elites:{beastmen_bestigor:!0,skaven_plague_monk:!0,chaos_berzerker:!0,skaven_storm_vermin:!0,chaos_raider:!0,chaos_warrior:!0},difficulties:{cataclysm:!0,cataclysm_2:!0,cataclysm_3:!0,legend:!0,champion:!0,veteran:!0,recruit:!0}};return e}var constants=InitConstants(),UID=0,uniqueID=function(e){if(e.getAttribute("data-id"))return e.getAttribute("data-id");var t=++UID;return e.setAttribute("data-id",t),t},concateObject=function(e){var t="";if("object"==typeof e){var a,n=0;if(e.isArray){n=e.length;for(var r=0;r<n;r++)a[r]=r}else n=(a=Object.keys(e)).length;for(r=0;r<n;r++)t+=concateObject(e[a[r]])}else t+=e;return t},pageSelection=function(e){for(var t=document.getElementsByClassName(e.getAttribute("data-slot"))[0],a=document.getElementsByClassName("main-page"),n=0;n<a.length;n++)a[n]==t?a[n].classList.remove("hide"):a[n].classList.add("hide")},assembleDiv=function(e,t,a,n){var r=n?document.createElement(n):document.createElement("div");return r.classList=e,a&&(r.textContent=a),t.appendChild(r),r},populateElements=function(){document.createDocumentFragment(),document.getElementsByClassName("weapon-list")[0],Object.keys(data.weapons).sort(),constants.characters;for(var e=document.getElementsByClassName("attack")[0],t=0;t<2;t++)for(var a="[data-weapon-slot='"+t+"']",n=document.querySelector(a).getElementsByClassName("attacks-container")[0],r=0;r<9+t;r++){var o=e.cloneNode(!0);n.appendChild(o)}},LOCAL=[],LOCAL_LOOKUP={},LOCAL_WAITING=!0;function localizeText(t,e,a){var n,r=verminted.language;if(("undefined"!=typeof localization||"disabled"===r)&&(n=localization[r]&&localization[r][t],a(n),!0===LOCAL_WAITING)){LOCAL_WAITING=!1;for(var o=LOCAL.length-1;0<=o;o--)LOCAL[o](r)}if(void 0===LOCAL_LOOKUP[e]){var i=LOCAL.length;LOCAL[i]=function(e){a(localization[e]&&localization[e][t])},LOCAL_LOOKUP[e]=i}else LOCAL[LOCAL_LOOKUP[e]]=function(e){a(localization[e]&&localization[e][t])}}function loadLocalization(e){for(var t=0;t<LOCAL.length;t++)LOCAL[t](e)}var GenericMath=function(){var m={clamp:function(e,t,a){return a<=e?a:e<=t?t:e},getPowerPercentage:function(e){var t=constants.min_power_level;return(e-t)/(constants.max_power_level-t)},scalePower:function(e){var t=verminted.power_level,a=verminted.difficulty;"deathwish"===a&&(a="legend");var n=constants.difficulty_settings[a],r=n.power_level_cap,o=constants.max_power_level_cap,i=n.power_level_max_target;r<t?i&&(t=r+i*(t-r)/(o-r)):t=Math.min(t,r);var s=t;if(constants.min_power_level_cap<=t){var l;if(constants.min_power_level_cap+100<=t)l=(t-constants.min_power_level_cap)*(constants.power_level_diff_ratio[e]-1)/9;else l=(t+50*((s-200)/100-1)-constants.min_power_level_cap)*(constants.power_level_diff_ratio[e]-1)/9;s=constants.min_power_level_cap+l}else s=t;return s},getPower:function(e,t,a,n,r){var o,i=a.power_multiplier||t.power_multiplier||constants.default_power_multiplier,s=a.power_multiplier_near||t.power_multiplier_near,l=a.power_multiplier_far||t.power_multiplier_far;return o=s&&l&&0<=r?0===r?s[e]:l[e]:i[e],m.scalePower(e)*o},getCleave:function(e,t){var a=m.scalePower("cleave"),n=e.cleave_coefficient||constants.default_cleave_coefficient,r=constants.cleave.max-constants.cleave.min,o=a*n.attack,i=r*m.getPowerPercentage(o);return verminted.build.weapon[t].multipliers&&(i*=verminted.build.weapon[t].multipliers.power),i},getArmorMultiplier:function(e,t,a,n,r,o,i){var s,l=a.armor_multiplier||t.armor_multiplier||constants.default_power_multiplier,c=a.armor_multiplier_near||t.armor_multiplier_near,d=a.armor_multiplier_far||t.armor_multiplier_far;return o&&(s=o[e]),s&&s[n]?r&&s[r]||s[n]:c&&d&&0<=i?0===i?r&&0<=c[e][r]?c[e][r]:0<=c[e][n]?c[e][n]:1:r&&0<=d[e][r]?d[e][r]:0<=d[e][n]?d[e][n]:1:r&&0<=l[e][r]?l[e][r]:0<=l[e][n]?l[e][n]:1},getPowerForUnit:function(e,t,a,n,r,o,i,s){var l=e.targets&&e.targets[t]||e.default_target,c=a&&e.critical_multiplier;s&&(i=o=0);var d=m.getArmorMultiplier("attack",e,l,o,i,c,r),p=m.getPower("attack",e,l,c,r);return p*=d}};return m},WeaponDamage=function(){var N={},S=GenericMath(),A={},z={};N.getCleave=S.getCleave,S.modifyBoostCurve=function(e,t){for(var a={},n=0,r=e.length;n<r;n++)a[n]=e[n]*t;return a},S.clampCurveValue=function(e,t){var a=Object.keys(e).length-1;return t<0?e[0]:a<t?e[a]:e[t]},S.getBoostCurveMultiplier=function(e,t){var a=(Object.keys(e).length-1)*t,n=Math.floor(a),r=a-Math.floor(a),o=S.clampCurveValue(e,n-1),i=S.clampCurveValue(e,n+0),s=S.clampCurveValue(e,n+1),l=S.clampCurveValue(e,n+2);return(-o/2+3*i/2-3*s/2+l/2)*r*r*r+(o-5*i/2+2*s-l/2)*r*r+(-o/2+s/2)*r+i};N.calculateDamage=function(e,t,a,n,r,o,i,s,l,c,d,p,m){var u=data.profiles[e];if(u.no_damage)return 0;var _={headshot:!0,weakspot:!0,protected_weakspot:!0},f=u.targets&&u.targets[d]||u.default_target,v=constants.boost_curves[f.boost_curve_type]||constants.boost_curves.default,g=constants.damage_output,h=(verminted.difficulty,0),b=0,k=1,w=1+p;if(m=1+m,_[t]||a||o||i&&1<i){var y;y=1==l||4==l||5==l?1:l;var C=g.max,x=S.getPowerForUnit(u,d,a,t,r,l,c,y),L=C*S.getPowerPercentage(x);(_[t]||a)&&(k=.5*L),(o||i&&0<i)&&(h=L)}var E,B=0,N=""+verminted.difficulty+verminted.power_level+e+d+c+(0+a)+verminted.platform;z[N]?B=z[N]:(B=W.raw(u,d,a,t,r,l,c,g),z[N]=B),n&&(E=h&&B<h&&h*(n-1)||B*(n-1));var A=0,O=0;o&&(A+=[.75,.6,.5,.5,.5,.3][l]);i&&0<i&&(A+=[.75,.3,.75,.5,.5,.2][l]);_[t]&&(0<B?O+=2==l?f&&(f.headshot_boost_boss||f.headshot_boot)||.25:f&&(f.headshot_boost_armor||f.headshot_boost)||.5:5==c&&0==B?O+=f&&(f.headshot_boost_heavy_armor||.25):1==l&&0==B&&(O+=f&&(f.headshot_boost_armor||f.headshot_boost)||.5),"protected_weakspot"==t&&(O*=.25)),"protected_spot"==t&&(A-=.5,O-=.5),u&&u.no_headshot_boost&&(O=0);var I=0;if(a&&(I=u.crit_boost||.5,u.no_crit_boost&&(I=0)),v&&(0<A||0<O||0<I)){var T=f&&f.power_boost_curve_coefficient||1,M=f&&f.boost_curve_coefficient||1;if(i&&0<i&&(T*=i,M*=i),0<A){var j=N+A;z[j]?h=z[j]:(h=W.power_boost(B,h,1,A,v,T),z[j]=h)}if(0<O||0<I){var D=0<O,P=N+(O=S.clamp(O+I,0,1))+m+w+h;z[P]?b=z[P]:(b=W.headshot(B,h,k,v,M,O,D,m,I,w),z[P]=b)}}return verminted.temp_shade_ult&&2===l&&(B*=.45,h*=.5,b*=.5),B=B+h+b,E&&(B+=E),B},N.compileProfile=function(e,t,a,n,r){if(r=r||{},"raw"===a)var o=0,i=0,s=0,l=0;else{var c=""+t+(o=verminted.build.weapon[a].crit_boost)+(i=verminted.build.weapon[a].power_boost)+(s=verminted.build.weapon[a].has_power_boost)+(l=verminted.build.weapon[a].headshot_multiplier)+verminted.platform+verminted.difficulty.charAt(4)+verminted.power_level;if(A[t]===c)return;A[t]=c}for(var d=r.source_type,p={},m=constants.armor_types,u=constants.hit_types,_=verminted.max_targets,f=0,v=m.length;f<v;f++){3===f&&(f=4);var g=f,h=f;5===f&&(g=1);var b=m[f];p[b]={};for(var k=0;k<u.length;k++){var w,y,C,x=u[k];if(verminted.temp_shade_ult){var L=data.profiles[t].boost_override;w=4,2===f?(w=2,L&&(w=Math.min(L,w))):L&&(w=L)}switch(k){case 1:C=!(y="headshot");break;case 2:C=!(y=null);break;case 3:y="headshot",C=!0;break;default:y=null,C=!1}"aoe"!==d&&"dot"!==d||(y=null,C=!1),p[b][x]={};for(var E=0;E<_;E++){var B=N.calculateDamage(t,y,C,void 0,0,s,w,void 0,g,h,E,o,l);p[b][x][E]=B}}}if("raw"===a)return p;verminted.profiles[t]=verminted.profiles[t]||{},verminted.profiles[t].crit_boost=o,verminted.profiles[t].power_boost=i,verminted.profiles[t].damage=p},N.getDamage=function(e,t,a,n,r,o,i){var s,l,c,d=n;data.breeds[d]&&(n=data.breeds[d]),"object"==typeof n?(s=n.primary_armor||n.armor,l=n.race,c=n.hitzone_armor&&n.hitzone_armor.head&&("headshot"===r||"both"===r)?n.hitzone_armor.head:s):(c=s=n,l=void 0),N.compileProfile(e,t,a,0,i);var p=s;"superarmored"===s&&(p="armored");var m=verminted.build.weapon[a].multipliers,u=1;if(m){var _=data.weapons[e].type;u*=m.power,u*=m["power_"+_],u*=m.damage_taken,u+=u*(m[p]-1+((m[l]||1)-1))}var f=verminted.profiles[t].damage[c][r][o]||0;return f*=u};var W={raw:function(e,t,a,n,r,o,i,s){var l=s,c=l.max-l.min,d=S.getPowerForUnit(e,t,a,n,r,o,i),p=S.getPowerPercentage(d);return l.min+c*p},power_boost:function(e,t,a,n,r,o){var i=S.modifyBoostCurve(r,o),s=S.clamp(n,0,1),l=S.getBoostCurveMultiplier(i||r,s);return t=Math.max(Math.max(t,e),a)*l},headshot:function(e,t,a,n,r,o,i,s,l,c){var d=0,p=S.modifyBoostCurve(n,r)||n,m=S.getBoostCurveMultiplier(p,o);return d=Math.max(Math.max(t,e),a)*m,0<l&&(d*=c),i&&(d*=s),d}};return N};function buildDamageArray(e){for(var t,a=[],n=0;n<e.length;n++){var r=e[n];if(void 0!==r.attack.weapon_index&&(t=r.attack.weapon_index),a[i=a.length]={},a[i].damage=r.damage(t),a[i].hit_time=r.attack.hit_time,a[i].source_type=r.attack.source_type,r.dot)for(var o=0;o<r.dot.ticks.length;o++){var i;a[i=a.length]={},a[i].damage=r.dot.ticks[o].damage(t),a[i].hit_time=r.dot.ticks[o].hit_time}}return a.sort(function(e,t){return e.hit_time-t.hit_time}),a}var BuffArray=function(f,g){function h(e,t,a){var n=t.max_stacks;if(n){var r=a||t.name,o=e.replace(/_/g," ");if(b[e]){if(!b[e].source_lookup[o]){l=b[e].sources.length;b[e].sources[l]={},b[e].sources[l].name=o,b[e].sources[l].name_id=r,b[e].source_lookup[o]=!0}}else{var i=t.stat_buff,s=t.bonus||t.multiplier;b[e]={},b[e].sources=[],b[e].sources[0]={},b[e].sources[0].buff_name=e,b[e].sources[0].name=o,b[e].sources[0].name_id=r,b[e].source_lookup={},b[e].source_lookup[o]=!0,b[e].buff=[],b[e].buff[0]={},b[e].buff[0].stat_buff=i,b[e].buff[0].value=s,b[e].max_stacks=n,b[e].stacks=0,b[e].remove=function(){b[e].label&&(f.removeChild(b[e].label),delete b[e])},k[i]=k[i]||[];var l=k[i].length;k[i][l]=e}t.stat_buff&&(t.bonus||t.multiplier)&&function(e){var a=b[e];if(a.div){a.source_div.innerHTML="";for(i=(o=b[e].sources).length,s=0;s<i;s++){c="",d=(l=o[s]).name_id,p=l.name;1<i&&s<i-1&&(c+=",");m=document.createElement("p");localizeText(d,p,function(e){e=e||p,m.textContent=e+c}),a.source_div.appendChild(m)}}else{var t=document.createElement("label"),n=document.createElement("div");n.classList.add("buff");b[e];TooltipControl(n).text(e+"\r\n"+a.buff[0].stat_buff+"\r\n"+a.buff[0].value);var r=document.createElement("div");r.classList.add("buff-name");for(var o,i=(o=b[e].sources).length,s=0;s<i;s++){var l,c="",d=(l=o[s]).name_id,p=l.name;1<i&&s<i-1&&(c+=",");var m=document.createElement("p");localizeText(d,p,function(e){e=e||p,m.textContent=e+c}),r.appendChild(m)}var u=a.max_stacks,_=document.createElement("input");1===u?(_.type="checkbox",_.classList.add("buff-toggle"),n.addEventListener("click",function(){var e=_.checked;a.stacks=e?1:0})):1<u&&(_.type="number",_.max=u,_.min=0,_.classList.add("buff-input"),_.addEventListener("change",function(e){var t=e.target.valueAsNumber;a.stacks=0<t&&t<=u?t:0})),n.appendChild(r),n.appendChild(_),a.div=n,a.source_div=r,(a.label=t).appendChild(n),f.appendChild(t)}}(e)}}var e={},b={},k={};return e.refresh=function(){!function(){for(var e=Object.keys(b),t=0;t<e.length;t++)b[e[t]].sources=[],b[e[t]].source_lookup={}}();for(var e=g.items,t=g.talents||0,a=verminted.global_buffs,n=Object.keys(a),r=0;r<n.length;r++)h(n[r],a[n[r]]);if(g.career.name){var o=data.careers[g.career.name].passives;for(r=0;r<o.length;r++)h(o[r].name,o[r])}for(r=0;r<t.length;r++)if(t[r]&&"number"==typeof t[r].name)for(var i=0;i<t[r].buffs.length;i++){var s=t[r].buffs[i];h(s.name,s,t[r].name)}for(r=0;r<e.length;r++)if(e[r].trait.name){var l=data.item.traits[e[r].trait.name];h(e[r].trait.name,l,l.name)}var c={},d=Object.keys(b);for(r=0;r<d.length;r++){var p=d[r];if((s=b[p]).sources.length<1)b[p].remove();else{var m=s.buff[0].stat_buff;c[m]=c[m]||[];var u=c[m].length;if(c[m][u]=p,"ranged_power_vs_armor_type"===m){var _=["power_vs_unarmoured","power_vs_armoured","power_vs_large","power_vs_frenzy"];for(r=0;r<_.length;r++){var f=_[r];c[f]=k[f]||[];var v=c[f].length;c[f][v]=p}}}}k=c},e.getModifier=function(e){var t=0;if(k[e])for(var a=0;a<k[e].length;a++){var n=k[e][a],r=b[n];0<r.stacks&&(t+=r.buff[0].value*r.stacks)}return t},e};function getBreakpoint(e,t){for(var a=0,n=[],r=0,o=0;o<e.length;o++){e[o];a+=Math.round(4*e[o])/4,n[o]=e[o]/t,r+=n[o]}var i=0,s=0;if(0===a)s=0;else if(t<=a)s=1;else{var l,c,d=[];c=t%a==0?(s=t/a)/(l=t/a-1):(s=Math.ceil(t/a),t/a/(l=Math.floor(t/a)));var p=Math.ceil(t/l*4)/4;for(o=0;o<e.length;o++){d[o]=d[o]||{};n[o];e[o]?d[o].next_bp=Math.round(e[o]*c*4)/4:d[o].next_bp=0}i=c;for(var m=0;;){var u=0,_=[],f=[];for(o=0;o<d.length;o++)if(0<d[o].next_bp){if(u+=d[o].next_bp,d[o].percent=(d[o].next_bp-1/8)/e[o],!_[0]||d[o].percent>_[0].percent){for(var v=0;v<_.length;v++)_.pop();_[0]={},_[0].percent=d[o].percent,_[0].index=o}else if(d[o].percent===_[0].percent){_[m=_.length]={},_[m].percent=d[o].percent,_[m].index=o}if(!f[0]||d[o].percent<f[0].percent){var g=f.length;for(v=0;v<g;v++)f.pop();f[0]={},f[0].percent=d[o].percent,f[0].index=o}else if(d[o].percent===f[0].percent){f[m=f.length]={},f[m].percent=d[o].percent,f[m].index=o}}if(100<++m)break;if(p<u){var h=4*u-4*p;if(!(_.length<h)){i=_[0].percent;break}for(o=0;o<_.length;o++){d[b=_[o].index].next_bp=d[b].next_bp-.25}}else{if(u===p){i=_[0].percent;break}if(u<p){if(!f.length)break;for(o=0;o<f.length;o++){var b;d[b=f[o].index].next_bp=d[b].next_bp+.25}}}var k=f.length;for(o=0;o<k;o++)f.pop()}}var w={};return w.ceil=s,w.percent_needed=i,w}var ComboTimeline=function(){var e={},f=document.getElementById("timeline"),m=f.getContext("2d"),v=document.getElementById("timeline-mouse"),g=v.getContext("2d"),h=f.clientHeight,b=f.clientWidth,k=h-20,u=null,_=function(){u&&(u.classList.remove("active-breakpoint"),u=null)};return e.renderTimeline=function(e,t,a){_(),t.classList.add("active-breakpoint"),t.classList.remove("damage-change");var n=(u=t).parentNode.getBoundingClientRect(),r=n.left-(b-n.width)/2,o=n.top-h,i=e,s=Math.max(i[i.length-1].attack.hit_time+.5,.8),l=(b-0)/s,c=2,d=.5;switch(Math.floor(s/3)){case 0:c=2,d=.5;break;case 1:d=c=1;break;case 2:c=2/3,d=1.5;break;case 3:default:c=.5,d=2}m.imageSmoothingEnabled=!1,m.clearRect(0,0,b,h),m.fillStyle="#888",m.fillRect(0,0,b,k),function(e,t,a,n){for(var r=0;r<=Math.floor(e*t);r++){var o=r*a,i=Math.floor(0+o*n),s=i-11;0===r&&s--;var l=h-4;m.strokeStyle="#222",m.lineWidth=1,m.beginPath(),m.moveTo(i,0),m.lineTo(i,k),m.stroke(),m.font="18px serif",m.fillText(o.toFixed(1)+"s",s,l)}}(s,c,d,l),function(e,t){for(var a=k/2,n=buildDamageArray(e),r=0;r<e.length;r++){var o=n[r],i=Math.floor(0+o.hit_time*t);switch(o.source_type){case"direct":m.strokeStyle="red";break;case"aoe":m.strokeStyle="yellow",i++,i++;break;case"dot":m.strokeStyle="#0D0";var s=!0}var l=i-(o.hit_time-o.damage_start)*t,c=i-(o.hit_time-o.damage_end)*t;s||(m.lineWidth=1,m.beginPath(),m.moveTo(l,a),m.lineTo(c,a),m.moveTo(l,a-4),m.lineTo(l,4+a),m.moveTo(c,a-4),m.lineTo(c,4+a),m.stroke()),m.lineWidth=2,m.beginPath(),m.moveTo(i,0),m.lineTo(i,k),m.stroke()}}(i,l);var p=data.breeds[a].max_health[verminted.difficulty];m.strokeWidth="4",m.strokeStyle="black",m.strokeRect(0,0,b-0,k),function(e,t){v.style.left=e+"px",v.style.top=t+"px",g.clearRect(0,0,b,h),g.drawImage(f,0,0),v.classList.remove("hide"),v.style.display="inline-block"}(r,o),function(e,p,t,m){var a=v.getBoundingClientRect(),u=a.left,_=(a.top,buildDamageArray(e));v.onmousemove=function(e){g.imageSmoothingEnabled=!1,g.clearRect(0,0,b,h),g.drawImage(f,0,0),e.x>0+u&&(g.strokeStyle="#555",g.beginPath(),g.moveTo(e.offsetX,0),g.lineTo(e.offsetX,k),g.stroke());var t=e.offsetX,a=t,n=e.offsetY;b<a+55&&(a=b-55),n-54<0&&(n=54),g.fillStyle="#999",g.fillRect(a,n,55,-54),g.strokeStyle="#333",g.strokeRect(a,n,55,-54);for(var r=[],o=Math.ceil(t/b*p*100)/100,i=0;i<_.length;i++){var s=_[i];if(!(s.hit_time<o))break;r[i]=s.damage}var l=getBreakpoint(r,m),c=l.ceil,d=Math.ceil(1e3*l.percent_needed)/10||0;0===c&&(c="NA"),0<d&&(d-=100),g.font="18px serif",g.fillStyle="#111",g.fillText(o.toFixed(2)+"s",a+2,n-54+16),g.fillText(c,a+2,n-54+32),g.fillText(d.toFixed(1)+"%",a+2,n-54+48),v.onmouseleave=function(){g.clearRect(0,0,b,h),g.drawImage(f,0,0),v.onmouseleave=null}}}(i,s,0,p),function(){var n=function(e){for(var t=!1,a=e.target;a;){if(a===v){t=!0;break}t=!1,a=a.parentNode}t||(v.style.display="none",_(),document.body.removeEventListener("click",n))};document.body.addEventListener("click",n)}()},e},WeaponBreakpoints=function(M){var j={chain:[]};j.mob_lookup=constants.mob_lookup,j.damage_profiles=[];function C(e){var t=j.chain[e],a=data.weapons[t.weapon].actions[t.action].damage_start+data.weapons[t.weapon].actions[t.action].damage_end;a/=2;var n=t.tts+(a||0);return n/=verminted.build.weapon[t.weapon_index].attack_speed}function y(e,t,a){return function(){return function(e,t,a){var n,r=j.chain[t],o=data.weapons[r.weapon].actions[r.action],i=r.weapon_index,s=data.breeds[a];n=o.hit_mass&&constants.hit_mass[o.hit_mass][a]?s.hit_mass_counts&&s.hit_mass_counts[verminted.difficulty]?constants.hit_mass[o.hit_mass][a]*s.hit_mass_counts[verminted.difficulty]:s.hit_mass_count||99:s.hit_mass_counts&&s.hit_mass_counts[verminted.difficulty]?s.hit_mass_counts[verminted.difficulty]:s.hit_mass_count||99,"es_mercenary"===verminted.build.career.name&&(n*=.75);var l=verminted.damage.getCleave(data.profiles[e],i);return Math.ceil(l/n)}(e,t,a)}}function T(t,a,n,r,o,i,s){return o=constants.hit_types[o],function(e){return"number"==typeof e&&(n=e),verminted.damage.getDamage(t,a,n,r,o,i,s)}}function D(t,a,n){return function(e){e.stopPropagation(),verminted.timeline.renderTimeline(t,a,n)}}verminted.timeline;j.pullProfiles=function(e,t,a){var n=j.chain[a],r=(j.damage_profiles,data.weapons[e].actions[t]);if(!r)return null;var o=Object.keys(r),i=Object.keys(constants.mob_lookup),s=[];if(r.damage_profile_left&&r.damage_profile_right)s[0]={},s[0].key="damage_profile_left",s[0].value=r.damage_profile_left,s[1]={},s[1].key="damage_profile_right",s[1].value=r.damage_profile_right;else for(var l=0;l<o.length;l++){var c,d=o[l];switch(d){case"damage_profile":case"damage_profile_target":c=r[d],v="direct";break;case"damage_profile_aoe":c=r[d],d="damage_profile_knockback_aoe",v="aoe";break;case"aoe":r[d].damage_profile&&(c=r[d].damage_profile,d="damage_profile_aoe",v="aoe")}if(c){var p=s.length;s[p]={},s[p].key=d,s[p].value=c,s[p].source_type=v}}if(0<s.length){var m={};for(l=0;l<s.length;l++){var u=s[l],_=u.key,f=u.value,v=u.source_type;m[_]={},m[_].profile_name=f,m[_].source_type=v,m[_].max_targets={};for(var g=0;g<i.length;g++){var h=i[g];r.damage_profile_target&&"damage_profile"===_?m[_].max_targets[h]=function(){return verminted.max_targets}:m[_].max_targets[h]=y(f,a,h)}var b=data.profiles[f],k=0;if(b.targets[0]&&b.targets[0].dot||b.default_target.dot){var w;if(w=b.targets[0]&&b.targets[0].dot?b.targets[0].dot:b.default_target.dot,m[_].dot={},m[_].dot.profile_name=w,0===b.targets.length)k=verminted.max_targets;else for(g=0;g<b.targets.length;g++){if(!b.targets[g].dot){k=g;break}}m[_].dot.max_targets=k}}n.damage_profiles=m}},j.getAllDamage=function(){for(var e=j.chain,t=[],a=verminted.max_targets,n=0;n<a;n++){t[n]=[];for(var r=0;r<e.length;r++){var o=e[r],i=o.damage_profiles;if(i){var s=o.weapon_index,l=o.weapon,c=o.action,d=data.weapons[l].actions[c],p=C(r),m=d.damage_start+o.tts,u=d.damage_end+o.tts,_=o.hit_type||4,f=(t[n].length,[]),v=0,g=[];i.damage_profile_target?(f[v]=0===n?i.damage_profile_target:i.damage_profile,v++):i.damage_profile&&i.damage_profile_aoe?(0===n&&(f[v]=i.damage_profile,v++),f[v]=i.damage_profile_aoe,v++):i.damage_profile_left?(g[v]=i.damage_profile_left.max_targets,f[v]=i.damage_profile_left,g[++v]=i.damage_profile_right.max_targets,f[v]=i.damage_profile_right,v++):i.damage_profile&&(g[v]=i.damage_profile.max_targets,f[v]=i.damage_profile,v++);for(var h=0;h<f.length;h++){var b=f[h],k=b.profile_name,w=b.source_type,y={};t[n].length,(y={}).profile_name=k,y.hit_type=_,y.hit_time=p,y.tts=o.tts,y.damage_start=m||o.tts,y.damage_end=u||o.tts,y.source_type=w,y.weapon_index=s,y.weapon_name=l,y.action_name=c,"object"==typeof g[h]&&(y.max_targets=g[h]),data.profiles[k].targets[n]?data.profiles[k].targets[n].dot&&(y.dot=data.profiles[k].targets[n].dot):data.profiles[k].default_target&&data.profiles[k].default_target.dot&&(y.dot=data.profiles[k].default_target.dot),t[n][t[n].length]=y}}}}return t},j.buildDamageTicks=function(e,t){for(var a=constants.hit_types,n=[],r=(verminted.max_targets,0);r<e.length;r++){n[r]=[];for(var o=0;o<a.length;o++){var i=o;n[r][i]=[];for(var s=0;s<e[r].length;s++){var l=[],c={},d=(N=e[r][s]).weapon_index;if("object"==typeof N.max_targets)if(N.max_targets[t]()<=r)continue;if("string"==typeof N.dot){var p,m=N.weapon_name,u=N.action_name,_=(a[N.hit_type],data.dots[N.dot].dot_type);if("poison_dot"===_&&"neither"===i&&"aoe"!==N.source_type){var f=constants.armor_lookup[data.breeds[t].armor];p=0<(data.profiles[N.profile_name].armor_multiplier&&data.profiles[N.profile_name].armor_multiplier.attack||data.profiles[N.profile_name].armor_multiplier_near&&data.profiles[N.profile_name].armor_multiplier_near.attack)[f]}else p=!0;if(p){var v=data.dots[N.dot],g=l.length;if(1===v.max_stacks){var h=l[c[_]];if(h&&h.dot_end>N.hit_time){var b=N.hit_time+v.duration;b>h.dot_end&&(h.dot_end=b)}else l[c[_]=g]={},l[g].name=v.name,l[g].profile_name=v.damage_profile,l[g].hit_type=0,l[g].tick_rate=v.tick_rate,l[g].dot_start=N.hit_time,l[g].dot_end=N.hit_time+v.duration,l[g].source_type="dot",l[g].weapon_name=m,l[g].action_name=u}else l[g]={},l[g].name=v.name,l[g].profile_name=v.damage_profile,l[g].hit_type=0,l[g].tick_rate=v.tick_rate,l[g].dot_start=N.hit_time,l[g].dot_end=N.hit_time+v.duration,l[g].source_type="dot",l[g].weapon_name=m,l[g].action_name=u}}var k=n[r][i].length;if(n[r][i][k]={},n[r][i][k].attack=N,n[r][i][k].damage=T(N.weapon_name,N.profile_name,N.weapon_index,t,i,r,{}),l.length)for(var w=0;w<l.length;w++){var y={},C=(v=l[w],{});C.name=v.name,C.profile_name=v.profile_name,C.hit_type=0,C.tick_rate=v.tick_rate,C.dot_start=v.dot_start,C.dot_end=v.dot_end,C.source_type=v.source_type,C.weapon_name=v.weapon_name,C.action_name=v.action_name,C.ticks=[];for(var x=v.tick_rate,L=v.dot_end-v.dot_start,E=Math.floor(L/x),B=0;B<E;B++){var N=B,A=v.dot_start+x*(N+1),O=A-.25*x,I=A+.25*x;C.ticks[N]={},C.ticks[N].hit_time=A,C.ticks[N].damage_start=O,C.ticks[N].damage_end=I,C.ticks[N].damage=T(m,v.profile_name,d,t,i,r,y)}n[r][i][k].dot=C}}}}return n};function c(e,t,a){var n=j.chain,r=constants.hit_types,o=verminted.max_targets,i=verminted.difficulty,s=data.breeds[t].max_health[i];verminted.harder_better&&constants.elites[t]&&(s*=2);for(var l={},c=l=0;c<n.length;c++){var d=n[c].damage_profiles;if(d){var p=0;d.damage_profile_aoe?p=o:d.damage_profile?p=d.damage_profile.max_targets[t]():d.damage_profile_left&&(p=d.damage_profile_left.max_targets>d.damage_profile_right.max_targets?d.damage_profile_left.max_targets[t]():d.damage_profile_right.max_targets[t]()),l<p&&(l=p)}}for(var m=j.buildDamageTicks(e,t),u=0;u<o;u++)for(var _=u,f=0;f<r.length;f++){r[f];if(l<=_){for(c=_;c<o;c++)M.breeds[t].targets[c].row.classList.add("hide");break}var v=M.breeds[t].targets[_][r[f]],g=TooltipControl(v),h=t+"\r\n"+r[f],b=M.breeds[t].mob_name,k=t.replace(/_/g," ").replace(/\w+/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)});b.textContent=k+" ("+s+")";var w=buildDamageArray(m[_][f]);v.onclick=D(m[_][f],v,t);var y=[];for(c=0;c<w.length;c++){var C=c,x=w[C];y[C]=x.damage;var L=Math.round(4*y[C])/4;L,h+="\r\n"+c+" : "+L}var E=getBreakpoint(y,s),B=E.percent_needed,N=E.ceil,A=v.textContent;0===N?v.textContent=0:1===N&0===B?v.textContent=1:(h+="\r\n\r\npower needed for next bp: "+Math.ceil(1e5*(B-1))/1e3,100<(B=Math.ceil(100*B))&&(B-=100),v.textContent=N+" ("+B+"%)");var O=M.breeds[t].targets[_].row;if(v.textContent!==A)v.classList.remove("damage-change"),a[a.length]=v;else if(O.classList.contains("hide"))for(u=0;u<O.children.length;u++){var I=O.children[u];I.classList.remove("damage-change"),window.setTimeout(function(){I.classList.add("damage-change")},0)}g.text(h),O.classList.remove("hide")}var T=M.breeds[t].extra_targets;o<l?(T.textContent="+"+(l-o),T.classList.remove("hide")):T.classList.add("hide")}return j.buildBreakpoints=function(e,t){if(!(e<0)){j.chain,j.damage_profiles,constants.hit_types,verminted.difficulty;for(var a=M.container,n=Object.keys(constants.mob_lookup),r=[],o=(verminted.max_targets,j.getAllDamage()),i=0,s=n.length;i<s;i++){var l=n[i];c(o,l,r)}window.setTimeout(function(){for(var e=0;e<r.length;e++)r[e].classList.add("damage-change")},0),a.classList.remove("hide")}},j.clearAttacks=function(){for(var e=0,t=chain.length;e<t;e++)chain.pop()},j.generateCombo=function(){for(var e=0,t=chain.length;e<t;e++);},j},AttackBreakpoints=function(e,t){var r=e.container,o=WeaponBreakpoints(e),a=r.parentNode,n=a.getElementsByClassName("weapon-breakpoints-attacks")[0],s={attacks:[]};s.name_div=e.name_div,o.chain[0]={},o.chain[0].weapon_index=t,o.chain[0].tts=0;var i=function(e){var t=e.target.getAttribute("data-action");o.chain[0].action=t;o.pullProfiles(s.name,t,0),o.buildBreakpoints(0,"raw");for(var a=0;a<s.attacks.length;a++){var n=s.attacks[a];n!==e.target?n.classList.add("not-active-talent"):n.classList.remove("not-active-talent")}r.classList.remove("hide")};return o.set=function(e){o.chain[0].weapon=e,s.name=e,s.name_div.textContent=e,a.classList.remove("hide"),function(){for(var e=data.weapons[s.name].actions,t=Object.keys(e).sort(),a=[],n=0,r=0;r<t.length;r++){var o=e[t[r]];(o.damage_profile||o.damage_profile_left)&&(a[n]=t[r],n++)}for(r=0;r<s.attacks.length;r++){var i=s.attacks[r];a[r]?(i.textContent=a[r],i.setAttribute("data-action",a[r]),i.classList.remove("hide"),i.classList.remove("not-active-talent")):i.classList.add("hide")}}()},o.refresh=function(){var e=o.chain[0];s.name&&e.action&&data.weapons[e.weapon].actions[e.action]&&o.buildBreakpoints(0)},verminted.update_on_build[verminted.update_on_build.length]=o.refresh,function(){for(var e=0;e<10;e++){var t=document.createElement("div");t.classList.add("weapon-attack"),t.classList.add("js-button"),t.classList.add("hide"),t.addEventListener("click",i),s.attacks[e]=t,n.appendChild(t)}}(),o};function reverseLookup(l){if(data.weapons[l].lookup)return!1;var c={},d=data.weapons[l].actions,p=Object.keys(d),m={lookup:{}};m.lookup.default=!0,m.current=0,m.buffer=[],m.buffer[0]="default",m.future=m.current+1;var u=function(e){c[e]={};for(var t=0,a=p.length;t<a;t++){var n=d[p[t]];if(n.attack_speed&&n.attack_speed.parent)for(var r=Object.keys(n.attack_speed.parent),o=0,i=r.length;o<i;o++)m.lookup[r[o]]||(m.lookup[r[o]]=!0,m.buffer[m.future]=r[o],m.future++),e===r[o]&&(c[e][p[t]]=n.attack_speed.parent[r[o]]);if(n.attack_speed.child){var s=Object.keys(n.attack_speed.child);for(o=0,i=s.length;o<i;o++)m.lookup[s[o]]||(m.lookup[s[o]]=!0,m.buffer[m.future]=s[o],m.future++)}}m.current++,m.buffer[m.current]?(e=m.buffer[m.current],u(e)):data.weapons[l].block&&(c.block=c.block||{},c.block.push=data.weapons[l].block.min_hold,data.weapons[l].push&&(c.push=c.push||{}),c.block_cancel_end&&delete c.block_cancel_end,c.anim_cancel&&delete c.anim_cancel)};return u(m.buffer[0]),data.weapons[l].lookup=c,!0}var AttackChain=function(c){var w={anim_cancel:.05,weapon:[]},y={};w.chain=[];var e=document.getElementById("TEMPLATE-CHAIN");if(e.content)var d=e.content.firstElementChild;else d=document.getElementById("TEMPLATE-CHAIN").querySelectorAll(".chain-attack-select")[0];function p(e,t){w.chain;for(var a=[],n=0,r=0,o=w.weapon.length;r<o;r++){var i=w.weapon[r],s=data.weapons[i];if(i&&"melee"===data.weapons[i].type){if(t&&t.weapon===w.weapon[r]&&data.weapons[t.weapon].actions[t.attack]&&t.weapon_index===r){for(var l=data.weapons[t.weapon].actions,c=l[t.attack].attack_speed,d=Object.keys(c).sort(),p=[],m={},u=0;u<d.length;u++){if(l[_=d[u]]&&(l[_].damage_profile||l[_].damage_profile_left))m[p[p.length]=_]=!0}for(u=0;u<d.length;u++){var _;if(!m[_=d[u]])p[p.length]=_}u=0;for(var f=(d=p).length;u<f;u++)"block_cancel_end"!==d[u]&&(a[n]={},a[n].name=r+1+" "+d[u],a[n].attack=d[u],a[n].weapon=i,a[n].weapon_index=r,n++)}else for(var v=data.weapons[i].actions.neutral.attack_speed,g=0,h=(k=Object.keys(v)).length;g<h;g++)a[n]={},a[n].name=r+1+" "+k[g],a[n].attack=k[g],a[n].weapon=i,a[n].weapon_index=r,n++;var b=Object.keys(y[i].push);y[i].block.push;y[i].push[b[0]],a[n]={},a[n].name=r+1+" push_attack",a[n].attack=s.actions.push.push_attack,a[n].weapon=i,a[n].weapon_index=r,n++}else if(i&&"ranged"===data.weapons[i].type)if(t&&t.weapon===w.weapon[r]&&"neutral"!==t.attack){s.actions[t.attack]?c=s.actions[t.attack].attack_speed:(c=s.actions.neutral.attack_speed,"block"===t.attack?s.block.min_hold:"anim_cancel"===t.attack&&w.anim_cancel);for(u=0,f=(d=Object.keys(c)).length;u<f;u++)"block_cancel_end"!==d[u]&&(a[n]={},a[n].name=r+1+" "+d[u],a[n].attack=d[u],a[n].weapon=i,a[n].weapon_index=r,n++)}else{var k;for(v=data.weapons[i].actions.neutral.attack_speed,g=0,h=(k=Object.keys(v)).length;g<h;g++)a[n]={},a[n].name=r+1+" "+k[g],a[n].attack=k[g],a[n].weapon=i,a[n].weapon_index=r,n++}}for(u=0,f=a.length;u<f;u++)a[u].node=document.createElement("option"),a[u].node.value=a[u].weapon+","+a[u].attack+","+a[u].weapon_index,a[u].node.textContent=a[u].name,e.appendChild(a[u].node);return a}var m=verminted.combo_breakpoints,u=function(e){var t,a=w.chain;if(e.target)t=e.target;else{if(!e.value)throw"next chain had a problem";t=e}var n=t.value.split(/,/),r={};r.weapon=n[0],r.attack=n[1],r.weapon_index=parseInt(n[2],10);var o=parseInt(t.getAttribute("data-count"),10)||0,i=o+1;if(a[i])for(var s=a.length-1,l=i;l<=s;s--)c.removeChild(a[s].node),a.pop();a[i-1].weapon=n[0],a[i-1].action=n[1],a[i]={},a[i].node=c.appendChild(d.cloneNode(!0)),a[i].node.classList.remove("hide"),a[i].select=a[i].node.getElementsByClassName("chain-attack-dropdown")[0],a[i].select.setAttribute("data-count",i),p(a[i].select,r),a[i].select.addEventListener("change",u),m.addAttack(r.weapon,r.attack,r.weapon_index,o)};return w.refresh=function(){for(var e=w.chain,t=!1,a=null,n=0,r=e.length;n<r;n++){var o=e[n].select.value.split(/,/)[0];o!==w.weapon[0]&&o!==w.weapon[1]&&(t=!0),t&&(null===a&&(a=n-1),c.removeChild(e[n].node))}for(n=e.length-1,r=0;r<=n;n--)e[n].node.parentNode&&c.removeChild(e[n].node),e.pop();e[0]&&c.removeChild(e[0].node),e[0]=e[0]||{},e[0].node=c.appendChild(d.cloneNode(!0)),e[0].node.classList.remove("hide"),e[0].select=e[0].node.getElementsByClassName("chain-attack-dropdown")[0],e[0].select.setAttribute("data-count",0),p(e[0].select),e[0].select.addEventListener("change",u)},w.setWeapon=function(e,t){reverseLookup(w.weapon[t]=e),y[e]=data.weapons[e].lookup,w.refresh()},w},ComboBreakpoints=function(L){var E=WeaponBreakpoints(L);E.headshot_chance=0,E.armor_types=constants.armor_types;var y=E.buildBreakpoints,e=document.getElementsByClassName("chain-options-modal")[0],t=(e.getElementsByClassName("chain-attack-options")[0],e.parentNode.parentNode),a=ModalControl(t,e);a.close=function(){verminted.build.refresh(),t.classList.add("hide"),document.body.removeEventListener("click",a.onClick),document.body.classList.remove("no-scroll")};for(var n=document.getElementsByClassName("chain-attack-header"),r=0,o=n.length;r<o;r++)n[r].addEventListener("click",function(e){a.open(),e.stopPropagation()});document.getElementsByClassName("chain-options-modal-close")[0].addEventListener("click",a.close);function _(e){for(var t=E.chain,a=(E.damage_profiles,E.armor_types),n=L.info.damage_box,r=(L.info.damage_box.dps,["skaven_slave","skaven_storm_vermin","skaven_pack_master","","skaven_plague_monk","chaos_warrior"]),o=0,i=a.length;o<i;o++){3===o&&(o=4);var s=a[o];if(n.dps[s])var l=n.dps[s];else(l=document.createElement("div")).classList.add(E.armor_types[o]),n.dps[E.armor_types[o]]=l,n.container.appendChild(n.dps[E.armor_types[o]]);var c=TooltipControl(l),d=0;if(0<e){var p=E.getAllDamage({target:0,order:"dps"});p=E.buildDamageTicks(p,r[o],{target:0,hit:"neither"});for(var m=t[0].weapon_index,u=0;u<p.length;u++){var _,f,v=p[u],g=m=v.weapon_index||m,h=E.headshot_chance,b=verminted.build.weapon[g].crit_chance||.05;switch(data.weapons[v.weapon_name].actions[v.action_name]&&data.weapons[v.weapon_name].actions[v.action_name].extra_crit_chance&&(b+=data.weapons[v.weapon_name].actions[v.action_name].extra_crit_chance),v.hit_override){case"neither":h=b=_=0,f=1;break;default:f=1-((h-=_=h*b)+(b-=_)+_)}var k=0,w=0,y=0,C=0;0<f&&(k+=verminted.damage.getDamage(v.weapon_name,v.profile_name,g,s,"neither",0)),0<h&&(w+=verminted.damage.getDamage(v.weapon_name,v.profile_name,g,s,"headshot",0)),0<b&&(y+=verminted.damage.getDamage(v.weapon_name,v.profile_name,g,s,"critical",0)),0<_&&(C+=verminted.damage.getDamage(v.weapon_name,v.profile_name,g,s,"both",0)),d+=(k*=f)+(w*=h)+(y*=b)+(C*=_)}var x="DPS against "+s+"\r\n"+(d/=e).toFixed(2);c.text(x),l.textContent=Math.floor(10*d)/10}else l.textContent=0}}function C(){var e=E.chain,t=L.info.attack_speed,a=0,n=!1;if(1<e.length){var r=e.length-1,o=data.weapons[e[r].weapon],i=e[r].weapon_index,s=verminted.build.weapon[i].attack_speed||1;if(e[r].weapon===e[0].weapon)if(o.actions[e[r].action]&&o.actions[e[r].action].attack_speed[e[0].action]){var l=o.actions[e[r].action].timeout,c=o.actions[e[r].action].attack_speed[e[0].action]-o.actions.neutral.attack_speed[e[0].action];a+=l&&l<c?l:c/s,n=!0}else if(i!==e[0].weapon_index){l=o.actions[e[r].action].timeout,c=o.actions[e[r].action].attack_speed.anim_cancel-o.actions.neutral.attack_speed[e[0].action];a+=l&&l<c?l:c/s,n=!0}else if(o.actions.push&&e[0].action===o.actions.push.push_attack){switch(e[r].action){case"anim_cancel":case"block":a+=0;break;default:var d=o.actions[e[r].action].attack_speed.block,p=o.actions[e[r].action].damage_start+o.actions[e[r].action].damage_end;a+=d<(p/=2)?p/s:d/s}n=!0}else"anim_cancel"===e[r].action?(a+=verminted.anim_cancel,n=!0):"block"===e[r].action&&(n=!0);else a+=o.actions[e[r].action].attack_speed.anim_cancel/s,a+=verminted.anim_cancel,n=!0}for(var m=0,u=e.length;m<u;m++){i=e[m].weapon_index,c=verminted.build.weapon[i].attack_speed||1;data.weapons[e[m].weapon].actions[e[m].action]&&data.weapons[e[m].weapon].actions[e[m].action].timeout&&data.weapons[e[m].weapon].actions[e[m].action].timeout<e[m].speed*c?a+=data.weapons[e[m].weapon].actions[e[m].action].timeout:a+=e[m].speed/c}a=Math.ceil(100*a)/100,t.textContent=a+"s",n&&"number"==typeof a?(t.style.color="black",_(a)):(t.style.color="red",_(0))}var x=e.getElementsByClassName("chain-attack-options")[0],i=!(E.addAttack=function(e,t,a,n){var r=E.chain,o=E.damage_profiles;if(0===n&&({},B(!0)),n<r.length){for(var i=r[n].profile_length-1,s=o.length;i<s;s--)o[s]=null,o.pop();for(s=r.length-1;n-1<s;s--)x.removeChild(r[s].options.div),r[s]=null,r.pop()}r[n]={},r[n].weapon=e,r[n].weapon_index=a,r[n].action=t,r[n].speed=0,r[n].hit_type=4,r[n].profile_length=o.length,r[n].options={};var l=document.createElement("div");l.classList.add("attack-options");var c=document.createElement("div");c.classList.add("attack-count"),c.textContent=n+1;var d=document.createElement("div");d.classList.add("attack-name-options");var p=document.createElement("p");p.textContent=e;var m=document.createElement("span");m.textContent=t,d.appendChild(p),d.appendChild(m);var u=document.createElement("select");u.classList.add("attack-option-select"),u.classList.add("js-input"),u.addEventListener("change",function(){r[n].hit_type=parseInt(u.value)});var _=document.createElement("option");_.value=4,_.textContent="default",_.setAttribute("selected",!0),u.appendChild(_);for(s=0;s<constants.hit_types.length;s++){var f=document.createElement("option");f.value=s,f.textContent=constants.hit_types[s],u.appendChild(f)}l.appendChild(c),l.appendChild(d),l.appendChild(u),x.appendChild(l),r[n].options.div=l;var v=n;if(E.pullProfiles(e,t,n),data.weapons[e].actions[t]){if("melee"===(g=data.weapons[e]).type&&t===g.actions.push.push_attack){if(r[n].speed=g.actions.push.attack_speed[t],r[n].speed+=g.block.min_hold,0<n)if(e===r[n-1].weapon){b=0,k=0;data.weapons[r[n-1].weapon].actions[r[n-1].action]&&(b=data.weapons[r[n-1].weapon].actions[r[n-1].action].attack_speed.block,k=data.weapons[r[n-1].weapon].actions[r[n-1].action].damage_start,k+=data.weapons[r[n-1].weapon].actions[r[n-1].action].damage_end,k/=2),r[n].speed+=b<k?k:b}else{w=data.weapons[r[n-1].weapon].actions[r[n-1].action].attack_speed.anim_cancel,k=data.weapons[r[n-1].weapon].actions[r[n-1].action].damage_start;k+=data.weapons[r[n-1].weapon].actions[r[n-1].action].damage_end,k/=2,r[n].speed+=w<k?k:w}}else 0===n?r[n].speed=g.actions.neutral.attack_speed[t]:data.weapons[r[n-1].weapon].actions[r[n-1].action]?r[n].weapon_index!==r[n-1].weapon_index?(r[n].speed=g.actions.neutral.attack_speed[t],r[n].speed+=data.weapons[r[n-1].weapon].actions[r[n-1].action].attack_speed.anim_cancel):r[n].speed=g.actions[r[n-1].action].attack_speed[t]:r[n].speed=g.actions.neutral.attack_speed[t]}else{var g,h=n-1;(g=data.weapons[r[h].weapon]).actions[r[h].action];if("block"===t){var b=data.weapons[r[n-1].weapon].actions[r[n-1].action].attack_speed.block,k=data.weapons[r[n-1].weapon].actions[r[n-1].action].damage_start;k+=data.weapons[r[n-1].weapon].actions[r[n-1].action].damage_end,k/=2,r[n].speed+=b<k?k:b,r[n].speed+=g.block.min_hold}else{var w=data.weapons[r[n-1].weapon].actions[r[n-1].action].attack_speed.anim_cancel,k=data.weapons[r[n-1].weapon].actions[r[n-1].action].damage_start;k=data.weapons[r[n-1].weapon].actions[r[n-1].action].damage_end,k/=2,r[n].speed+=w<k?k:w}v-=1}for(s=r[n].tts=0;s<=n;s++)r[n].tts+=r[s].speed;y(v),C()}),B=function(e){(i=e||!i)?(L.container.getElementsByClassName("breakpoint-plate")[0].classList.remove("hide"),L.info.container.classList.remove("hide")):(L.container.getElementsByClassName("breakpoint-plate")[0].classList.add("hide"),L.info.container.classList.add("hide"))};return E.refresh=function(){var e=E.chain;e[0]&&null!==verminted.build.getWeaponIndex(e[0].weapon)&&C(),y(e.length-1)},L.container.getElementsByClassName("attack-combo-title")[0].addEventListener("click",function(){B()}),verminted.update_on_build[verminted.update_on_build.length]=E.refresh,E},TooltipControl=function(t){if(verminted.tooltips[uniqueID(t)])return verminted.tooltips[uniqueID(t)];var e={},a=null,n=verminted.tooltip,r=n.children[0],o="pre",i=null;return e.open=function(){var e=t.getBoundingClientRect();r.textContent=i,r.style.whiteSpace=o,n.style.display="inline-block",e.right+n.offsetWidth+2>window.innerWidth?n.style.left=window.innerWidth-(n.offsetWidth+2)+"px":n.style.left=e.right-0+"px",n.style.top=e.bottom+"px"},e.close=function(){n&&(n.style.display="none"),clearTimeout(a)},e.bind=function(){t.addEventListener("mouseover",e.startTimer),t.addEventListener("mouseout",e.close)},e.startTimer=function(){a=setTimeout(function(){e.open()},400)},e.text=function(e,t){o="generated"===t?"normal":"pre",i=e},e.bind(),verminted.tooltips[uniqueID(t)]=e},ModalControl=function(r,o){var i={clickCallback:null,closeCallback:null};i.modal=r;var t=!0;return i.open=function(){r.classList.remove("hide"),i.bind();var e=r.children[0];t?t=!1:e.scrollTo&&e.scrollTo(0,0),document.body.classList.add("no-scroll")},i.setClickCallback=function(e){i.clickCallback=e},i.setCloseCallback=function(e){i.closeCallback=e},i.close=function(){null!==i.closeCallback&&i.closeCallback(),r.classList.add("hide"),document.body.removeEventListener("click",i.onClick),document.body.classList.remove("no-scroll")},i.onClick=function(e){e.stopPropagation();var t=e.target,a=!1;if(o)var n=o;else n=r;for(;t&&t.classList;){if(t===n||t.classList.contains("weapon-list-holder")){a=!1;break}if(t===document.body){a=!0;break}t=t.parentNode}a&&i.close()},i.bind=function(){document.body.addEventListener("click",i.onClick)},i},BuildBuild=function(){var l=document.getElementsByClassName("build-modal")[0].parentNode.parentNode,C={career:{}};C.career.name,C.career.multipliers={},C.items=[],C.weapon=[],C.weapon_lookup={},C.update_on_close=verminted.update_on_build;var x={};x.container=document.getElementsByClassName("weapon-list")[0],x.modal=verminted.weapon_list,x.lookup={},x.weapon={},x.property_combos={};document.getElementsByClassName("buff-container")[0],document.getElementsByClassName("weapon-breakpoints-container");for(var s,L={},k=[],w=[],e=0;e<data.careers.bw_scholar.talent_tree.length;e++)w[e]={};var f={power_vs_unarmoured:"infantry",power_vs_armoured:"armored",power_vs_large:"monster",power_vs_frenzy:"berserker",power_vs_skaven:"skaven",power_vs_chaos:"chaos",power_level:"power"},c=verminted.compression;C.modal=ModalControl(l,document.getElementsByClassName("build-modal")[0]),document.getElementsByClassName("build-modal-close")[0].addEventListener("click",C.modal.close);function E(t,e){var a=e.id,n=e.fallback;localizeText(a,e.key,function(e){e=e||n,t.textContent=e})}function d(e,t){return function(){r(e,t)}}function y(e){var t,a,n=C.items;a=C.career.name?(t=data.careers[C.career.name]).equipment:data.careers.dr_ranger.equipment;for(var r=0,o=n.length;r<o;r++){var i,s=a[r];if("dr_slayer"===C.career.name&&"throwing_axes"===n[r].name&&(s="ranged"),i=data.weapons[n[r].name]?data.weapons[n[r].name].traits:1===r?"ranged_ammo":a[r],L[t]);else{if(n[r].type===s&&n[r].trait_type===i&&!e)continue;n[r].type=s,n[r].trait_type=i;for(var l=0,c=n[r].property.length;l<c;l++){for(var d=0,p=n[r].property[l].options.length;d<p;d++){var m=n[r].property[l].options.length-1;n[r].property[l].select.removeChild(n[r].property[l].options[m]),n[r].property[l].options.pop()}var u=s;"ranged_ammo"!==u&&"ranged_heat"!==u||(u="ranged");var _=document.createDocumentFragment(),f=Object.keys(x.property_combos[u]).sort(),v=!1;for(d=0,p=f.length;d<p;d++){var g=f[d],h=((w=document.createElement("option")).value=g)+r+l;E(w,{id:data.item.properties[g].name,fallback:g,key:h}),n[r].property[l].name&&g===n[r].property[l].name&&(w.setAttribute("selected",!0),v=!0),n[r].property[l].options[d]=w,_.appendChild(w)}!v&&n[r].property[l].name&&(n[r].property[l].name=f[0]),n[r].property[l].select.appendChild(_)}if(-1<r){var b=n[r].trait.options.length;if(0<b)for(l=0;l<b;l++){m=b-1-l;n[r].trait.select.removeChild(n[r].trait.options[m]),n[r].trait.options.pop()}_=document.createDocumentFragment();var k=data.item.trait_combos[i].sort();for(v=!1,l=0,c=data.item.trait_combos[i].length;l<c;l++){var w,y=k[l];h=((w=document.createElement("option")).value=y)+r;E(w,{id:data.item.traits[y].name,fallback:y,key:h}),n[r].trait.name&&y===n[r].trait.name&&(w.setAttribute("selected",!0),v=!0),n[r].trait.options[l]=w,_.appendChild(w)}!v&&n[r].trait.name&&(n[r].trait.name=k[0]),n[r].trait.select.appendChild(_)}}}}function B(t,e){var a=e.id,n=e.fallback;localizeText(a,e.key,function(e){e?t.text(e,"generated"):t.text(n)})}function v(e){var t=A.getModifier(e);if(data.careers[C.career.name])if(f[e]){for(var a=0;a<w.length;a++)if(w[a].buffs)for(var n=0;n<w[a].buffs.length;n++){e!==(r=w[a].buffs[n]).stat_buff||r.max_stacks||(t+=r.multiplier)}}else{t+=C.career[e]||0;for(a=0;a<w.length;a++)if(w[a].buffs)for(n=0;n<w[a].buffs.length;n++){var r;e!==(r=w[a].buffs[n]).stat_buff||r.max_stacks||("crit_chance"===r.stat_buff?t+=r.bonus:t+=r.multiplier)}}else"crit_chance"===e&&(t+=.05);return t}var p=function(e,t){if(C.career.name&&!t){var a=C.items,n={};n.career=C.career.name,n.items=[];for(var r=0;r<5;r++)n.items[r]={},r<2&&(n.items[r].weapon=a[r].name),n.items[r].properties={},n.items[r].properties[0]=a[r].property[0].name,n.items[r].properties[1]=a[r].property[1].name,n.items[r].trait=a[r].trait.name;n.talents=[];for(r=0;r<w.length;r++)n.talents[r]=w[r].col;L[C.career.name]=n}C.career.name=e,C.career.crit_chance=data.careers[e].base_crit_chance,C.career.attack_speed=data.careers[e].base_attack_speed||0,C.career.reload_speed=data.careers[e].base_reload_speed||0,C.career.headshot_multiplier=data.careers[e].base_headshot_multiplier||0,C.career.backstab_multiplier=data.careers[e].base_backstab_multiplier||0,y();var o=data.careers[e].talent_tree;if(L[e]&&!t)N(L[e]);else for(var i=0;i<o.length;i++){var s=i;w[s]={};for(var l=0;l<o[s].length;l++){var c,d=l,p=o[s][d],m=void 0;if(!m&&p.buffs){m="";for(r=0;r<p.buffs.length;r++){0<r&&(m+="\r\n");var u=p.buffs[r];m+=u.name+"\r\n",u.stat_buff&&(m+="property: "+u.stat_buff+"\r\n"),(u.bonus||u.multiplier)&&(m+="bonus: "+(u.bonus||u.multiplier)+"\r\n"),u.max_stacks&&(m+="max stacks: "+u.max_stacks+"\r\n")}}c=p.buffs[0]&&p.buffs[0].name?p.buffs[0].name.replace(/_/g," "):s+"-"+d,k[s][d].div.classList.remove("not-active-talent");var _=k[s][d].div,f=TooltipControl(k[s][d].div),v=c,g=m,h="talentdesc"+s+d,b="talentname"+s+d;B(f,{id:p.description,fallback:g,key:h}),E(_,{id:p.name,fallback:v,key:b})}}A.refresh()},r=function(e,t){var a=C.career.name;if(a){var n={power_level:"power"},r={attack_speed:"attack_speed",reload_speed:"reload_speed",critical_strike_chance:"crit_chance",backstab_multiplier:"backstab_multiplier"},o=data.careers[a].talent_tree;w[e]=o[e][t],w[e].col=t;var i=w[e];if(i.stat_buff&&(i.max_stacks||i.chunk_size));else for(var s=0;s<6;s++)if(w[s]&&w[s].stat_buff){var l=w[s].stat_buff;n[l]?(0===s&&(C.career.multipliers[n[l]]=0),C.career.multipliers[n[l]]+=w[s].multiplier):r[l]&&(0===s&&(C.career[r[l]]=0),C.career[r[l]]+=w[s].multiplier)}for(s=0;s<o[e].length;s++)s!==t?k[e][s].div.classList.add("not-active-talent"):k[e][s].div.classList.remove("not-active-talent");A.refresh()}},_=function(e,t,a){var n=C.items;n[t].name=e,verminted.weapon_attack_breakpoints[t].set(e),n[t].weapon.div.textContent=e,y(),verminted.attack_chain.setWeapon(e,t)},m=function(e,t,a){var n=C.items;n[t].property[a].name=e,n[t].property[a].value=data.item.properties[e].value[1],function(e){var t=C.items,a=[];a[0]=t[e].property[0].select.value,a[1]=t[e].property[1].select.value;for(var n=t[e].type,r=x.property_combos[n],o=0,i=t[e].property.length;o<i;o++)for(var s=0,l=t[e].property[o].options.length;s<l;s++){var c=t[e].property[o].options[s].value;r&&r[a[(o+1)%2]]?r[a[(o+1)%2]][c]?t[e].property[o].options[s].removeAttribute("disabled"):t[e].property[o].options[s].setAttribute("disabled",!0):t[e].property[o].options[s].removeAttribute("disabled")}}(t)};C.getMultipliers=function(e){for(var t=C.items,a=C.weapon,n=C.weapon_lookup,r=[],o=0,i=t.length;o<i;o++){if("charm"===t[o].type||"trinket"===t[o].type)r[r.length]=t[o]}for(o=0;o<n.length;o++)n.pop();for(o=0,i=t.length;o<i;o++){var s=t[o].name;if(a[o]={},s||data.weapons[t[o].name]){a[n[s]=o].name=s,a[o].multipliers={},a[o].attack_speed=1+v("attack_speed"),a[o].reload_speed=1+v("reload_speed"),a[o].crit_boost=v("crit_boost"),a[o].power_boost=v("power_boost"),a[o].crit_chance=v("crit_chance"),a[o].headshot_multiplier=v("headshot_multiplier"),a[o].backstab_multiplier=v("backstab_multiplier"),a[o].has_power_boost=v("has_power_boost");for(var l=Object.keys(f),c=0,d=l.length;c<d;c++)a[o].multipliers[f[l[c]]]=1+v(l[c]);data.weapons[s].type;a[o].multipliers.power_melee=1+v("power_level_melee"),a[o].multipliers.power_ranged=1+v("power_level_ranged"),a[o].multipliers.damage_taken=1+v("damage_taken");for(c=0,d=r.length+1;c<d;c++)for(var p,m=0,u=(p=r[c]?r[c].property:t[o].property).length;m<u;m++){var _=p[m];f[_.name]?a[o].multipliers[f[_.name]]+=_.value:"attack_speed"===_.name?a[o].attack_speed+=_.value:"crit_boost"===_.name?a[o].crit_boost+=_.value:"crit_chance"===_.name&&(a[o].crit_chance+=_.value)}}}return a},C.getWeaponIndex=function(e){C.items,C.weapon;var t=C.weapon_lookup;return 0<=t[e]||C.getMultipliers(),t[e]},C.refresh=function(){C.weapon;C.getMultipliers();for(var e=0,t=verminted.update_on_build.length;e<t;e++)verminted.update_on_build[e]()};C.encode=function(e){var t={};if(t.career=C.career,t.talents=w,t.items=C.items,t.career&&t.career.name){e.classList.remove("failed-copy");var a=c.encode(t),n="?"+a;e.textContent=n;var r=verminted.link+n,o=document.createElement("textarea");o.classList="hide",o.value=r,e.appendChild(o),o.focus(),o.select(),document.execCommand("copy"),e.removeChild(o);var i=document.createRange();i.selectNodeContents(e);var s=window.getSelection();s.removeAllRanges(),s.addRange(i),a!==C.build_code&&(history.pushState({build:{build_code:a}},"",n),C.build_code=a)}else e.classList.add("failed-copy")},C.decode=function(e){var t=verminted.compression.decode(e);N(t),C.build_code=e};var t,N=function(e){if(p(e.career,!0),e.items){e.items[0]&&e.items[0].weapon&&_(e.items[0].weapon,0),e.items[1]&&e.items[1].weapon&&_(e.items[1].weapon,1);for(var t=0;t<e.items.length;t++)e.items[t]&&e.items[t].properties&&(e.items[t].properties[0]&&m(e.items[t].properties[0],t,0),e.items[t].properties[1]&&m(e.items[t].properties[1],t,1)),e.items[t]&&e.items[t].trait&&(C.items[t].trait.name=e.items[t].trait)}if(e.talents)for(t=0;t<e.talents.length;t++)if("number"==typeof e.talents[t]){var a=t,n=e.talents[t];r(a,n)}!function(){for(var e=0;e<s.length;e++){var t=s[e];t.value===C.career.name?t.setAttribute("selected",!0):t.removeAttribute("selected",!1)}y()}(),y(!0)},A=BuffArray(l.getElementsByClassName("buff-container")[0],C);return C.test=A,C.modal.setCloseCallback(C.refresh),function(){verminted.update_weapon[verminted.update_weapon.length]=_;for(var e=x.container,t=Object.keys(data.weapons).sort(),a=document.createDocumentFragment(),n=0,r=t.length;n<r;n++){for(var o=t[n],i=data.weapons[o].type,s=Object.keys(data.weapons[o].career),l=0,c=s.length;l<c;l++){var d=s[l],p=i;"dr_slayer"===d&&"throwing_axes"===o&&(p="melee"),x.lookup[d]=x.lookup[d]||{},x.lookup[d][p]=x.lookup[d][p]||[];var m=x.lookup[d][p].length;x.lookup[d][p][m]=o}var u=document.createElement("div");u.classList.add("weapon-list-weapon-name"),u.classList.add("js-button"),u.setAttribute("data-weapon",o),u.textContent=o,x.weapon[o]={},x.weapon[o].div=u,a.appendChild(u)}e.appendChild(a)}(),function(){for(var e=l.getElementsByClassName("select-career")[0],t=document.createDocumentFragment(),a=Object.keys(data.careers).sort(),n=0,r=a.length;n<r;n++){var o=a[n],i=document.createElement("option");i.value=o,E(i,{id:data.careers[o].name,fallback:o,key:"career"+n}),t.appendChild(i)}e.appendChild(t),e.addEventListener("change",function(e){p(e.target.value)}),s=e}(),function(){var e=l.getElementsByClassName("career-and-gear")[0],t=C.items;t[0]={},t[0].container=e.getElementsByClassName("item-container")[0];for(var a=t[0].container.cloneNode(!0),n=0;t.length<5;){if(0!==n&&(t[n]={},t[n].container=t[n].container||a.cloneNode(!0),1<n&&(t[n].container.textContent=data.careers.dr_ranger.equipment[n]),4===n&&t[n].container.classList.add("item-container-last")),n<2){var r=document.createElement("div");r.classList.add("select-weapon"),r.classList.add("js-button"),r.setAttribute("data-weapon-select",n),t[n].weapon={},t[n].weapon.div=r,t[n].weapon.div.textContent="Weapon "+(n+1),t[n].container.classList.add("item-weapon"),t[n].container.appendChild(r)}t[n].property=[];for(var o=0;o<2;o++){(i=document.createElement("select")).classList.add("select-property"),i.classList.add("js-input"),i.setAttribute("data-item-slot",n),i.setAttribute("data-property-slot",o),i.innerHTML="<option selected disabled hidden>Property</option>",i.addEventListener("change",function(e){var t=e.target.getAttribute("data-item-slot"),a=e.target.getAttribute("data-property-slot"),n=e.target.value;m(n,t,a)}),t[n].property[o]={},t[n].property[o].select=i,t[n].property[o].options=[],t[n].container.appendChild(i)}for(o=0;o<1;o++){var i;(i=document.createElement("select")).classList.add("select-trait"),i.classList.add("js-input"),i.innerHTML="<option selected disabled hidden>Trait</option>",t[n].trait={},t[n].trait.select=i,t[n].trait.options=[],t[n].trait.name=null;var s=t[n].trait;i.addEventListener("change",function(e){var t=e.target.value;s.name=t;data.item.traits[t];A.refresh()}),t[n].container.appendChild(i)}e.appendChild(t[n].container),n++}}(),function(){for(var e=l.getElementsByClassName("talent-tree")[0],t=document.createDocumentFragment(),a=data.careers.dr_ranger.talent_tree.length,n=0;n<a;n++){k[n]=[];var r=document.createElement("div");r.classList.add("talent-row");for(var o=0;o<3;o++){var i=document.createElement("div");i.classList.add("talent"),i.classList.add("js-button"),k[n][o]={},k[n][o].div=i,r.appendChild(i);i.addEventListener("mousedown",d(n,o))}t.appendChild(r)}e.appendChild(t)}(),(t=document.getElementsByClassName("copy-build")[0]).addEventListener("click",function(e){C.encode(t)}),TooltipControl(t).text("Copies a url for this build containing\r\nselected career, items, and talents.\r\n\r\nOnly works with valid combinations."),function(){for(var e={},t=Object.keys(data.item.property_combos),a=0,n=t.length;a<n;a++){e[t[a]]={};for(var r=data.item.property_combos[t[a]],o=0,i=r.length;o<i;o++)e[t[a]][r[o][0]]=e[t[a]][r[o][0]]||{},e[t[a]][r[o][0]][r[o][1]]=!0,e[t[a]][r[o][1]]=e[t[a]][r[o][1]]||{},e[t[a]][r[o][1]][r[o][0]]=!0}x.property_combos=e}(),A.refresh(),y(),C.getMultipliers(),verminted.refresh[verminted.refresh.length]=C.refresh,verminted.update_weapon_list[verminted.update_weapon_list.length]=function(e){var t=C.career.name,a=Object.keys(x.weapon),n={};if(t)for(var r=e.target.getAttribute("data-weapon-select"),o=t,i=data.careers[o].equipment[r],s=x.lookup[o][i],l=0,c=s.length;l<c;l++)n[s[l]]=!0;else for(l=0,c=a.length;l<c;l++)n[a[l]]=!0;for(l=0,c=a.length;l<c;l++)n[a[l]]?x.weapon[a[l]].div.classList.remove("hide"):x.weapon[a[l]].div.classList.add("hide")},verminted.do_not_open_build?window.setTimeout(function(){C.refresh()},100):C.modal.open(),C},WeaponListModal=function(){var r=ModalControl(document.getElementsByClassName("weapon-list-holder")[0]);return r.onClick=function(e){e.stopPropagation();for(var t=e.target,a=!0;t&&t.classList;){if(t.classList.contains("weapon-list-holder")){a=!1;break}if(t.getAttribute("data-weapon")){var n=t.getAttribute("data-weapon");r.clickCallback(n),a=!0;break}t.classList.contains("select-weapon")&&(a=!1),t=t.parentNode}a&&r.close()},r},WeaponSelection=function(i){var e={},r=verminted.weapon_list,s=verminted.attack_chain;e.update=[];function o(e){var t=i.getAttribute("data-weapon-select"),a=verminted.weapon_slot[t];i.textContent=e,i.setAttribute("data-input",e);for(var n=verminted.update_weapon,r=0,o=n.length;r<o;r++)n[r](e,t,a);s.setWeapon(e,parseInt(i.getAttribute("data-weapon-select"),10))}return i.addEventListener("click",function(e){r.setClickCallback(o);for(var t=verminted.update_weapon_list,a=0,n=t.length;a<n;a++)t[a](e);r.open()}),e};function populateAttackCombo(e,t){function a(s,l){var c={},d=document.createElement("div"),e=document.createElement("div");e.classList.add("mob-name"),e.textContent=s,c.mob_name=e,d.appendChild(e),c.targets=[];for(var t=0;t<u;t++){var a=document.createElement("div");a.classList.add("breakpoint-row"),c.targets[t]={},c.targets[t].row=a;for(var n=0;n<m.length;n++){var r=m[n],o=document.createElement("div");o.classList.add("breakpoint"),o.classList.add(r),c.targets[t][r]=o,a.appendChild(o)}d.appendChild(a)}var i=document.createElement("div");i.classList.add("extra-target-row"),i.classList.add("hide"),c.extra_targets=i,d.appendChild(i),c.container=d;var p=verminted.callback_on_data.length;return verminted.callback_on_data[p]=function(){data.breeds;var e,t=data.breeds[s],a=t.primary_armor||t.armor;e=t.hitzone_primary_armor?t.hitzone_primary_armor.head:t.hitzone_armor?t.hitzone_armor.head:a;for(var n=0;n<c.targets.length;n++){c.targets[n].row;for(var r=0;r<m.length;r++){var o,i=m[r];o="headshot"===i||"both"===i?e:a,c.targets[n][i].classList.add(o)}}l.appendChild(d)},c}var n={},r=Object.keys(constants.mob_lookup),m=constants.hit_types,u=(constants.armor_types,verminted.max_targets);n.weapon=[];for(var o=document.getElementsByClassName("weapon-breakpoints-container"),i=0;i<o.length;i++){var s,l=o[i].getElementsByClassName("weapon-breakpoints")[0];n.weapon[i]={},n.weapon[i].container=l,n.weapon[i].name_div=o[i].getElementsByClassName("weapon-name")[0],(s=document.createElement("div")).classList.add("breakpoint-plate");for(var c={},d=0,p=r.length;d<p;d++){var _=a(r[d],s);c[r[d]]=_}n.weapon[i].breeds=c;!function(){var e=s,t=o[i].getElementsByClassName("weapon-breakpoints-attacks")[0],a=!0;n.weapon[i].name_div.addEventListener("click",function(){(a=!a)?(t.classList.remove("hide"),e.classList.remove("hide")):(t.classList.add("hide"),e.classList.add("hide"))})}(),l.appendChild(s)}n.combo={},n.combo.container=document.getElementsByClassName("attack-combo")[0],n.combo.info={},n.combo.info.container=document.createElement("div"),n.combo.info.container.classList.add("combo-info"),n.combo.info.container.classList.add("hide"),n.combo.info.attack_speed=document.createElement("div"),n.combo.info.damage_box={},n.combo.info.damage_box.container=document.createElement("div"),n.combo.info.damage_box.dps={},n.combo.info.damage_box.container.classList.add("combo-damage-box"),n.combo.info.container.appendChild(n.combo.info.attack_speed),n.combo.info.container.appendChild(n.combo.info.damage_box.container),n.combo.breeds={},(s=document.createElement("div")).classList.add("breakpoint-plate"),s.classList.add("hide");for(c={},d=0,p=r.length;d<p;d++){_=a(r[d],s);c[r[d]]=_}return n.combo.breeds=c,n.combo.container.appendChild(n.combo.info.container),n.combo.container.appendChild(s),n}var VermBigInt=function(){var e={},p=1e5;e.printraw=function(e){for(var t="",a=0;a<e.length;a++){for(var n=""+e[a];n.length<5&&a<e.length-1;)n="0"+n;t=n+t}console.log(t)};function r(e,t){var a,n,r=[];e.length>t.length?(a=e,n=t):(n=e,a=t);for(var o=0,i=0;i<a.length||0<o;i++){var s=(a[i]||0)+(n[i]||0)+o;p<=s?s-=(o=1)*p:o=0,r[i]=s}return r}function o(e,t){var a,n=[];a=e.length>=t.length?e:t;for(var r=0,o=0;o<a.length;o++){var i=(e[o]||0)-((t[o]||0)+r);i<0?"number"==typeof e[o+1]&&(r=1,i+=p,n[o]=i):0<i?(r=0,n[o]=i):e[o+1]?(r=0,n[o]=0):r=0}return n}function i(e,t){if(e.length>t.length)return!0;if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++){var n=e.length-1-a,r=e[n],o=t[n];if(o<r)return!0;if(r<o)return!1}return!0}return e.biNew=function(e){var t=Math.floor(e),a=[],r=function(e,t,a){for(;;){if(!(p<=t))return e[a]=t;var n=Math.floor(t/p);t-=r(e,n,a+1)*p}};return r(a,t,0),a},e.add=function(e,t){return r(e,t)},e.sub=function(e,t){return o(e,t)},e.mul=function(e,t){for(var a=e,n=1;n<t;n++)a=r(a,e);return 0!==a.length&&0!==t||((a=[])[0]=0),a},e.div=function(e,t){var a=0,n=e;if("object"==typeof t)for(;i(n,t)&&a<30;)n=o(n,t),a++;else{var r=function(e,t){for(var a=[0],n=0,r=0,o=0;o<e.length;o++){var i=e.length-1-o,s=e[i]/t,l=n;if(p<(n=(r=s%1+l%1)*p)){var c=Math.floor(n/p);n-=c*p,r-=c,l+=c}var d=s-s%1+(l-l%1);0<d&&(a[i]=d)}return[a,r]}(e,t);n=r[0],a=Math.ceil(r[1]*t)%t}return[n,a]},e},BigInt=BigInt;function VermintedCompress(){var v={},g={career:15,talent1:3,talent2:3,talent3:3,talent4:3,talent5:3,talent6:3,wep1:10,wep2:8,wep1props:27,wep2props:27,neckprops:20,charmprops:25,trinketprops:21,wep1traits:7,wep2traits:7,necktraits:5,charmtraits:5,trinkettraits:3},h=["career","talent1","talent2","talent3","talent4","talent5","talent6","wep1","wep2","wep1props","wep2props","neckprops","charmprops","trinketprops","wep1traits","wep2traits","necktraits","charmtraits","trinkettraits"],b=VermBigInt();void 0===BigInt?(v.big_int=!1,BigInt=function(e){return e}):v.big_int=!0;var k={_Rixits:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_",toNumber:function(e){var t=0;e=e.split("");for(var a=0;a<e.length;a++)t=64*t+this._Rixits.indexOf(e[a]);return t},fromBigInt:function(e){for(var t,a="",n=e;t=Number(n%BigInt(64)),a=this._Rixits.charAt(t)+a,(n/=BigInt(64))!=BigInt(0););return a},fromVBI:function(e){for(var t,a="",n=0,r=e;;){var o=b.div(r,64);if(t=o[1],a=this._Rixits.charAt(t)+a,1===(r=o[0]).length&&0===r[0]||0===r.length||15<n)break;n++}return a},toBigInt:function(e){var t=BigInt(0);e=e.split("");for(var a=0;a<e.length;a++)t=t*BigInt(64)+BigInt(this._Rixits.indexOf(e[a]));return t},toVBI:function(e){var t=[0];e=e.split("");for(var a=0;a<e.length;a++)t=b.add(b.mul(t,64),[this._Rixits.indexOf(e[a])]);return t}};return v.encode=function(e){for(var t=vermintedLookup(63),a=e.career.name,n=[],r=[],o=[],i=0;i<e.items.length;i++)r[i]=e.items[i].type,"dr_slayer"===a&&"throwing_axes"===e.items[i].name?o[i]="melee":o[i]=r[i];return n[0]=t.careers[a],n[1]=e.talents[0].col,n[2]=e.talents[1].col,n[3]=e.talents[2].col,n[4]=e.talents[3].col,n[5]=e.talents[4].col,n[6]=e.talents[5].col,n[7]=t.weapons[a][o[0]][e.items[0].name],n[8]=t.weapons[a][o[1]][e.items[1].name],n[9]=t.properties[r[0]][e.items[0].property[0].name][e.items[0].property[1].name],n[10]=t.properties[r[1]][e.items[1].property[0].name][e.items[1].property[1].name],n[11]=t.properties[r[2]][e.items[2].property[0].name][e.items[2].property[1].name],n[12]=t.properties[r[3]][e.items[3].property[0].name][e.items[3].property[1].name],n[13]=t.properties[r[4]][e.items[4].property[0].name][e.items[4].property[1].name],n[14]=t.traits[e.items[0].trait_type][e.items[0].trait.name],n[15]=t.traits[e.items[1].trait_type][e.items[1].trait.name],n[16]=t.traits[e.items[2].trait_type][e.items[2].trait.name],n[17]=t.traits[e.items[3].trait_type][e.items[3].trait.name],n[18]=t.traits[e.items[4].trait_type][e.items[4].trait.name],function(e){var t="";if(v.big_int){for(var a=BigInt(1),n=BigInt(0),r=0;r<h.length;r++)n+=a*BigInt(e[r]),a*=BigInt(g[h[r]]);var o=(t=k.fromBigInt(n)).length;for(r=0;r<10-o;r++)t="0"+t}else{for(a=[1],n=[0],r=0;r<h.length;r++){var i=b.mul(a,e[r]);n=b.add(n,i),a=b.mul(a,g[h[r]])}for(o=(t=k.fromVBI(n)).length,r=0;r<10-o;r++)t="0"+t}return t}(n)},v.decode=function(e){for(var t=vermintedLookup(63).index,a=0;a<e.length;a++)e.charAt(a);var n=function(e){var t=new Array(h.length);if(v.big_int){for(var a=Number,n=k.toBigInt(e),r=BigInt(1),o=0;o<h.length;o++)r*=BigInt(g[h[o]]);for(o=0;o<h.length;o++){var i=n/(r/=BigInt(g[h[l=h.length-1-o]]))%BigInt(g[h[l]]);t[l]=a(i),n%=r}}else{n=k.toVBI(e),r=[[1]];var s=[1];for(o=0;o<h.length;o++)s=b.mul(s,g[h[o]]),r[o+1]=s;for(o=0;o<h.length;o++){var l=h.length-1-o;i=(n=b.div(n,r[l]))[1];t[l]=i,n=n[0]}}return t}(e),r={talents:[],items:[]},o=t.careers[n[0]],i=[],s=[],l=data.careers[o].equipment;for(a=0;a<l.length;a++)s[a]=l[a],r.items[a]={};var c=t.weapons[o][s[0]].length;i[0]=t.weapons[o][s[0]][n[7]%c],c=t.weapons[o][s[1]].length,i[1]=t.weapons[o][s[1]][n[8]%c];var d=[];for(a=0;a<l.length;a++)data.weapons[i[a]]?d[a]=data.weapons[i[a]].traits:d[a]=s[a];r.career=o,r.talents[0]=n[1],r.talents[1]=n[2],r.talents[2]=n[3],r.talents[3]=n[4],r.talents[4]=n[5],r.talents[5]=n[6],r.items[0].weapon=i[0],r.items[1].weapon=i[1];var p=9;for(a=0;a<5;a++){var m=a+p,u=t.properties[s[a]].length,_=s[a];"dr_slayer"===o&&"throwing_axes"===i[a]&&(_="ranged"),r.items[a].properties=t.properties[_][n[m]%u]}p=14;for(a=0;a<5;a++){m=a+p;var f=t.traits[d[a]].length;r.items[a].trait=t.traits[d[a]][n[m]%f]}return r},v}function vermintedLookup(e){var t={},a={},n=Object.keys(data.careers).sort(),r=Object.keys(data.weapons).sort(),o=Object.keys(data.item.property_combos),i=Object.keys(data.item.trait_combos);t.careers={},a.careers=[];for(var s=0;s<n.length;s++)t.careers[n[s]]=s,a.careers[s]=n[s];t.weapons={},a.weapons={};for(s=0;s<r.length;s++){var l=data.weapons[r[s]].type;if(e<1)var c=Object.keys(data.weapons[r[s]].career);else c=Object.keys(data.weapons[r[s]].career).sort();for(var d=0;d<c.length;d++){var p=c[d],m=l;"dr_slayer"===p&&"throwing_axes"===r[s]&&(m="melee"),t.weapons[p]=t.weapons[p]||{},a.weapons[p]=a.weapons[p]||{},t.weapons[p][m]=t.weapons[p][m]||{},a.weapons[p][m]=a.weapons[p][m]||[];var u=Object.keys(t.weapons[p][m]).length;t.weapons[p][m][r[s]]=u,a.weapons[p][m][u]=r[s]}}t.properties={},a.properties={};for(s=0;s<o.length;s++){var _=o[s];t.properties[_]={},a.properties[_]=[];var f=data.item.property_combos[o[s]];for(d=0;d<f.length;d++)t.properties[_][f[d][0]]=t.properties[_][f[d][0]]||{},t.properties[_][f[d][0]][f[d][1]]=d,t.properties[_][f[d][1]]=t.properties[_][f[d][1]]||{},t.properties[_][f[d][1]][f[d][0]]=d,a.properties[_][d]=[f[d][0],f[d][1]]}t.traits={},a.traits={};for(s=0;s<i.length;s++){t.traits[i[s]]={},a.traits[i[s]]=[];var v=data.item.trait_combos[i[s]].sort();e<1&&(v=data.item.trait_combos[i[s]]);for(d=0;d<v.length;d++)t.traits[i[s]][v[d]]=d,a.traits[i[s]][d]=v[d]}return t.index=a,t}function resourceButton(){for(var e=this.parentNode,t=this.parentNode.parentNode.children,a=0;a<t.length;a++){var n=t[a];n!==e&&n.classList.toggle("hide")}}function prepPage(){constants=InitConstants(),document.getElementsByClassName("default-language")[0].textContent=verminted.language;for(var e=document.getElementsByClassName("input-power-level"),t=0;t<e.length;t++)e.textContent=verminted.power_level-235;var a=document.getElementsByClassName("appended-link");for(t=0;t<a.length;t++){var n=a[t].href.split("?")[1];a[t].href=window.location.search+"?"+n}var r=document.getElementsByClassName("select-difficulty")[0],o=document.createDocumentFragment(),i=Object.keys(constants.difficulties);for(t=0;t<i.length;t++){var s=i[t],l=document.createElement("option");l.textContent=s,(l.value=s)===verminted.difficulty&&l.setAttribute("selected",!0),o.appendChild(l)}r.appendChild(o),r.addEventListener("change",verminted.set_difficulty),verminted.callback_on_data=[],verminted.update_weapon_list=[],verminted.update_weapon=[],verminted.update_on_build=[],verminted.tooltip=document.getElementsByClassName("tooltip")[0],verminted.tooltips={},verminted.weapon_buttons={},verminted.weapon_slot={};for(var c=document.getElementsByClassName("select-page"),d=(t=0,c.length);t<d;t++)c[t].addEventListener("click",function(e){pageSelection(e.target)});for(var p=document.getElementsByClassName("build-button"),m=(t=0,p.length);t<m;t++)p[t].addEventListener("click",function(e){verminted.build.modal.open(),e.stopPropagation()});var u=document.getElementsByClassName("toggle-hbfs");for(t=0;t<u.length;t++){u[t].addEventListener("change",verminted.set_harder_better),TooltipControl(u[t]).text("Harder, Better, Faster, Stronger\r\ndoubles elites' hp")}var _=document.getElementsByClassName("select-headshot-percent")[0];_.addEventListener("change",function(e){var t=e.target.valueAsNumber;t=100<t?100:0<t?t:0,_.value=t,verminted.combo_breakpoints.headshot_chance=t/100,verminted.build.refresh()}),TooltipControl(_).text("Percentage of hits that\r\nare headshots for DPS");var f=document.getElementsByClassName("resource-title");for(t=0;t<f.length;t++){for(var v=f[t],g=v.parentNode,h=v.parentNode.parentNode.children,b=0;b<h.length;b++){var k=h[b];k!==g&&k.classList.toggle("hide")}v.onclick=resourceButton}var w=populateAttackCombo();verminted.combo_breakpoint_table=w.combo,verminted.weapon_breakpoint_table=[],verminted.weapon_breakpoint_table[0]=w.weapon[0],verminted.weapon_breakpoint_table[1]=w.weapon[1],verminted.weapon_attack_breakpoints=[];for(t=0;t<verminted.weapon_breakpoint_table.length;t++)verminted.weapon_attack_breakpoints[t]=AttackBreakpoints(verminted.weapon_breakpoint_table[t],t);verminted.combo_breakpoints=ComboBreakpoints(verminted.combo_breakpoint_table),waitForData()}function waitForData(){DATA_FINISHED?finishPage():setTimeout(waitForData,5)}function finishPage(){var e=document.getElementById("build");e.textContent=data.vermintide+" "+e.textContent;for(var t=0;t<verminted.callback_on_data.length;t++)verminted.callback_on_data[t]();var a=document.getElementsByClassName("select-language")[0],n=["en","zh","pl","ru","fr","es","it","pt","de","disabled"];for(t=0;t<n.length;t++){var r=n[t],o=document.createElement("option");(o.textContent=r)===verminted.language&&o.setAttribute("selected",!0),a.addEventListener("change",function(e){verminted.set_language(e)}),a.appendChild(o)}verminted.compression=VermintedCompress();var i=window.location.search;if(i){var s=i.split("?");for(t=0;t<s.length;t++){var l,c=s[t];switch(c){case"shadeult":verminted.temp_shade_ult=!0,pageSelection(document.getElementsByClassName("select-page")[1]);break;case"compareconsole":document.getElementsByClassName("select-file")[0].addEventListener("change",compareConsole),document.getElementsByClassName("select-file")[0].classList.remove("hide");break;case"dontopenbuild":verminted.do_not_open_build=!0;break;default:10===c.length&&(l=s[t])}}}verminted.global_buffs={witch_hunter_captain_ultimate:{name:"witch_hunter_captain_ultimate",stat_buff:"crit_chance",max_stacks:1,bonus:.25},markus_mercenary_passive:data.careers.es_mercenary.passives[0],markus_huntsman_passive_crit_aura:data.careers.es_huntsman.passives[3],trinket_grenade_damage_taken:data.item.traits.trinket_grenade_damage_taken,defence_debuff_enemies:data.careers.dr_slayer.talent_tree[1][2].buffs[0],strength_potion:{name:"strength_potion",stat_buff:"has_power_boost",max_stacks:1,multiplier:1},speed_potion:{name:"speed_potion",stat_buff:"attack_speed",max_stacks:1,multiplier:.5}};for(var d=Object.keys(data.globals),p=0,m=d.length;p<m;p++)constants[d[p]]=data.globals[d[p]];var u=document.getElementsByClassName("input-power-level");for(t=0;t<u.length;t++)u[t].value=verminted.power_level-constants.starting_power_level,u[t].addEventListener("change",verminted.set_power_level);populateElements(),verminted.weapon_list=WeaponListModal(),verminted.damage=WeaponDamage(),verminted.attack_chain=AttackChain(document.getElementsByClassName("chain-attack-container")[0]),verminted.build=BuildBuild(),verminted.timeline=ComboTimeline();for(var _=document.getElementsByClassName("select-weapon"),f=(t=0,_.length);t<f;t++){var v=uniqueID(_[t]);verminted.tooltips[v];verminted.weapon_buttons[v]=WeaponSelection(_[t]),verminted.weapon_slot[t]=document.getElementsByClassName("weapon-attacks")[t],verminted.tooltips[v]=TooltipControl(_[t]),verminted.tooltips[v].text("Weapon "+(t+1))}l&&verminted.build.decode(l);var g=["skaven_slave","skaven_clan_rat","chaos_fanatic","chaos_marauder","beastmen_gor","beastmen_ungor_archer","skaven_plague_monk","chaos_berzerker","skaven_storm_vermin","beastmen_bestigor","chaos_raider","chaos_warrior","chaos_vortex_sorcerer","chaos_corruptor_sorcerer","skaven_poison_wind_globadier","skaven_gutter_runner","skaven_warpfire_thrower","skaven_ratling_gunner","skaven_pack_master","beastmen_standard_bearer","skaven_rat_ogre","skaven_stormfiend","chaos_spawn","chaos_troll","chaos_exalted_champion_warcamp","skaven_storm_vermin_warlord","chaos_exalted_sorcerer","chaos_exalted_champion_norsca","chaos_spawn_exalted_champion_norsca","skaven_stormfiend_boss","skaven_grey_seer"],h=["recruit","veteran","champion","legend","cataclysm","cataclysm_2","cataclysm_3"],b=document.getElementsByClassName("mob-hp-list")[0];for(t=0;t<g.length;t++){var k=document.createElement("p");k.style.display="inline-block",k.style.whiteSpace="pre-wrap";for(var w="",y=data.breeds[g[t]],C=0;C<h.length;C++)if("number"==typeof y.max_health[h[C]]){var x=y.max_health[h[C]].toString(),L=x.replace(".","").length,E="";E+=x+"&#09;",L<4&&(E+="&#09;"),w+=E}k.innerHTML=w,k.textContent+=" // "+g[t],b.appendChild(k)}}window.onpopstate=function(e){var t=e.state;t.build.build_code&&verminted.build.decode(t.build.build_code)},void 0===document.getElementsByClassName&&(document.getElementsByClassName=function(e){var t="."+e.replace(/ /g,".");return document.querySelectorAll(t)});