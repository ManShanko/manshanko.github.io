const build="63",date="27/3/2019";function DefaultSettings(){var t={refresh:[]};let a=function(){for(let e=0;e<t.refresh.length;e++)t.refresh[e]()};return t.max_targets=5,t.anim_cancel=.05,t.difficulty="legend",t.set_difficulty=function(n){let e=n.target,o=e.value;if(!constants.difficulties[o])throw"difficulty is not registered!";else t.difficulty=o,a()},t.power_level=785,t.set_power_level=function(n){let e=n.target,o=e.valueAsNumber;if(isNaN(o))throw"power_level is NaN!";600<o?(o=600,e.value=600):15>o&&(o=15,e.value=15),t.power_level=o+185,a()},t.platform=!1,t.set_platform=function(n){let e=n.target,o=e.value;t.platform="console"==o,t.difficulty="legend",a()},t.profiles={},t}var verminted=DefaultSettings();function InitConstants(){return{armor_types:["infantry","armored","monster","friendly_fire","berserker","superarmored"],hit_types:["neither","headshot","critical","both"],attack_types:["light","push","heavy","dot"],dual_profile:["damage_profile_right","damage_profile_left"],characters:{bw_scholar:"sienna",bw_adept:"sienna",bw_unchained:"sienna",es_mercenary:"kruber",es_huntsman:"kruber",es_knight:"kruber",dr_ranger:"bardin",dr_ironbreaker:"bardin",dr_slayer:"bardin",we_waywatcher:"kerillian",we_maidenguard:"kerillian",we_shade:"kerillian",wh_captain:"saltzpyre",wh_bountyhunter:"saltzpyre",wh_zealot:"saltzpyre"},mob_lookup:{skaven_slave:"infantry",skaven_clan_rat:"infantry",chaos_fanatic:"infantry",chaos_marauder:"infantry",skaven_plague_monk:"berserker",chaos_berzerker:"berserker",skaven_storm_vermin:"armored",chaos_raider:"infantry",chaos_warrior:"superarmored",chaos_vortex_sorcerer:"infantry",chaos_corruptor_sorcerer:"infantry",skaven_poison_wind_globadier:"infantry",skaven_gutter_runner:"infantry",skaven_warpfire_thrower:"armored",skaven_ratling_gunner:"armored",skaven_pack_master:"monster"},difficulties:{deathwish:!0,legend:!0,champion:!0,veteran:!0,recruit:!0}}}var constants=InitConstants(),UID=0;function uniqueID(e){if(e.getAttribute("data-id"))return e.getAttribute("data-id");else{UID++;let t=UID;return e.setAttribute("data-id",t),t}}window.mobilecheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},String.prototype.hashCode=function(){var e,t,a=0;if(0===this.length)return a;for(e=0;e<this.length;e++)t=this.charCodeAt(e),a=(a<<5)-a+t,a|=0;return a};let concateObject=function(e){let t="";if("object"==typeof e){let a,n=0;if(e.isArray){n=e.length;for(let e=0;e<n;e++)a[e]=e}else a=Object.keys(e),n=a.length;for(let o=0;o<n;o++)t+=concateObject(e[a[o]])}else t+=e;return t};function pageSelection(e){let t=document.getElementsByClassName("main-page");for(let a=0;a<t.length;a++)t[a]==e?t[a].classList.remove("hide"):t[a].classList.add("hide")}let GenericMath=function(){let e={};return e.clamp=function(e,t,a){let n=0;return n=e>=a?a:e<=t?t:e,n},e.getPowerPercentage=function(e){let t=constants.min_power_level,a=constants.max_power_level;return(e-t)/(a-t)},e.scalePower=function(e){var t=Math.min;let a=verminted.power_level,n=verminted.difficulty;"deathwish"===n&&(n="legend");let o=constants.difficulty_settings[n],i=o.power_level_cap,r=o.power_level_max_target,s=0;if(i<a&&r){let e=a-i;a=i+r*e/(800-i)}else a=t(a,i);if(a>=constants.min_power_level_cap){let t,n=100,o=5;if(a>=constants.min_power_level_cap+n)t=(a-constants.min_power_level_cap)*(constants.power_level_diff_ratio[e]-1)/(o-1),verminted.platform&&"attack"===e&&(t*=1.4);else{let i=50*(1-(a-200)/n);t=(a+i-constants.min_power_level_cap)*(constants.power_level_diff_ratio[e]-1)/(o-1),verminted.platform&&"attack"===e&&(t=1.4*(t-200)+200)}s=constants.min_power_level_cap+t}else s=a;return s},e.getPower=function(t,a,n,o,i){let r,s=n.power_multiplier||a.power_multiplier||constants.default_power_multiplier,p=n.power_multiplier_near||a.power_multiplier_near,l=n.power_multiplier_far||a.power_multiplier_far;r=p&&l&&0<=i?0===i?p[t]:l[t]:s[t];let c=e.scalePower(t);return c*r},e.getCleave=function(t){let a=e.scalePower("cleave"),n=t.cleave_coefficient||constants.default_cleave_coefficient,o=constants.cleave.max-constants.cleave.min,i=a*n.attack,r=e.getPowerPercentage(i);return o*r},e.getArmorMultiplier=function(e,t,a,n,o,i,r){let s,p,l=a.armor_multiplier||t.armor_multiplier||constants.default_power_multiplier,c=a.armor_multiplier_near||t.armor_multiplier_near,d=a.armor_multiplier_far||t.armor_multiplier_far;return i&&(p=i[e]),s=p&&p[n]?o&&p[o]||p[n]:c&&d&&0<=r?0===r?o&&0<=c[e][o]?c[e][o]:0<=c[e][n]?c[e][n]:1:o&&0<=d[e][o]?d[e][o]:0<=d[e][n]?d[e][n]:1:o&&0<=l[e][o]?l[e][o]:0<=l[e][n]?l[e][n]:1,s},e.getPowerForUnit=function(t,a,n,o,i,r,s,p){let l=t.targets&&t.targets[a]||t.default_target,c=n&&t.critical_multiplier;p&&(r=0,s=0);let d=e.getArmorMultiplier("attack",t,l,r,s,c,i),m=e.getPower("attack",t,l,c,i);m*=d;return m},e},WeaponDamage=function(){var e=Math.floor;let a=GenericMath(),n={};return a.modifyBoostCurve=function(e,t){let a={};for(let n=0,o=e.length;n<o;n++)a[n]=e[n]*t;return a},a.clampCurveValue=function(e,t){let a=Object.keys(e).length-1;return 0>t?e[0]:t>a?e[a]:e[t]},a.getBoostCurveMultiplier=function(n,o){let i=Object.keys(n).length-1,r=i*o,s=e(r),p=r-e(r),t=a.clampCurveValue(n,s-1),l=a.clampCurveValue(n,s+0),c=a.clampCurveValue(n,s+1),d=a.clampCurveValue(n,s+2);return(-t/2+3*l/2-3*c/2+d/2)*p*p*p+(t-5*l/2+2*c-d/2)*p*p+(-t/2+c/2)*p+l},a.calculateDamage=function(e,t,n,o,i,r,s,p,l,c,d,m){var _=Math.max;if(e.no_damage)return 0;let u={headshot:!0,weakspot:!0,protected_weakspot:!0},h=e.targets&&e.targets[d]||e.default_target,g=constants.boost_curves[h.boost_curve_type]||constants.boost_curves["default"],w={max:100,min:0},b=verminted.difficulty,f=0,k=0,y=1;if(u[t]||n||r||s&&1<s){let o=1==l||4==l||5==l?1:l;let p=w.max,m=a.getPowerForUnit(e,d,n,t,i,l,c,o),_=a.getPowerPercentage(m),h=p*_;(u[t]||n)&&(y=.5*h),(r||s&&0<s)&&(f=h)}let x=0,v=w,C=v.max-v.min,E=a.getPowerForUnit(e,d,n,t,i,l,c),L=a.getPowerPercentage(E);x=v.min+C*L;let N;o&&(N=f&&x<f&&f*(o-1)||x*(o-1));let B=0,A=0;if(r){B+=[.75,.6,.5,.5,.5,.3][l]}if(s&&0<s){B+=[.75,.3,.75,.5,.5,.2][l]}u[t]&&(0<x?2==l?A+=h&&(h.headshot_boost_boss||h.headshot_boot)||.25:A+=h&&(h.headshot_boost_armor||h.headshot_boost)||.5:5==c&&0==x?A+=h&&(h.headshot_boost_heavy_armor||.25):1==l&&0==x&&(A+=h&&(h.headshot_boost_armor||h.headshot_boost)||.5),"protected_weakspot"==t&&(A*=.25)),"protected_spot"==t&&(B-=.5,A-=.5),e&&e.no_headshot_boost&&(A=0);let P=0;if(n&&(P=e.crit_boost||.5,e.no_crit_boost&&(P=0)),g&&(0<B||0<A||0<P)){let e,t,n=h&&h.power_boost_curve_coefficient||1,o=h&&h.boost_curve_coefficient||1;if(s&&0<s&&(n*=s,o*=s),0<B){e=a.modifyBoostCurve(g,n),B=a.clamp(B,0,1);let t=a.getBoostCurveMultiplier(e||g,B);f=_(_(f,x),1)*t}if(0<A||0<P){t=a.modifyBoostCurve(g,o),A=a.clamp(A+P,0,1);let e=t||g,n=a.getBoostCurveMultiplier(e,A);k=_(_(f,x),y)*n,0<P&&(k*=1+m)}}return verminted.temp_shade_ult&&2===l&&(x*=.45,f*=.5,k*=.5),x=x+f+k,N&&(x+=N),x},a.compileProfile=function(e,t){let o=verminted.build.getWeaponIndex(e),i=verminted.build.weapon[o].crit_boost,r=verminted.build.weapon[o].power_boost,s=verminted.build.weapon[o].has_power_boost,p=""+i+r+s+verminted.platform+verminted.difficulty.charAt(4)+verminted.power_level,l=(t+p).hashCode();if(n[t]===l)return;n[t]=l;let c={},d=data.profiles[t],m=constants.armor_types,_=constants.hit_types;for(let n=0,o=m.length;n<o;n++){3==n&&(n=4);let e=n,o=n;5==n&&(e=1);let r=m[n];c[r]={};for(let p=0;p<_.length;p++){let l,m,u,h=_[p];verminted.temp_shade_ult&&(m=4,2==n&&(m=3));let g,w;data.profiles[t].duration?w=1!=p&&(2==p||3==p):1==p?(g="headshot",w=!1):2==p?(g=null,w=!0):3==p?(g="headshot",w=!0):(g=null,w=!1),c[r][h]={};for(let t,n=0;5>n&&(t=a.calculateDamage(d,g,w,l,0,s,m,u,e,o,n,i),!(0<n&&t>c[r][h][n-1]));n++)c[r][h][n]=t}}verminted.profiles[t]=verminted.profiles[t]||{},verminted.profiles[t].crit_boost=i,verminted.profiles[t].power_boost=r,verminted.profiles[t].damage=c},a.getDamage=function(e,t,n,o,i,r){a.compileProfile(e,t);let s=verminted.build.getWeaponIndex(e),p=verminted.build.weapon[s].multipliers,l=n;"superarmored"===n&&(l="armored");let c=p[r]||1,d=p[l]||1,m=p.power||1,_=verminted.profiles[t].damage,u=_[n][o][i];return u=u*c*d*m,u},a},WeaponBreakpoints=function(e){var t=Math.round,a=Math.ceil,n=Math.floor;let o={};return o.chain=[],o.mob_lookup=constants.mob_lookup,o.hit_types=constants.hit_types,o.damage_profiles=[],o.pullDamage=function(e,t,n){let i=o.chain,r=o.hit_types,s=o.damage_profiles;if(!o.mob_lookup[e]){throw`${e} does not have assigned armor type`}data.breeds[e];let p=data.breeds[e],l=p.race,c=verminted.difficulty,d=p.primary_armor||p.armor,m=d;p.hitzone_primary_armor?m=p.hitzone_primary_armor.head.attack||p.hitzone_primary_armor.head:p.hitzone_armor&&(m=p.hitzone_armor.head.attack||p.hitzone_armor.head);let _={};for(let o=t;o<t+(n||1);o++){let t=s[o].weapon,n=s[o].action,i=s[o],p=data.weapons[t].actions[n],c=0;if(i.aoe_profile)c=2;else{let t,n=verminted.damage.getCleave(data.profiles[i.profile]);t=p.hit_mass&&constants.hit_mass[p.hit_mass][e]?data.breeds[e].hit_mass_counts&&data.breeds[e].hit_mass_counts[verminted.difficulty]?constants.hit_mass[p.hit_mass][e]*data.breeds[e].hit_mass_counts[verminted.difficulty]:data.breeds[e].hit_mass_count||20:data.breeds[e].hit_mass_counts&&data.breeds[e].hit_mass_counts[verminted.difficulty]?data.breeds[e].hit_mass_counts[verminted.difficulty]:data.breeds[e].hit_mass_count||20,i.max_targets=i.dot?s[i.parent_index].max_targets:a(n/t),c=i.max_targets}for(let e=0,t=r.length;e<t;e++){_[r[e]]=[];let t=r[e];for(let a=0;a<c;a++){let n=d,o=0;i.aoe_profile&&0<a?o=verminted.damage.getDamage(i.weapon,i.aoe_profile,n,t,a,l):(("headshot"===r[e]||"both"===r[e])&&(n=m),o=verminted.damage.getDamage(i.weapon,i.profile,n,t,a,l)),_[r[e]][a]=o}}}return _},o.pullProfiles=function(e,t,a){let n=o.chain,r=o.damage_profiles,s=data.weapons[e].actions[t];if(s){let o=data.weapons[e].actions[t].damage_window;for(let e=0;e<n.length;e++)o+=n[e].speed;n[a].tth=o;let l=r.length;if(s.damage_profile_target){let n=s.damage_profile_target;r[l]={},r[l].weapon=e,r[l].weapon_index=a,r[l].profile=n,r[l].action=t,r[l].tth=o,r[l].damage={},r[l].aoe_profile=s.damage_profile,l++}else if(s.damage_profile){let n=s.damage_profile;r[l]={},r[l].weapon=e,r[l].weapon_index=a,r[l].profile=n,r[l].action=t,r[l].tth=o,r[l].damage={},l++}else if(s.damage_profile_left){let n=s.damage_profile_left;r[l]={},r[l].weapon=e,r[l].weapon_index=a,r[l].profile=n,r[l].action=t,r[l].tth=o,r[l].damage={},l++,n=s.damage_profile_right,r[l]={},r[l].weapon=e,r[l].weapon_index=a,r[l].profile=n,r[l].action=t,r[l].tth=o,r[l].damage={},l++}let c=r.length;for(let s=n[a].profile_length;s<c;s++){let n=data.profiles[r[s].profile],i=n.dot||n.default_target.dot;if(n.targets[0]&&n.targets[0].dot)if(i&&i!==n.targets[0].dot)throw"two dot profiles were found and not properly handled!";else{i=n.targets[0].dot;var p=0}if(i){let n=data.profiles[i];l=r.length,r[l]={},r[l].weapon=e,r[l].weapon_index=a,r[l].profile=i,r[l].action=t,r[l].tth=o,r[l].damage={},r[l].dot=!0,r[l].parent_index=s,r[l].tick_rate=n.tick_rate,r[l].duration=n.duration,r[l].max_stacks=n.max_stacks,r[l].target=p}}}},o.buildBreakpoints=function(i){if(0>i)return;let r=o.chain,s=o.damage_profiles,p=verminted.difficulty,l=o.hit_types,c=e.container,d=Object.keys(o.mob_lookup),m={};for(let r,c=0,_=d.length;c<_;c++){r=d[c];for(let e,t=0;t<s.length;t++)e=o.pullDamage(d[c],t),s[t].damage[d[c]]=e;let _=data.breeds[d[c]].max_health[p];verminted.platform&&data.breeds[d[c]].console_max_health&&data.breeds[d[c]].console_max_health[p]&&(_=data.breeds[d[c]].console_max_health[p]),m[r]=0;for(let e=0,t=s.length;e<t;e++)if(s[e].dot)continue;else if(s[e].damage[d[c]]&&s[e].damage[d[c]].neither){let t=s[e].damage[d[c]].neither.length;t>m[d[c]]&&(m[d[c]]=t)}for(let o=0;o<l.length;o++)for(let p=0;5>p;p++){if(p>=m[d[c]]){for(let t=p;5>t;t++)e.breeds[r].targets[t].row.classList.add("hide");break}let i=e.breeds[r].targets[p][l[o]],u=TooltipControl(i),h=`${d[c]}\r\n${l[o]}`,g=e.breeds[r].mob_name,w=r.replace(/_/g," "),b=w.replace(/\w+/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)});g.textContent=b+" ("+_+")";let f={},k=[],y=0,x=[],v=0;for(let e=0,t=s.length;e<t;e++){let t=s[e],a=k.length;if(!(s[e].damage[d[c]]&&s[e].damage[d[c]][l[o]]))k[a]=0;else if(t.dot){if("number"==typeof t.target&&p!==t.target)continue;else if(t.max_stacks){if(f[t.profile]=f[t.profile]||0,f[t.profile]>=t.max_stacks)continue;f[t.profile]++}let i=n(s[e].duration/s[e].tick_rate);for(let n=0;n<i;n++)k[a]=s[e].damage[d[c]][l[o]][0]||0,a++,h+=`\r\n${t.action} = ${k[a]&&k[a].toFixed(3)||0}`}else k[a]=s[e].damage[d[c]][l[o]][p]||0,h+=`\r\n${t.action} = ${k[a].toFixed(3)}`}for(let e,a=0;a<k.length;a++)e=t(4*k[a])/4,y+=e,x[a]=k[a]/_,v+=x[a];let C=[];if(0==y/_)i.textContent=0;else if(1<=y/_)i.textContent=1;else if(1>y/_){let e,o,r;0==_%y?(r=_/y,e=_/y-1,o=_/y/e):(r=a(_/y),e=n(_/y),o=_/y/e);let s=a(4*(_/e))/4;for(let e=0;e<k.length;e++){C[e]=C[e]||{};x[e]*(1/v);C[e].next_bp=k[e]?t(4*(k[e]*o))/4:0}let p=o;for(;;){let e=0,t=[],a=[];for(let n=0;n<C.length;n++)if(0<C[n].next_bp){if(e+=C[n].next_bp,C[n].percent=(C[n].next_bp-1/8)/k[n],!t[0]||C[n].percent>t[0].percent){for(let e=0;e<t.length;e++)t.pop();t[0]={},t[0].percent=C[n].percent,t[0].index=n}else if(C[n].percent===t[0].percent){let e=t.length;t[e]={},t[e].percent=C[n].percent,t[e].index=n}if(!a[0]||C[n].percent<a[0].percent){let e=a.length;for(let t=0;t<e;t++)a.pop();a[0]={},a[0].percent=C[n].percent,a[0].index=n}else if(C[n].percent===a[0].percent){let e=a.length;a[e]={},a[e].percent=C[n].percent,a[e].index=n}}if(e>s){let a=4*e-4*s;if(t.length<a)for(let e,a=0;a<t.length;a++)e=t[a].index,C[e].next_bp-=.25;else{p=t[0].percent;break}}else if(e===s){p=t[0].percent;break}else if(e<s)if(a.length)for(let e,t=0;t<a.length;t++)e=a[t].index,C[e].next_bp+=.25;else{break}let n=a.length;for(let e=0;e<n;e++)a.pop()}h+=`\r\n\r\npower needed for next bp: ${a(1e5*(p-1))/1e3}%`,p=a(100*p),100<p&&(p-=100),i.textContent=r+" ("+p+"%)"}u.text(h),e.breeds[d[c]].targets[p].row.classList.remove("hide")}}c.classList.remove("hide")},o.clearAttacks=function(){for(let e=0,t=chain.length;e<t;e++)chain.pop()},o.generateCombo=function(){for(let e=0,t=chain.length;e<t;e++);},o},AttackBreakpoints=function(e){let t=e.container,a=WeaponBreakpoints(e),n=t.parentNode,o=n.getElementsByClassName("weapon-breakpoints-attacks")[0],r={};r.attacks=[],r.name_div=e.name_div,a.chain[0]={};let s=function(){let e=data.weapons[r.name].actions,t=Object.keys(e).sort(),a=[],n=0;for(let o,r=0;r<t.length;r++)o=e[t[r]],(o.damage_profile||o.damage_profile_left)&&(a[n]=t[r],n++);for(let e,t=0;t<r.attacks.length;t++)e=r.attacks[t],a[t]?(e.textContent=a[t],e.setAttribute("data-action",a[t]),e.classList.remove("hide"),e.classList.remove("not-active-talent")):e.classList.add("hide")},p=function(){},l=function(n){a.damage_profiles=[];let e=a.damage_profiles,o=n.target.getAttribute("data-action");a.pullProfiles(r.name,o,0),a.buildBreakpoints(0),display=!0;for(let e,t=0;t<r.attacks.length;t++)e=r.attacks[t],e===n.target?e.classList.remove("not-active-talent"):e.classList.add("not-active-talent");t.classList.remove("hide")};return a.set=function(e){r.name=e,r.name_div.textContent=e,n.classList.remove("hide"),p(),s()},a.refresh=function(){r.name&&0<a.damage_profiles.length&&a.buildBreakpoints(0)},verminted.update_on_build[verminted.update_on_build.length]=a.refresh,function(){for(let e,t=0;10>t;t++)e=document.createElement("div"),e.classList="weapon-attack js-button hide",e.addEventListener("click",l),r.attacks[t]=e,o.appendChild(e)}(),a},ComboBreakpoints=function(e){var t=Math.ceil,a=Math.floor;let n=WeaponBreakpoints(e);n.headshot_chance=0,n.armor_types=constants.armor_types;let o={},i=n.buildBreakpoints,r={},s=function(t){let o=n.chain,s=n.damage_profiles,p=n.armor_types,l=e.info.damage_box,c=e.info.damage_box.dps;for(let e=0,o=p.length;e<o;e++){3==e&&(e=4);let o=p[e];if(l.dps[o])var d=l.dps[o];else{var d=document.createElement("div");d.classList.add(n.armor_types[e]),l.dps[n.armor_types[e]]=d,l.container.appendChild(l.dps[n.armor_types[e]])}let i=TooltipControl(d),c=0;for(let e,p=0,i=s.length;p<i;p++)if(e=s[p],!!e.profile)if(e.dot){let n=a(e.duration/e.tick_rate),i=verminted.damage.getDamage(e.weapon,e.profile,o,"neither",0);if(!e.max_stacks)c+=i*n;else if(r[e.name])continue;else c+=i*n*t,r[e.name]=!0}else{let t=n.headshot_chance,a=verminted.build.getWeaponIndex(s[p].weapon),i=verminted.build.weapon[a].crit_chance||.05;data.weapons[s[p].weapon].actions[e.action]&&data.weapons[e.weapon].actions[s[p].action].extra_crit_chance&&(i+=data.weapons[e.weapon].actions[e.action].extra_crit_chance);let r=t*i;t-=r,i-=r;let l=1-(t+i+r),d=0,m=0,_=0,u=0;d+=verminted.damage.getDamage(e.weapon,e.profile,o,"neither",0),m+=verminted.damage.getDamage(e.weapon,e.profile,o,"headshot",0),_+=verminted.damage.getDamage(e.weapon,e.profile,o,"critical",0),u+=verminted.damage.getDamage(e.weapon,e.profile,o,"both",0),d*=l,m*=t,_*=i,u*=r;let h=d+m+_+u;c+=h}if(0<t){c/=t;let e=`DPS against ${o}\r\n${c.toFixed(2)}`;i.text(e),d.textContent=a(10*c)/10}}},p=function(){let a=n.chain,o=e.info.attack_speed,r=0,p=!1;if(1<a.length){let e=a.length-1,t=data.weapons[a[e].weapon],n=verminted.build.getWeaponIndex(a[e].weapon),o=verminted.build.weapon[n].attack_speed||1;if(a[e].weapon!==a[0].weapon)r+=t.actions[a[e].action].attack_speed.anim_cancel/o,r+=verminted.anim_cancel,p=!0;else if(t.actions[a[e].action]&&t.actions[a[e].action].attack_speed[a[0].action]){let n=t.actions[a[e].action].timeout,i=t.actions[a[e].action].attack_speed[a[0].action]-t.actions.neutral.attack_speed[a[0].action];r+=n&&n<i?n:i/o,p=!0}else if(t.actions.push&&a[0].action===t.actions.push.push_attack){switch(a[e].action){case"anim_cancel":r+=0;break;case"block":r+=0;break;default:let n=t.actions[a[e].action].attack_speed.block,i=t.actions[a[e].action].damage_window;r+=n<i?i/o:n/o;}p=!0}else"anim_cancel"===a[e].action?(r+=verminted.anim_cancel,p=!0):"block"===a[e].action&&(p=!0)}for(let e=0,t=a.length;e<t;e++){let t=verminted.build.getWeaponIndex(a[e].weapon),n=verminted.build.weapon[t].attack_speed||1;r+=data.weapons[a[e].weapon].actions[a[e].action]&&data.weapons[a[e].weapon].actions[a[e].action].timeout&&data.weapons[a[e].weapon].actions[a[e].action].timeout<a[e].speed*n?data.weapons[a[e].weapon].actions[a[e].action].timeout:a[e].speed/n}r=t(100*r)/100,o.textContent=r+"s",p?(o.style.color="black",s(r)):o.style.color="red"};n.addAttack=function(e,t,a){let r=n.chain,s=n.damage_profiles;if(0===a&&(o={},c(!0)),a<r.length){let e=r[a].profile_length-1;for(let t=s.length;t>e;t--)s[t]=null,s.pop();for(let e=r.length;e>a-1;e--)r[e]=null,r.pop()}r[a]={},r[a].weapon=e,r[a].action=t,r[a].speed=0,r[a].profile_length=s.length;let l=a;if(n.pullProfiles(e,t,a),!data.weapons[e].actions[t]){let e=a-1,n=data.weapons[r[e].weapon],o=n.actions[r[e].action];if("block"===t){let e=data.weapons[r[a-1].weapon].actions[r[a-1].action].attack_speed.block,t=data.weapons[r[a-1].weapon].actions[r[a-1].action].damage_window;r[a].speed+=e<t?t:e,r[a].speed+=n.block.min_hold}else{let e=data.weapons[r[a-1].weapon].actions[r[a-1].action].attack_speed.anim_cancel,t=data.weapons[r[a-1].weapon].actions[r[a-1].action].damage_window;r[a].speed+=e<t?t:e}--l}else{let n=data.weapons[e];if("melee"!==n.type||t!==n.actions.push.push_attack)0===a?r[a].speed=n.actions.neutral.attack_speed[t]:data.weapons[r[a-1].weapon].actions[r[a-1].action]?e===r[a-1].weapon?r[a].speed=n.actions[r[a-1].action].attack_speed[t]:(r[a].speed=n.actions.neutral.attack_speed[t],r[a].speed+=data.weapons[r[a-1].weapon].actions[r[a-1].action].attack_speed.anim_cancel):r[a].speed=n.actions.neutral.attack_speed[t];else if(r[a].speed=n.actions.push.attack_speed[t],r[a].speed+=n.block.min_hold,0<a)if(e===r[a-1].weapon){let e=0,t=0;data.weapons[r[a-1].weapon].actions[r[a-1].action]&&(e=data.weapons[r[a-1].weapon].actions[r[a-1].action].attack_speed.block,t=data.weapons[r[a-1].weapon].actions[r[a-1].action].damage_window),r[a].speed+=e<t?t:e}else{let e=data.weapons[r[a-1].weapon].actions[r[a-1].action].attack_speed.anim_cancel,t=data.weapons[r[a-1].weapon].actions[r[a-1].action].damage_window;r[a].speed+=e<t?t:e}}i(l),p()};let l=!1,c=function(t){l=t||!l,l?(e.container.getElementsByClassName("breakpoint-plate")[0].classList.remove("hide"),e.info.container.classList.remove("hide")):(e.container.getElementsByClassName("breakpoint-plate")[0].classList.add("hide"),e.info.container.classList.add("hide"))};return n.refresh=function(){let e=n.chain;e[0]&&null!==verminted.build.getWeaponIndex(e[0].weapon)&&p(),i(e.length-1)},function(){e.container.getElementsByClassName("attack-combo-title")[0].addEventListener("click",function(){c()})}(),verminted.update_on_build[verminted.update_on_build.length]=n.refresh,n},AttackChain=function(e){let t={anim_cancel:.05,weapon:[]},a={};t.chain=[];let n=document.getElementById("TEMPLATE-CHAIN").content.firstElementChild,o=verminted.combo_breakpoints,i=function(e,o){let i=t.chain,r=[],s=0;for(let p=0,n=t.weapon.length;p<n;p++){let e=t.weapon[p],n=data.weapons[e];if(e&&"melee"===data.weapons[e].type){if(o&&o.weapon===t.weapon[p]&&data.weapons[o.weapon].actions[o.attack]){let t=data.weapons[o.weapon],a=t.actions[o.attack].attack_speed,n=Object.keys(a).sort();for(let t=0,a=n.length;t<a;t++)"block_cancel_end"!==n[t]&&(r[s]={},r[s].name=p+1+" "+n[t],r[s].attack=n[t],r[s].weapon=e,s++)}else{let t=data.weapons[e].actions.neutral.attack_speed,a=Object.keys(t);for(let t=0,n=a.length;t<n;t++)r[s]={},r[s].name=p+1+" "+a[t],r[s].attack=a[t],r[s].weapon=e,s++}let i=Object.keys(a[e].push),l=a[e].block.push;l+=a[e].push[i[0]],r[s]={},r[s].name=p+1+" push_attack",r[s].attack=n.actions.push.push_attack,r[s].weapon=e,s++}else if(e&&"ranged"===data.weapons[e].type)if(o&&o.weapon===t.weapon[p]&&"neutral"!==o.attack){let a,i=0;n.actions[o.attack]?a=n.actions[o.attack].attack_speed:(a=n.actions.neutral.attack_speed,"block"===o.attack?i=n.block.min_hold:"anim_cancel"===o.attack&&(i=t.anim_cancel));let l=Object.keys(a);for(let t=0,a=l.length;t<a;t++)"block_cancel_end"!==l[t]&&(r[s]={},r[s].name=p+1+" "+l[t],r[s].attack=l[t],r[s].weapon=e,s++)}else{let t=data.weapons[e].actions.neutral.attack_speed,a=Object.keys(t);for(let t=0,n=a.length;t<n;t++)r[s]={},r[s].name=p+1+" "+a[t],r[s].attack=a[t],r[s].weapon=e,s++}}for(let t=0,a=r.length;t<a;t++)r[t].node=document.createElement("option"),r[t].node.value=r[t].weapon+","+r[t].attack,r[t].node.textContent=r[t].name,e.appendChild(r[t].node);return r},r=function(a){let s,p=t.chain;if(a.target)s=a.target;else if(a.value)s=a;else throw`next chain had a problem`;let l=s.value.split(/,/),c={};c.weapon=l[0],c.attack=l[1];let d=parseInt(s.getAttribute("data-count"))||0,m=d+1;if(p[m])for(let t=p.length-1;t>=m;t--)e.removeChild(p[t].node),p.pop();p[m-1].weapon=l[0],p[m-1].action=l[1],p[m]={},p[m].node=e.appendChild(n.cloneNode(!0)),p[m].select=p[m].node.getElementsByClassName("chain-attack-dropdown")[0],p[m].select.setAttribute("data-count",m),i(p[m].select,c),p[m].select.addEventListener("change",r),o.addAttack(c.weapon,c.attack,d)};return t.refresh=function(){let a=t.chain,o=!1,s=null;for(let n=0,i=a.length;n<i;n++){let i=a[n].select.value.split(/,/),r=i[0];r!==t.weapon[0]&&r!==t.weapon[1]&&(o=!0),o&&(null===s&&(s=n-1),e.removeChild(a[n].node))}for(let t=a.length-1;t>=0;t--)a[t].node.parentNode&&e.removeChild(a[t].node),a.pop();a[0]&&e.removeChild(a[0].node),a[0]=a[0]||{},a[0].node=e.appendChild(n.cloneNode(!0)),a[0].select=a[0].node.getElementsByClassName("chain-attack-dropdown")[0],a[0].select.setAttribute("data-count",0),i(a[0].select),a[0].select.addEventListener("change",r)},t.setWeapon=function(e,n){t.weapon[n]=e,reverseLookup(e),a[e]=data.weapons[e].lookup,t.refresh()},t},WeaponSelection=function(e){let t={},a=verminted.weapon_list,n=verminted.attack_chain;t.update=[];let o=function(){let t=e.getAttribute("data-weapon-select");return verminted.weapon_slot[t]},i=function(t){let a=o();e.textContent=t,e.setAttribute("data-input",t);let r=verminted.update_weapon;for(let e=0,n=r.length;e<n;e++)r[e](t,a);n.setWeapon(t,parseInt(e.getAttribute("data-weapon-select")))};return e.addEventListener("click",function(t){a.setClickCallback(i);let e=verminted.update_weapon_list;for(let a=0,n=e.length;a<n;a++)e[a](t);a.open()}),t},ModalControl=function(t,a){let n={};return n.clickCallback=null,n.modal=t,n.body=document.getElementsByTagName("body")[0],n.open=function(){n.bind(),t.classList.remove("hide")},n.setClickCallback=function(e){n.clickCallback=e},n.close=function(){t.classList.add("hide"),n.body.removeEventListener("click",n.onClick)},n.onClick=function(o){o.stopPropagation();let e=o.target,i=!1;if(a)var r=a;else var r=t;for(;e&&e.classList;){if(e===r||e.classList.contains("weapon-list-holder")){i=!1;break}else if(e===document.body){i=!0;break}e=e.parentNode}i&&n.close()},n.bind=function(){n.body.addEventListener("click",n.onClick)},n},BuildBuild=function(){var t=Math.floor;let a=document.getElementsByClassName("build-modal-container")[0],n={};n.career={},n.career.name,n.career.multipliers={},n.items=[],n.weapon=[],n.weapon_lookup={},n.update_on_close=verminted.update_on_build;let o={container:document.getElementsByClassName("weapon-list")[0],modal:verminted.weapon_list,lookup:{},weapon:{},property_combos:{}},r=[],s={},p=document.getElementsByClassName("buff-container")[0],l=document.getElementsByClassName("weapon-breakpoints-container"),c={},d=[],m=[];for(let e=0;e<data.careers.bw_scholar.talent_tree.length;e++)m[e]={};let _={power_vs_unarmoured:"infantry",power_vs_armoured:"armored",power_vs_large:"monster",power_vs_frenzy:"berserker",power_vs_skaven:"skaven",power_vs_chaos:"chaos",power_level:"power"};n.modal=ModalControl(a,document.getElementsByClassName("build-modal")[0]),n.modal.close=function(){n.refresh(),n.modal.modal.classList.add("hide"),n.modal.body.removeEventListener("click",n.modal.onClick)},document.getElementsByClassName("build-modal-close")[0].addEventListener("click",n.modal.close),n.modal.open();let u=function(t){let e=n.items,a=t.target.getAttribute("data-item-slot"),i=t.target.getAttribute("data-property-slot"),r=[];r[0]=e[a].property[0].select.value,r[1]=e[a].property[1].select.value;let s=e[a].type,p=o.property_combos[s];for(let n=0,o=e[a].property.length;n<o;n++)for(let t,o=0,i=e[a].property[n].options.length;o<i;o++)t=e[a].property[n].options[o].value,p&&p[r[(n+1)%2]]?p[r[(n+1)%2]][t]?e[a].property[n].options[o].removeAttribute("disabled"):e[a].property[n].options[o].setAttribute("disabled",!0):e[a].property[n].options[o].removeAttribute("disabled")},h=function(){let e,t,a=n.items;n.career.name?(e=data.careers[n.career.name],t=e.equipment):t=data.careers.dr_ranger.equipment;for(let n=0,i=a.length;n<i;n++){let i,r=t[n];if(i=data.weapons[a[n].name]?data.weapons[a[n].name].traits:1==n?"ranged_ammo":t[n],c[e]);else if(a[n].type===r&&a[n].trait_type===i)continue;else{a[n].type=r,a[n].trait_type=i;for(let e=0,t=a[n].property.length;e<t;e++){for(let t,o=0,i=a[n].property[e].options.length;o<i;o++)t=a[n].property[e].options.length-1,a[n].property[e].select.removeChild(a[n].property[e].options[t]),a[n].property[e].options.pop();let t=r;("ranged_ammo"===t||"ranged_heat"===t)&&(t="ranged");let i=document.createDocumentFragment(),s=Object.keys(o.property_combos[t]).sort();for(let t=0,o=s.length;t<o;t++){let o=s[t],r=document.createElement("option");r.value=o,r.textContent=o,a[n].property[e].options[t]=r,i.appendChild(r)}a[n].property[e].select.appendChild(i)}if(-1<n){let e=a[n].trait.options.length;if(0<e)for(let t,o=0;o<e;o++)t=e-1-o,a[n].trait.select.removeChild(a[n].trait.options[t]),a[n].trait.options.pop();let t=document.createDocumentFragment(),o=data.item.trait_combos[i].sort();for(let e=0,r=data.item.trait_combos[i].length;e<r;e++){let i=o[e],r=document.createElement("option");r.value=i,r.textContent=i,a[n].trait.options[e]=r,t.appendChild(r)}a[n].trait.select.appendChild(t)}}}},g=function(t){let e=t.target.value;if(n.career.name=e,n.career.crit_chance=data.careers[e].base_crit_chance,n.career.attack_speed=data.careers[e].base_attack_speed||0,n.career.reload_speed=data.careers[e].base_reload_speed||0,n.career.headshot_multiplier=data.careers[e].base_headshot_multiplier||0,n.career.backstab_multiplier=data.careers[e].base_backstab_multiplier||0,c[e]);else{h();let t=data.careers[e].talent_tree;for(let e=0;e<t.length;e++){m[e]={};for(let a,n=0;n<t[e].length;n++)a=t[e][n],d[e][n].div.classList.remove("not-active-talent"),d[e][n].div.textContent=a.name.replace(/_/g," ")}}y()},w=function(e,t){let a=n.career.name;if(!a)return;let o={power_level:"power"},r={attack_speed:"attack_speed",reload_speed:"reload_speed",critical_strike_chance:"crit_chance",backstab_multiplier:"backstab_multiplier"},s=data.careers[a].talent_tree;m[e]=s[e][t];let p=m[e];if(p.stat_buff&&p.max_stacks);else for(let e=0;5>e;e++){if(!m[e]||!m[e].stat_buff)continue;let t=m[e].stat_buff;o[t]?(0==e&&(n.career.multipliers[o[t]]=0),n.career.multipliers[o[t]]+=m[e].multiplier):r[t]&&(0==e&&(n.career[r[t]]=0),n.career[r[t]]+=m[e].multiplier)}for(let a=0;a<s[e].length;a++)a===t?d[e][a].div.classList.remove("not-active-talent"):d[e][a].div.classList.add("not-active-talent");y()},b=function(e,t){let a=n.items;t=t.getAttribute("data-weapon-slot");let o=a[t];o.name=e,h(),verminted.weapon_attack_breakpoints[t].set(e)},f=function(t){let e=n.items,a=t.target.getAttribute("data-item-slot"),o=t.target.getAttribute("data-property-slot"),i=t.target.value;e[a].property[o].name=i,e[a].property[o].value=data.item.properties[i][1]},k=function(e){let a=this,n=e.name,o=n.replace(/_/g," "),i=e.stat_buff,l=s[n];if(l)throw"buff "+n+" already exists!";else if(!i)throw"buff "+n+" has no stat_buff!";let c=0,d=e.max_stacks;"victor_zealot_passive_increased_damage"===n&&(d=6);let m=e.multiplier||e.bonus,_=document.createDocumentFragment(),u=document.createElement("div");u.classList="buff";let h=TooltipControl(u);h.text(o+"\n"+i+"\nbonus = "+m);let g=document.createElement("div");if(g.textContent=o,g.classList="buff-name",u.appendChild(g),1===d){let e=document.createElement("input");e.setAttribute("type","checkbox"),e.classList="buff-toggle",u.addEventListener("click",function(){e.value=!c,e.checked=!c,c=0+!c}),u.appendChild(e)}else if(1<d){let a=document.createElement("input");a.setAttribute("type","number"),a.setAttribute("max",d),a.setAttribute("min",0),a.classList="buff-input",a.addEventListener("change",function(o){let e=o.target.valueAsNumber;if(isNaN(e)){throw"buff "+n+" stacks are NaN!"}e=t(e);let i;e>d?(c=d,i=d):0>e?(c=0,i=0):(c=e,i=e),a.value=i}),u.appendChild(a)}else throw"buff "+n+" has no max_stacks!";_.appendChild(u),p.appendChild(_);let w=r.length;r[w]=this,s[n]=w,this.name=n,this.stat_buff=i,this.getBonus=function(){return m*c},this.remove=function(){let e=[],t={},a=0;for(let o,s=0;s<r.length;s++)o=r[s],o.name!==n&&(e[a]=o,t[o.name]=a,a++);r=e,s=t,p.removeChild(u)}},y=function(){let e=n.items,t=Object.keys(s);if(t.length!==r.length)throw"error with buff management";let a={},o=verminted.global_buffs,p=Object.keys(o);for(let e=0;e<p.length;e++)a[p[e]]=o[p[e]];if(n.career.name){let e=data.careers[n.career.name].passives;for(let t,n=0;n<e.length;n++)t=e[n],a[t.name]=t}for(let e=0;e<m.length;e++)m[e]&&m[e].name&&(a[m[e].name]=m[e]);for(let t=0;t<e.length;t++)e[t].trait.name&&(a[e[t].trait.name]=data.item.traits[e[t].trait.name]);for(let e=0,t=r.length;e<t;e++)a[r[e].name]||r[e].remove();let l=Object.keys(a);for(let e,t=0;t<l.length;t++)e=a[l[t]],isNaN(s[l[t]])&&e.stat_buff&&e.max_stacks&&new k(e)},v=function(e){let t=0;for(let a,n=0;n<r.length;n++)a=r[n],a.stat_buff===e&&(t+=a.getBonus());if(!data.careers[n.career.name])"crit_chance"===e&&(t+=.05);else if(_[e])for(let a,n=0;n<m.length;n++)a=m[n],e===a.stat_buff&&(t+=a.multiplier);else{t+=n.career[e]||0;for(let a,n=0;n<m.length;n++)a=m[n],e===a.stat_buff&&("crit_chance"===a.stat_buff?t+=a.bonus:t+=a.multiplier)}return t};return n.getMultipliers=function(){let e=n.items,t=n.weapon,a=n.weapon_lookup,o=[];for(let t=0,a=e.length;t<a;t++)if("charm"===e[t].type||"trinket"===e[t].type){let a=o.length;o[a]=e[t]}for(let e=0;e<a.length;e++)a.pop();for(let n,r=0,i=e.length;r<i;r++){if(n=e[r].name,t[r]={},!n&&!data.weapons[e[r].name])continue;a[n]=r,t[r].name=n,t[r].multipliers={},t[r].attack_speed=1+v("attack_speed"),t[r].reload_speed=1+v("reload_speed"),t[r].crit_boost=v("crit_boost"),t[r].power_boost=v("power_boost"),t[r].crit_chance=v("crit_chance"),t[r].headshot_multiplier=v("headshot_multiplier"),t[r].backstab_multiplier=v("backstab_multiplier"),t[r].has_power_boost=v("has_power_boost");let i=Object.keys(_);for(let e=0,a=i.length;e<a;e++)t[r].multipliers[_[i[e]]]=1+v(i[e]);let s=data.weapons[n].type;t[r].multipliers.power=t[r].multipliers.power*(1+v("power_level_"+s))*(1+v("damage_taken"));for(let a=0,n=o.length+1;a<n;a++){let n=o[a]?o[a].property:e[r].property;for(let e,a=0,o=n.length;a<o;a++)e=n[a],_[e.name]?t[r].multipliers[_[e.name]]+=e.value:"attack_speed"===e.name?t[r].attack_speed+=e.value:"crit_boost"===e.name?t[r].crit_boost+=e.value:"crit_chance"===e.name&&(t[r].crit_chance+=e.value)}}return t},n.getWeaponIndex=function(e){let t=n.items,a=n.weapon,o=n.weapon_lookup;return 0<=o[e]?o[e]:(n.getMultipliers(),o[e])},n.refresh=function(){let e=n.weapon;n.getMultipliers();for(let e=0,t=verminted.update_on_build.length;e<t;e++)verminted.update_on_build[e]();for(let t=0;t<e.length;t++)e[t].name&&expandWeaponInfo(e[t].name,verminted.weapon_slot[t])},function(){verminted.update_weapon[verminted.update_weapon.length]=b;let e=o.container,t=Object.keys(data.weapons).sort(),a=document.createDocumentFragment();for(let e=0,n=t.length;e<n;e++){let n=t[e],i=data.weapons[n].type,r=Object.keys(data.weapons[n].career);for(let e,t=0,a=r.length;t<a;t++){e=r[t],o.lookup[e]=o.lookup[e]||{},o.lookup[e][i]=o.lookup[e][i]||[];let a=o.lookup[e][i].length;o.lookup[e][i][a]=n}let s=document.createElement("div");s.classList="weapon-list-weapon-name js-button",s.setAttribute("data-weapon",n),s.textContent=n,o.weapon[n]={},o.weapon[n].div=s,a.appendChild(s)}e.appendChild(a)}(),function(){let e=a.getElementsByClassName("select-career")[0],t=document.createDocumentFragment(),n=Object.keys(data.careers).sort();for(let e,a=0,o=n.length;a<o;a++)e=document.createElement("option"),e.textContent=n[a],e.value=n[a],t.appendChild(e);e.appendChild(t),e.addEventListener("change",g)}(),function(){let e=a.getElementsByClassName("career-and-gear")[0],t=n.items;t[0]={},t[0].container=e.getElementsByClassName("item-container")[0];let o=t[0].container.cloneNode(!0),r=0;for(;5>t.length;){0!==r&&(t[r]={},t[r].container=t[r].container||o.cloneNode(!0),1<r&&(t[r].container.textContent=data.careers.dr_ranger.equipment[r])),t[r].property=[];for(let e,a=0;2>a;a++)e=document.createElement("select"),e.classList="select-property js-input",e.setAttribute("data-item-slot",r),e.setAttribute("data-property-slot",a),e.addEventListener("change",u),e.innerHTML=`<option selected disabled hidden>Property</option>`,e.addEventListener("change",f),t[r].property[a]={},t[r].property[a].select=e,t[r].property[a].options=[],t[r].container.appendChild(e);for(let e,a=0;1>a;a++){e=document.createElement("select"),e.classList="select-trait js-input",e.innerHTML=`<option selected disabled hidden>Trait</option>`,t[r].trait={},t[r].trait.select=e,t[r].trait.options=[],t[r].trait.name=null;let a=t[r].trait;e.addEventListener("change",function(t){let e=t.target.value;a.name=e;data.item.traits[e];y()}),t[r].container.appendChild(e)}e.appendChild(t[r].container),r++}for(let e,a=0;2>a;a++)e=document.createElement("div"),e.classList="select-weapon js-button",e.setAttribute("data-weapon-select",a),t[a].weapon={},t[a].weapon.div=e,t[a].weapon.div.textContent=`Weapon ${a+1}`,t[a].container.classList.add("item-weapon"),t[a].container.prepend(e)}(),function(){let e=a.getElementsByClassName("talent-tree")[0],t=document.createDocumentFragment();for(let e=0;5>e;e++){d[e]=[];let a=document.createElement("div");a.classList.add("talent-row");for(let t,n=0;3>n;n++)t=document.createElement("div"),t.classList="talent js-button",d[e][n]={},d[e][n].div=t,a.appendChild(t),t.addEventListener("mousedown",function(){w(e,n)});t.appendChild(a)}e.appendChild(t)}(),function(){let e={},t=Object.keys(data.item.property_combos);for(let a=0,n=t.length;a<n;a++){e[t[a]]={};let n=data.item.property_combos[t[a]];for(let o=0,i=n.length;o<i;o++)e[t[a]][n[o][0]]=e[t[a]][n[o][0]]||{},e[t[a]][n[o][0]][n[o][1]]=!0,e[t[a]][n[o][1]]=e[t[a]][n[o][1]]||{},e[t[a]][n[o][1]][n[o][0]]=!0}o.property_combos=e}(),function(){let e=verminted.global_buffs,t=Object.keys(e);for(let a=0;a<t.length;a++)new k(e[t[a]])}(),h(),n.getMultipliers(),verminted.refresh[verminted.refresh.length]=n.refresh,verminted.update_weapon_list[verminted.update_weapon_list.length]=function(t){let e=n.career.name,a=Object.keys(o.weapon),r={};if(e){let a=t.target.getAttribute("data-weapon-select"),n=e,i=data.careers[n].equipment[a],s=o.lookup[n][i];for(let e=0,t=s.length;e<t;e++)r[s[e]]=!0}else for(let e=0,t=a.length;e<t;e++)r[a[e]]=!0;for(let e=0,n=a.length;e<n;e++)r[a[e]]?o.weapon[a[e]].div.classList.remove("hide"):o.weapon[a[e]].div.classList.add("hide")},n},WeaponListModal=function(){let t=ModalControl(document.getElementsByClassName("weapon-list-holder")[0]);return t.onClick=function(a){a.stopPropagation();let e=a.target,n=!0;for(;e&&e.classList;){if(e.classList.contains("weapon-list-holder")){n=!1;break}else if(e.getAttribute("data-weapon")){let a=e.getAttribute("data-weapon");t.clickCallback(a),n=!0;break}else e.classList.contains("select-weapon")&&(n=!1);e=e.parentNode}n&&t.close()},t},TooltipControl=function(e){if(verminted.tooltips[uniqueID(e)])return verminted.tooltips[uniqueID(e)];let t={},a=null,n=verminted.tooltip,o=null;return t.open=function(){let t=e.getBoundingClientRect();n.textContent=o,n.style.display="inline-block",n.style.left=t.right+n.offsetWidth+2>window.innerWidth?window.innerWidth-(n.offsetWidth+2)+"px":t.right-0+"px",n.style.top=t.bottom+"px"},t.close=function(){n&&(n.style.display="none"),clearTimeout(a)},t.bind=function(){e.addEventListener("mouseover",t.startTimer),e.addEventListener("mouseout",t.close)},t.startTimer=function(){verminted.mobile=window.mobilecheck(),verminted.mobile||(a=setTimeout(function(){t.open()},400))},t.text=function(e){o=e},t.bind(),verminted.tooltips[uniqueID(e)]=t},compareConsole=function(t){function e(e){for(let t,n=0;n<e.length;n++)if(t=e[n].split`,`,r[t[0]]){let i=t[0],s=r[i];o[s]={};for(let t,i="infantry";!(n>=e.length);){if(t=e[n].split`,`,"infantry"===i&&""===t[2]){i="armored",n++;continue}else if("armored"===i&&""===t[2])break;let r=a(s,t[1]);o[s][r]=t[1],n++}}}function a(e,t){let a,n=data.weapons[e].actions,o=function(e,t){if(1===t){let t=n.neutral.attack_speed,a=Object.keys(t).sort();for(let n=0;n<a.length;n++)if(0<=t[a[n]].search(e)){if("heavy"===e&&0<=t[a[n]].search("heavy_attack_charged"))continue;return a[n]}}};if(0<=t.search("push"))a=n.push.push_attack;else if(0<=t.search("light")){let e=parseInt(t.charAt(t.search(/[0-9]/)));a=o("light",e)}else if(0<=t.search("charged")){let e=parseInt(t.charAt(t.search(/[0-9]/)))||1;a=o("heavy_attack_charged",e)}else if(0<=t.search("heavy")){let e=parseInt(t.charAt(t.search(/[0-9]/)))||1;a=o("heavy",e)}return a}let n=t.target.files[0],o={},r={Axe:"1h_axe","Axe and Falchion":"axe_and_falchion",Falchion:"falchion",Flail:"flail",Rapier:"rapier","Two-handed Sword":"2h_sword"},s=new FileReader;s.onload=function(){e(s.result.split(/\r\n/g))},s.readAsText(n)};function reverseLookup(e){if(data.weapons[e].lookup)return!1;let t={},a=data.weapons[e].actions,n=Object.keys(a),o={};o.lookup={},o.lookup["default"]=!0,o.current=0,o.buffer=[],o.buffer[0]="default",o.future=o.current+1;let i=function(r){t[r]={};for(let e,s=0,i=n.length;s<i;s++){if(e=a[n[s]],e.attack_speed&&e.attack_speed.parent){let a=Object.keys(e.attack_speed.parent);for(let i=0,p=a.length;i<p;i++)o.lookup[a[i]]||(o.lookup[a[i]]=!0,o.buffer[o.future]=a[i],o.future++),r===a[i]&&(t[r][n[s]]=e.attack_speed.parent[a[i]])}if(e.attack_speed.child){let t=Object.keys(e.attack_speed.child);for(let e=0,a=t.length;e<a;e++)o.lookup[t[e]]||(o.lookup[t[e]]=!0,o.buffer[o.future]=t[e],o.future++)}}o.current++,o.buffer[o.current]?(r=o.buffer[o.current],i(r)):data.weapons[e].block&&(t.block=t.block||{},t.block.push=data.weapons[e].block.min_hold,data.weapons[e].push&&(t.push=t.push||{}),t.block_cancel_end&&delete t.block_cancel_end,t.anim_cancel&&delete t.anim_cancel)};return i(o.buffer[0]),data.weapons[e].lookup=t,!0}function expandWeaponInfo(e,t){var a=Math.round;let n=constants.hit_types,o=constants.armor_types,i=verminted.build.getWeaponIndex(e),r=(""+verminted.platform+i+concateObject(verminted.build.weapon[i])).hashCode(),s=t.getAttribute("data-hash");if(r===s)return;t.setAttribute("data-hash",r);let p={neither:"normal",headshot:"headshot",critical:"critical",both:"both"},l=t;l.getElementsByClassName("weapon-title")[0].textContent=e;let c=data.weapons[e],d=Object.keys(c.actions).sort(),m=l.getElementsByClassName("attack"),_=verminted.damage,u=-1;"ranged"===data.weapons[e].type&&(u=0);for(let r=0,i=m.length;r<i;r++)if(r<d.length){let t=c.actions[d[r]].attack_speed,i=m[r].getElementsByClassName("attack-modifiers")[0];if(m[r].getElementsByClassName("weapon-attack-name")[0].textContent=d[r],i.textContent="",t){let e=m[r].getElementsByClassName("svg-attack-speed")[0],n=e.getElementsByTagName("use")[0],o=TooltipControl(n),i="Chain to:",s=Object.keys(t).sort().reverse();for(let e,n=0,o=s.length;n<o;n++)e=t[s[n]],e=a(100*e)/100,i+="\r\n"+e+"\t"+s[n];o.text(i)}let s={},l=m[r].getElementsByClassName("damage-table")[0];c.actions[d[r]].damage_profile?s[0]=c.actions[d[r]].damage_profile:(s[0]=c.actions[d[r]].damage_profile_left,s[1]=c.actions[d[r]].damage_profile_right);for(let t=0;6>t;t++){3==t&&(t=4);let i=t,r=t;5==t&&(i=1,r=5);for(let i=0;4>i;i++){let r,c;r=1==i||3==i?"headshot":null,c=!!(1<i);let d=!1,m=[],u=null,h=l.getElementsByClassName(constants.armor_types[t]+" "+constants.hit_types[i])[0],g=TooltipControl(h);for(let r,l=0;5>l;l++){r=0;for(let p=0,c=Object.keys(s).length;p<c;p++){if(data.profiles[s[p]]){let c=_.getDamage(e,s[p],o[t],n[i],l);r+=a(4*c)/4}m[l]=r}let c;!0==d||0<l&&m[l]>m[l-1]?(c=0,d=!0):0<m[l]%1?c=m[l].toFixed(2):c=m[l],0==l&&(h.textContent=m[0],u=constants.armor_types[t]+" - "+p[constants.hit_types[i]],u+="\r\nTargets:"),0<c&&(u+="\r\n  "+(l+1)+": "+c)}g.text(u)}}m[r].classList.remove("hide")}else m[r].classList.add("hide")}function assembleDiv(e,t,a,n){let o=n?document.createElement(n):document.createElement("div");return o.classList=e,a&&(o.textContent=a),t.appendChild(o),o}function assembleWeaponSheet(){var e={};e.table=document.createElement("div"),e.table.id="weapon-data",e.table.classList="hide",e.attack={};for(var t=0;16>t;t++){let a=assembleDiv("attack-container",e.table);e.attack[t]=assembleDiv("attack-type",a).textContent;let n=assembleDiv("damage-table",a);e.damage={};for(let t=0;5>t;t++){e.damage[constants.armor_types[t]]={};for(let a,o=0;4>o;o++)a=assembleDiv(constants.armor_types[t]+" "+constants.hit_types[o],n).textContent,e.damage[constants.armor_types[t]][constants.hit_types[o]]=a}}return e}function assembleWeapon(e,t,a,n,o){var i=o.weapons[t[n]],r="weapon-name";"ranged"===i.type&&(r="weapon-name weapon-ranged");var s=assembleDiv(r+" weapon-holder",e,t[n]);if(s.setAttribute("data-weapon",t[n]),i.career){let e=Object.keys(i.career),t=constants.characters,a={},n=!1;for(let o,i=0,r=e.length;i<r;i++)o=t[e[i]],o&&!a[o]&&(n?n+=","+o:n=o,a[o]=!0);s.setAttribute("data-character",n)}return s}function populateElements(){var e=document.createDocumentFragment(),t=document.getElementsByClassName("weapon-list")[0],a=Object.keys(data.weapons).sort(),n=constants.characters;let o=document.getElementsByClassName("attack")[0];for(let e=0;2>e;e++){let t="[data-weapon-slot='"+e+"']",a=document.querySelector(t).getElementsByClassName("attacks-container")[0];for(let t,n=0;n<9+e;n++)t=o.cloneNode(!0),a.appendChild(t)}}function populateAttackCombo(){let e={},t=data.breeds,a=Object.keys(constants.mob_lookup),n=constants.hit_types,o=constants.armor_types,i=verminted.max_targets,r=function(e,t){let a,o=data.breeds[e],r={},s=document.createElement("div"),p=o.primary_armor||o.armor;a=o.hitzone_primary_armor?o.hitzone_primary_armor.head:o.hitzone_armor?o.hitzone_armor.head:p;let l=document.createElement("div");l.classList.add("mob-name"),l.textContent=e,r.mob_name=l,s.appendChild(l),r.targets=[];for(let o,l=0;l<i;l++){o=document.createElement("div"),o.classList.add("breakpoint-row"),r.targets[l]={},r.targets[l].row=o;for(let e=0;e<n.length;e++){let t,i=n[e];t="headshot"===i||"both"===i?a:p;let s=document.createElement("div");s.classList.add(t),s.classList.add(i),r.targets[l][i]=s,o.appendChild(s)}s.appendChild(o)}return r.container=s,t.appendChild(s),r};e.weapon=[];let s=document.getElementsByClassName("weapon-breakpoints-container");for(let t,n=0;n<s.length;n++){t=s[n].getElementsByClassName("weapon-breakpoints")[0],e.weapon[n]={},e.weapon[n].container=t,e.weapon[n].name_div=s[n].getElementsByClassName("weapon-name")[0];let o=document.createElement("div");o.classList.add("breakpoint-plate");let i={};for(let e,t=0,n=a.length;t<n;t++)e=r(a[t],o),i[a[t]]=e;e.weapon[n].breeds=i;let p=s[n].getElementsByClassName("weapon-breakpoints-attacks")[0],l=!0;e.weapon[n].name_div.addEventListener("click",function(){l=!l,l?(p.classList.remove("hide"),o.classList.remove("hide")):(p.classList.add("hide"),o.classList.add("hide"))}),t.appendChild(o)}e.combo={},e.combo.container=document.getElementsByClassName("attack-combo")[0],e.combo.info={},e.combo.info.container=document.createElement("div"),e.combo.info.container.classList="combo-info hide",e.combo.info.attack_speed=document.createElement("div"),e.combo.info.damage_box={},e.combo.info.damage_box.container=document.createElement("div"),e.combo.info.damage_box.dps={},e.combo.info.damage_box.container.classList.add("combo-damage-box"),e.combo.info.container.appendChild(e.combo.info.attack_speed),e.combo.info.container.appendChild(e.combo.info.damage_box.container),e.combo.breeds={};let p=document.createElement("div");p.classList="breakpoint-plate hide";let l={};for(let e,t=0,n=a.length;t<n;t++)e=r(a[t],p),l[a[t]]=e;return e.combo.breeds=l,e.combo.container.appendChild(e.combo.info.container),e.combo.container.appendChild(p),e}function prepPage(){"?shadeult"===window.location.search&&(verminted.temp_shade_ult=!0,pageSelection(document.getElementsByClassName("weapon-page")[0]),console.log(document.getElementsByClassName("weapon-page")[0])),document.getElementsByClassName("build-number")[0].textContent=build,constants=InitConstants();let e=document.getElementsByClassName("select-difficulty")[0],t=document.createDocumentFragment(),a=Object.keys(constants.difficulties);for(let e=0;e<a.length;e++){let n=a[e],o=document.createElement("option");o.textContent=n,o.value=n,n===verminted.difficulty&&o.setAttribute("selected",!0),t.appendChild(o)}e.appendChild(t),e.addEventListener("change",verminted.set_difficulty),verminted.update_weapon_list=[],verminted.update_weapon=[],verminted.update_on_build=[],verminted.tooltip=document.getElementsByClassName("tooltip")[0],verminted.tooltips={};let n=populateAttackCombo();verminted.combo_breakpoint_table=n.combo,verminted.weapon_breakpoint_table=[],verminted.weapon_breakpoint_table[0]=n.weapon[0],verminted.weapon_breakpoint_table[1]=n.weapon[1]}window.onload=function(){prepPage(),document.getElementsByClassName("build-number")[0].textContent+="-"+date,document.getElementsByClassName("build-number")[0].prepend(data.vt_build+"_"),verminted.global_buffs={victor_witchhunter_passive_debuff:data.careers.wh_captain.passives[0],markus_mercenary_passive:data.careers.es_mercenary.passives[0],markus_huntsman_passive_crit_aura:data.careers.es_huntsman.passives[3],trinket_grenade_damage_taken:data.item.traits.trinket_grenade_damage_taken,witch_hunter_captain_ultimate:{name:"witch_hunter_captain_ultimate",stat_buff:"crit_chance",max_stacks:1,bonus:.25},strength_potion:{name:"strength_potion",stat_buff:"has_power_boost",max_stacks:1,multiplier:1},speed_potion:{name:"speed_potion",stat_buff:"attack_speed",max_stacks:1,multiplier:.5}};let e=Object.keys(data.globals);for(let t=0,a=e.length;t<a;t++)constants[e[t]]=data.globals[e[t]];populateElements(),verminted.weapon_list=WeaponListModal(),verminted.damage=WeaponDamage(),verminted.combo_breakpoints=ComboBreakpoints(verminted.combo_breakpoint_table),verminted.attack_chain=AttackChain(document.getElementsByClassName("chain-attack-container")[0]),verminted.weapon_buttons={},verminted.weapon_slot={},verminted.build=BuildBuild();let t=document.getElementsByClassName("select-weapon");for(let e=0,a=t.length;e<a;e++){let a=uniqueID(t[e]),n=verminted.tooltips[a];verminted.weapon_buttons[a]=WeaponSelection(t[e]),verminted.weapon_slot[e]=document.getElementsByClassName("weapon-attacks")[e],verminted.tooltips[a]=TooltipControl(t[e]),verminted.tooltips[a].text("Weapon "+(e+1))}verminted.update_weapon[verminted.update_weapon.length]=expandWeaponInfo,verminted.weapon_attack_breakpoints=[];for(let e=0;e<verminted.weapon_breakpoint_table.length;e++)verminted.weapon_attack_breakpoints[e]=AttackBreakpoints(verminted.weapon_breakpoint_table[e]);let a=document.getElementsByClassName("select-page");for(let e=0,t=a.length;e<t;e++)a[e].addEventListener("click",function(t){pageSelection(t.target)});let n=document.getElementsByClassName("build-button");for(let e=0,t=n.length;e<t;e++)n[e].addEventListener("click",function(t){verminted.build.modal.open(),t.stopPropagation()});let o=document.getElementsByClassName("input-power-level");for(let e=0;e<o.length;e++)o[e].value=verminted.power_level-185,o[e].addEventListener("change",verminted.set_power_level);let i=document.getElementsByClassName("select-platform")[0],r=TooltipControl(i);r.text`PC is accurate.\r\n\r\nConsole values are estimated by\r\ncommunity and will not be 100% accurate.\r\nThese mobs only support console Legend:\r\nskaven slave\r\nskaven clan rat\r\nchaos fanatic\r\nchaos marauder`,i.addEventListener("change",verminted.set_platform);let s=document.getElementsByClassName("select-headshot-percent")[0];s.addEventListener("change",function(t){let e=t.target.valueAsNumber;e=100<e?100:0<e?e:0,s.value=e,verminted.combo_breakpoints.headshot_chance=e/100,verminted.build.refresh()});let p=TooltipControl(s.parentNode);p.text`Percentage of hits that\r\nare headshots for DPS`,document.getElementsByClassName("select-file")[0].addEventListener("change",compareConsole)};